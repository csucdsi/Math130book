{
  "hash": "b0807fdc92bf41e4c43b0af6fcff4a5b",
  "result": {
    "engine": "knitr",
    "markdown": "# Getting data into R {#sec-import}\n\nIn this lesson we will introduce methods to get data from external files into R. \n\n\n:::{.callout-note title = \"üéì Learning Objectives\" icon=false}\nAfter completing this lesson learners will be able to\n\n* Distinguish between an `absolute` and `relative` path, and identify which one is used from within an R Project. \n* Import data that is stored in an external Excel, CSV or tab-delimited text file into R.\n* Compare and contrast the three file types discussed in this lesson. \n* Use functions to examine data objects to ensure data was imported correctly. \n\n:::\n\n:::{.callout-tip title = \"üëâ Prepare\" icon=false}\n\n1.  Open your Math 130 R Project.\n2.  Right click and \"save as\" this lessons [[Quarto notes file]](notes/import_notes.qmd) and save into your `Math130/notes` folder.\n3. Right click each link and save the following data sets into your `Math130/data` folder.\n4.  In the *Files* pane, open this Quarto file and Render this file.\n\n* [County Complete](https://www.norcalbiostat.com/data/countyComplete.csv)\n* [email](https://www.norcalbiostat.com/data/email.txt)\n* [Police Shootings](https://www.norcalbiostat.com/data/fatal-police-shootings-data.xlsx)\n\n:::\n\n:::{.callout-important title = \"DO NOT RENAME ANYTHING\"}\nIf you download multiple copies of the data, do not keep the versions that have a (1) or some number in the name. Do not leave these files in your downloads folder. \n:::\n\n:::{.callout-important title = \"CAUTION FOR MAC USERS\"}\nBe sure you download the CSV file as .csv and not as a .numbers file. If you create a file in Numbers, you can choose File > Export To > CSV to convert it.\n:::\n\n\n\n\n## File types \n\nIn this lesson we are only going to explore reading files that exist on your computer into R from three most commonly used data sources: A tab-delimited text file, A CSV file and an Excel file. \n\nThe three different files we will be using have different file types, or extensions. [.doc  (Microsoft word), .pdf (PDF) and .png (images) are examples of file extensions for other types of files]{.aside}\n\n* `email.txt` is a `.txt` or \"text\" file.\n* `NCBirths.csv` is a `.csv` or \"comma separated values\" file.\n* `fatal-police-shootings-data.xlsx` is a `.xlsx` or Excel file. \n\nEach of these file types differ in the type of _delimiter_ used. The _delimiter_ is a character or symbol that separates columns of data from each other when stored in an external file.  Recall back to the earlier lesson on data frames and matrices. Each column in the matrix represented data on a specific variable. Something had to tell R how to distinguish which values went with which variable. \n\nThere are two main types of delimiters we will consider in this class; comma and tab. That does not mean that data can't be stored in other ways, these are just the two most common. \n\n::: {#fig-delim layout-ncol=2}\n\n![Tab separated data. Variable names are `id`, `gender`, `race`, and `ses`.](img/tab_sep.png){#fig-tab_sep}\n\n![Comma separated data. Variable names are `Month`, `RsnStop`, `OffRace`, etc ](img/comma_sep.png){#fig-csv}\n\nExample of two common types of delimiters. \n\n:::\n\nEach delimiter type requires a different function or mechanism to import the data into R. If you use the wrong mechanism, the data may not be read in correctly if at all. \n\n\n## Paths (where the data lives)\n\nIn addition to using the correct function for the delimiter type, we have to then tell the program explicitly where to find the files you want to access. To do that we need to find the file's _path_. The _path_ is a programmatic way to direct your computer to the location of a file. \n\nYou can think of it as a file's address, or where it lives on your computer. But to get to that address depends on where you start your journey. For example to get to your instructors office in Holt Hall, it will be different depending on if you start from your house, vs start from Meriam Library. If someone else starts from their house, their path would look different than if you both started at the Library. \n\n* **Absolute paths** point to where a file is on a specific computer. \n    * Example: `/Users/rdonatello/Library/CloudStorage/Box-Box/Teaching/MATH 130/data` This path to the `data` folder only exists on Dr. Donatello's macbook. \n* **Relative paths** indicate where inside the project folder a file is located. \n    * Example: `MATH 130/data`. This path to the `data` folder once you're already in the `MATH 130` folder. Anyone that has a `MATH 130` folder with a `data` subfolder has the same path. \n\nWhen we use R Projects, we are setting the starting point (called the _working directory_) to your Math 130 folder. We will also reinforce that by using the `here` package. We want to specify that all our paths start `\"here\"`, at the top of our project working directory. \n[learn more about the [here](https://here.r-lib.org/articles/here.html) package]{.aside}\n\n![Cartoon showing two paths side-by-side. On the left is a scary spooky forest, with spiderwebs and gnarled trees, with file paths written on the branches like ‚Äú~/mmm/nope.csv‚Äù and ‚Äúsetwd(‚Äú/haha/good/luck/‚Äù), with a scared looking cute fuzzy monster running out of it. On the right is a bright, colorful path with flowers, rainbow and sunshine, with signs saying ‚Äúhere!‚Äù and ‚Äúit‚Äôs all right here!‚Äù A monster facing away from us in a backpack and walking stick is looking toward the right path. Stylized text reads ‚Äúhere: find your path.‚Äù](img/here.png){width=80%}\n\n[Learn more about [here](https://here.r-lib.org/).]{.aside}\n\n:::{.callout-tip title = \"üëâ Whats your path?\" icon=false}\n\nIn the console, type `here::here()` to have R show you what your current working directory is at. This is the *absolute path* to your Math 130 folder on your computer. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Dr. D's path to the code to build this course website\nhere::here()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"C:/Github/Math130book\"\n```\n\n\n:::\n:::\n\n:::\n \n\n   \nWorking with a combination of R projects and the `here` package this way makes it a lot easier to move your project around on your computer and share it with others without having to directly modify file paths in the individual scripts.\n\n:::{.callout-important title = \"Cannot open the Connection\"}\nThe import code in this lesson assumes that you are working in your R project, and that you have your data downloaded and in the `data` folder. If you get an error message saying `Cannot open the connection` - double check the following common places for mistakes: \n\n1. is the data file in the right place? \n2. did you spell the name of the data set correctly? \n3. are you in your R project and using the `here::here` function correctly? \n:::\n\n## Checking the import was successful\n\nThe first thing you should always do after importing a data file is look at the raw data and ask yourself the following things: \n\n1. Were the variable names read in correctly? \n2. Is there the expected number of rows and columns? \n3. Are the data types for each variable as expected? \n\nNext we will read in three different data sets, each with unique file types, and look at each one to make sure it was read in correctly. \n\n## Text files \n\nText files are very simple files that have a `.txt` file extension. Common delimiters include a space, a comma (,) or a tab. Uncommon delimiters could include a `%` or even a semi-colon (`;`). \n\n:::{.callout-tip title = \"üëâ Open the file directly\" icon=false}\nNavigate to your class folder, and open the `emamil.txt` file that should be in your `data` folder by double clicking. If your computer asks, you can open it with the `notepad` program. Identify the following: \n\n1. what's in the first row - data or variable names? \n2. what is the delimiter? - in this case it is a tab. \n:::\n\nWe will use the `read.table()` function that is in base R to read in any type of delimited file. \n\n::: {.cell code-annotations='below'}\n\n```{.r .cell-code}\nemail <- read.table( # <1> \n          here::here(\"data/email.txt\"), # <2> \n          header=TRUE, # <3> \n          sep=\"\\t\" # <4> \n          )\n```\n:::\n\n\n1. Use the `read.table()` function because it is a text file\n2. Use `here::here` to ensure you start at the project directory, then go into the `data` folder, and find the `email.txt` data set. \n3. Set `header=TRUE` to signify that the data in the first row contains our column names\n4. Specify that the delimiter is a tab (`\"\\t\"`).  \n\n:::{.callout-important title = \"Trust but verify\"}\nLet's use the `head` function to look at the imported data, ensuring the variable names are intended, and that each column has data in it. \n\n::: {.cell}\n\n```{.r .cell-code}\nhead(email)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  spam to_multiple from cc sent_email                time image attach dollar\n1    0           0    1  0          0 2011-12-31 22:16:41     0      0      0\n2    0           0    1  0          0 2011-12-31 23:03:59     0      0      0\n3    0           0    1  0          0 2012-01-01 08:00:32     0      0      4\n4    0           0    1  0          0 2012-01-01 01:09:49     0      0      0\n5    0           0    1  0          0 2012-01-01 02:00:01     0      0      0\n6    0           0    1  0          0 2012-01-01 02:04:46     0      0      0\n  winner inherit viagra password num_char line_breaks format re_subj\n1     no       0      0        0   11.370         202      1       0\n2     no       0      0        0   10.504         202      1       0\n3     no       1      0        0    7.773         192      1       0\n4     no       0      0        0   13.256         255      1       0\n5     no       0      0        2    1.231          29      0       0\n6     no       0      0        2    1.091          25      0       0\n  exclaim_subj urgent_subj exclaim_mess number\n1            0           0            0    big\n2            0           0            1  small\n3            0           0            6  small\n4            0           0           48  small\n5            0           0            1   none\n6            0           0            1   none\n```\n\n\n:::\n:::\n\n\n:::\n\n:::{.callout-important title = \"Errors!\"}\nWhat happens if you forget to include the arguments for `header` or `sep`? Try that now and discuss what happened. \n\n<details>\n  <summary> Solution - Forgetting both arguments </summary>\n\n::: {.cell}\n\n```{.r .cell-code}\nemail.noboth <- read.table(here::here(\"data/email.txt\"))\n```\n\n::: {.cell-output .cell-output-error}\n\n```\nError in read.table(here::here(\"data/email.txt\")): duplicate 'row.names' are not allowed\n```\n\n\n:::\n\n```{.r .cell-code}\nhead(email.noboth)\n```\n\n::: {.cell-output .cell-output-error}\n\n```\nError: object 'email.noboth' not found\n```\n\n\n:::\n:::\n\nThe data set won't successfully be read in, and won't show up in your environment. \n</details>\n\n<details>\n  <summary> Solution - Forgetting the header </summary>\n\n::: {.cell}\n\n```{.r .cell-code}\nemail.nohead <- read.table(here::here(\"data/email.txt\"), sep=\"\\t\")\nhead(email.nohead)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    V1          V2   V3 V4         V5                  V6    V7     V8     V9\n1 spam to_multiple from cc sent_email                time image attach dollar\n2    0           0    1  0          0 2011-12-31 22:16:41     0      0      0\n3    0           0    1  0          0 2011-12-31 23:03:59     0      0      0\n4    0           0    1  0          0 2012-01-01 08:00:32     0      0      4\n5    0           0    1  0          0 2012-01-01 01:09:49     0      0      0\n6    0           0    1  0          0 2012-01-01 02:00:01     0      0      0\n     V10     V11    V12      V13      V14         V15    V16     V17\n1 winner inherit viagra password num_char line_breaks format re_subj\n2     no       0      0        0    11.37         202      1       0\n3     no       0      0        0   10.504         202      1       0\n4     no       1      0        0    7.773         192      1       0\n5     no       0      0        0   13.256         255      1       0\n6     no       0      0        2    1.231          29      0       0\n           V18         V19          V20    V21\n1 exclaim_subj urgent_subj exclaim_mess number\n2            0           0            0    big\n3            0           0            1  small\n4            0           0            6  small\n5            0           0           48  small\n6            0           0            1   none\n```\n\n\n:::\n:::\n\nThe data is read into the object `email.nohead`, but the variable names were read in as datta in the first row. R assigned generic `V1`, and `V2` data names as your clue. \n</details>\n\n<details>\n  <summary> Solution - Forgetting the separator </summary>\n\n::: {.cell}\n\n```{.r .cell-code}\nemail.nosep <- read.table(here::here(\"data/email.txt\"), header=TRUE)\n```\n\n::: {.cell-output .cell-output-error}\n\n```\nError in read.table(here::here(\"data/email.txt\"), header = TRUE): duplicate 'row.names' are not allowed\n```\n\n\n:::\n:::\n\nWe get the same error message and it will not read the data into your environment. \n</details>\n\n:::\n\n\n\n## CSV: Comma Separated Values \n\nCSV stands for \"comma-separated values\". This file type can also open in spreadsheet programs like MS Excel, Numbers or google sheets. The icons even look similar. Here we use the `read.csv()` function because it is optimized to read in this file type. [Not CVS the pharmacy]{.aside}\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncc <- read.csv(here::here(\"data/countyComplete.csv\"), header=TRUE)\ncc[1:5, 1:6] # peek at the first 5 rows and 6 columns of the data\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n            name   state FIPS pop2010 pop2000 age_under_5\n1 Autauga County Alabama 1001   54571   43671         6.6\n2 Baldwin County Alabama 1003  182265  140415         6.1\n3 Barbour County Alabama 1005   27457   29038         6.2\n4    Bibb County Alabama 1007   22915   20826         6.0\n5  Blount County Alabama 1009   57322   51024         6.3\n```\n\n\n:::\n:::\n\n\nThe variable names are present, the data are all in columns with reasonable data types. \n\n## Excel files\n\nFiles with the `.xlsx` or `.xls` extensions are Microsoft Excel files. These are also comma separated, but have more features than a `.csv` file. We will use the `read_excel()` function from the [`readxl` package](http://readxl.tidyverse.org/), which is contained within the `tidyverse` package that we installed earlier.  \n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(readxl)\npolice  <- read_excel(here::here(\"data/fatal-police-shootings-data.xlsx\"), \n                      sheet=1, col_names=TRUE)\npolice[1:6,2:6] # peek at the first 5 rows and 6 columns of the data\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 √ó 5\n  name               date                manner_of_death  armed        age\n  <chr>              <dttm>              <chr>            <chr>      <dbl>\n1 Tim Elliot         2015-01-02 00:00:00 shot             gun           53\n2 Lewis Lee Lembke   2015-01-02 00:00:00 shot             gun           47\n3 John Paul Quintero 2015-01-03 00:00:00 shot and Tasered unarmed       23\n4 Matthew Hoffman    2015-01-04 00:00:00 shot             toy weapon    32\n5 Michael Rodriguez  2015-01-04 00:00:00 shot             nail gun      39\n6 Kenneth Joe Brown  2015-01-04 00:00:00 shot             gun           18\n```\n\n\n:::\n:::\n\n\n* Notice this was read in as a `tibble`, not a `data.frame`. Ref Section @sec-tibble to recall the differences. \n* The variable `date` is a `dttm` or _date-time_ variable. This means `R` recognizes it directly as a date, not some string of numbers. This is good. \n* Categorical variables such as `manner_of_death` and `city` are read in as `character` instead of factor. We may or may not want to change that later.\n* Numeric variables such as `age` are of type `dbl` (double). This is similar to `integer` or `numeric`, so we are fine. \n\n\n",
    "supporting": [
      "import_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
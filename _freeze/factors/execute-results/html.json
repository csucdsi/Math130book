{
  "hash": "ac8f9bbe6d0f81dbd178b6c85017ad02",
  "result": {
    "engine": "knitr",
    "markdown": "# Working with Factors {#sec-factors}\n\nIn this lesson we will discuss ways to organize and deal with categorical data, also known as factor data types.\n\n:::{.callout-warning icon=false appearance=minimal}\n<a href=\"https://media.csuchico.edu/media/MATH+130+-+Lecture+06A+Intro/1_h8a1glfl\" target=\"_blank\">Lesson Introduction Video</a>\n:::\n\n:::{.callout-note title = \"ðŸŽ“ Learning Objectives\" icon = false}\n:::: {.columns}\n\n::: {.column width=\"70%\"}\nAfter completing this lesson students will be able to\n\n-   Convert a numeric variable to a factor variable.\n-   Apply and change labels to factor\n-   Understand and control the ordering of the factor.\n-   Combine multiple levels of a factor variable into one level\n-   Learn how to use the `forcats` package\n\n:::\n\n::: {.column width=\"30%\"}\n![](img/forcats.png)\n:::\n\n::::\n\n\n:::\n\n\n:::{.callout-tip title = \"ðŸ‘‰ Prepare\" icon=false}\n\n1.  Open your Math 130 R Project.\n2.  Right click and \"save as\" this lessons [[Quarto notes file]](notes/factor_notes.qmd) and save into your `Math130/notes` folder.\n3.  In the *Files* pane, open this Quarto file and Render this file.\n\n:::\n\n[The `email` data set contains information on emails received by one of the OpenIntro authors for the first three months in 2012. See `?email` for more details.]{.aside}\n[The `fastfood` data set from the `openintro` package describes nutrition amounts in 515 fast food items. See `?fastfood` for more details.]{.aside}\n[The `mtcars` data set contains data from the 1974 Motor Trend US magazine, and comprises fuel consumption and 10 aspects of automobile design and performance for 32 automobiles. See `?mtcars` for more details.]{.aside}\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(forcats)\nemail <- openintro::email\nff    <- openintro::fastfood\nnc    <- openintro::ncbirths # note the name change\nmtcars <- mtcars # comes with R\n```\n:::\n\n\n\n\nThe goal of the `forcats` package is to provide a suite of useful tools that solve common problems with factors. Often in R there are multiple ways to accomplish the same task. Some examples in this lesson will show how to perform a certain task using base R functions, as well as functions from the `forcats` package.\n\n## What is a factor?\n\n:::{.callout-warning icon=false appearance=minimal}\n<a href=\"https://media.csuchico.edu/media/MATH+130+-+Lecture+06A+What+is+a+FactorF/1_abke2v0c\" target=\"_blank\">What is a factor - lesson video</a>\n:::\n\nThe term factor refers to a data type used to store categorical variables. The difference between a categorical variable and a continuous variable is that a categorical variable corresponds to a limited number of categories, while a continuous variable can correspond to an infinite number of values.\n\nAn example of a categorical variable is the `number` variable in the `email` data set. This variable contains data on whether there was no number, a small number (under 1 million), or a big number in the content of the email.\n\n## Confirming the factor data type\n\nFirst we should confirm that R sees `number` as a factor. We can use the `class` function we saw earlier, or `str`.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nclass(email$number)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"factor\"\n```\n\n\n:::\n:::\n\n\n\n\nWe can use the `levels()` function to get to know factor variables.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlevels(email$number)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"none\"  \"small\" \"big\"  \n```\n\n\n:::\n:::\n\n\n\n\nThere are three levels: `none`, `small`, and `big`. \n\n:::{.callout-tip title = \"Character data types\"}\nLet's look at the variable `restaurant` from the fast food (`ff`) data set. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlevels(ff$restaurant)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nNULL\n```\n\n\n:::\n:::\n\n\n\n:::\n\nWait - NULL? But this is a categorical variable. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nclass(ff$restaurant)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"character\"\n```\n\n\n:::\n:::\n\n\n\n\nThere is a subtle difference between `factor` and `character` data types in R. Both are categorical measures (not numbers), but factor variables have an assigned order and character variables do not. If we want to specifically control the ordering of the levels, the data type must be `factor`. \n\n## Convert a character variable to factor \n\nWe can use the `as.factor()` function.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nff$restaurant <- as.factor(ff$restaurant)\nlevels(ff$restaurant)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Arbys\"       \"Burger King\" \"Chick Fil-A\" \"Dairy Queen\" \"Mcdonalds\"  \n[6] \"Sonic\"       \"Subway\"      \"Taco Bell\"  \n```\n\n\n:::\n:::\n\n\n\n\nThe `forcats` package has a similar function `as_factor()` that could be used here also. \n\n## Convert a number variable to factor \n\n:::{.callout-warning icon=false appearance=minimal}\n<a href=\"https://media.csuchico.edu/media/MATH+130+-+Lecture+06A+Convert+a+Number+to+Factor/1_rfnetvxy\" target=\"_blank\">Lesson video</a>\n:::\n\nSometimes data are entered into the computer using numeric codes such as 0 and 1. These codes stand for categories, such as \"no\" and \"yes\". Sometimes we want to analyze these binary variables in two ways:\n\n-   For statistical analyses, the data must be numeric 0/1.\n-   For many graphics, the data must be a factor, \"no/yes\".\n\n:::{.callout-tip title = \"Example: What type of transmission does that car have?\" icon=false}\nThe `am` variable from the `mtcars` data set records whether or not the car has an automatic transmission, or a manual one. However, the values were recorded as 0 for automatic and 1 for manual. \n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntable(mtcars$am) # view which values are present\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n 0  1 \n19 13 \n```\n\n\n:::\n\n```{.r .cell-code}\nclass(mtcars$am) # confirm what R thinks the data type is\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"numeric\"\n```\n\n\n:::\n:::\n\n\n\n\nR thinks this variable is numeric, but we know that's not the case. We can use the function `factor()` to convert the numeric variable `am` to a factor, applying `labels` to convert 0 to \"automatic\" and 1 to \"manual\".\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmtcars$transmission_type <- factor(mtcars$am, \n                                   labels=c(\"automatic\", \"manual\"))\n```\n:::\n\n\n\n\nThe ordering of the `labels` argument *must* be in the same order (left to right) as the factor levels themselves. Look back at the order of columns in the `table` - it goes 0 then 1. Thus our labels need to go \"automatic\" then \"manual\".\n\n:::{.callout-important title = \"Trust but verify\"}\nWe can confirm that the new variable was created correctly by creating a two-way contingency table by calling the `table(old variable, new variable)` function on both the old and new variables.\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntable(mtcars$am, mtcars$transmission_type, useNA=\"always\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      \n       automatic manual <NA>\n  0           19      0    0\n  1            0     13    0\n  <NA>         0      0    0\n```\n\n\n:::\n:::\n\n\n\n\nHere we see that all the 0's were recoded to automatic, and all the 1's recoded to manual, and there are no new missing values. Success!\n\n## Factor (re)naming \n\n:::{.callout-warning icon=false appearance=minimal}\n<a href=\"https://media.csuchico.edu/media/MATH+130+-+Lecture+06A+Factor+%28Re%29naming/1_f34h4fuw\" target=\"_blank\">Lesson Video</a>\n:::\n\nWhat if the variable is already a factor, but has names we don't prefer. We want them to say something else. We can accomplish this in both base R and using `forcats` package. \n\n::: {.panel-tabset}\n## Base R\n\nRe-factor the variable and apply new `labels`.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nemail$my_new_number <- factor(email$number, \n                              labels=c( \"None\", \"<1M\",\"1M+\"))\ntable(email$number, email$my_new_number, useNA=\"always\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n       \n        None  <1M  1M+ <NA>\n  none   549    0    0    0\n  small    0 2827    0    0\n  big      0    0  545    0\n  <NA>     0    0    0    0\n```\n\n\n:::\n:::\n\n\n\n\n## `forcats`\n\nUse the `fct_recode(\"NEW\" = \"old\")` function here.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nemail$my_forcats_number <- fct_recode(email$number, \n                                      \"BIG\" = \"big\", \n                                      \"NONE\" = \"none\", \n                                      \"SMALL\" = \"small\")\n\ntable(email$number, email$my_forcats_number, useNA=\"always\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n       \n        NONE SMALL  BIG <NA>\n  none   549     0    0    0\n  small    0  2827    0    0\n  big      0     0  545    0\n  <NA>     0     0    0    0\n```\n\n\n:::\n:::\n\n\n\n:::\n\n\nThe `big` factor is now labeled `1M+`, `none` is named `None`, and `small` is `<1M`.\n\n## Factor ordering \n\n:::{.callout-warning icon=false appearance=minimal}\nNo lesson video\n:::\n\nLet's look back at the variable `restaurant` from the fast food (`ff`) data set. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlevels(ff$restaurant)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Arbys\"       \"Burger King\" \"Chick Fil-A\" \"Dairy Queen\" \"Mcdonalds\"  \n[6] \"Sonic\"       \"Subway\"      \"Taco Bell\"  \n```\n\n\n:::\n:::\n\n\n\n\nR defaults to alphabetical order in other cases, so beware! You may need to correct the ordering for other data sets.\n\nWe need to take control of these factors! We can do that by re-factoring the existing factor variable, but this time specifying the `levels` of the factor (since it already has labels). Say we decide to order the restaraunts by putting all the places that sell burgers together. \n\n> Original Order: Arbys, Burger King, Chick Fil-A, Dairy Queen, Mcdonalds, Sonic, Subway, Taco Bell\n> \n> Desired Order: Arbys, Burger King, Dairy Queen, Mcdonalds, Sonic, Chick Fil-A, Subway, Taco Bell\n\n[Since I did not use the assignment operator (`<-`) here, these changes were not made to the variable in the `ff` data set. The examples below demonstrate making an adjustmet to a factor variable and saving that adjustment as a new variable in the data set.]{.aside}\n\n::: {.panel-tabset}\n## Base R\n\nUse the `factor` function again, and write out **each** factor level in the desired order. Make sure you are spelling each level correctly. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# results not saved\nfactor(ff$restaurant, \n       levels=c(\"Arbys\", \"Burger King\", \"Dairy Queen\", \"Mcdonalds\", \"Sonic\", \n                \"Chick Fil-A\", \"Subway\", \"Taco Bell\")) |> \n  table()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n      Arbys Burger King Dairy Queen   Mcdonalds       Sonic Chick Fil-A \n         55          70          42          57          53          27 \n     Subway   Taco Bell \n         96         115 \n```\n\n\n:::\n:::\n\n\n\n\n## `forcats`\nUsing the `fct_relevel` function, you only need to specifiy the levels that you want to move. \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# results not saved\nff$restaurant |> \n  fct_relevel(\"Arbys\", \"Burger King\", \"Dairy Queen\", \"Mcdonalds\", \"Sonic\") |> \n  fct_count() # new function - acts like table\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 8 Ã— 2\n  f               n\n  <fct>       <int>\n1 Arbys          55\n2 Burger King    70\n3 Dairy Queen    42\n4 Mcdonalds      57\n5 Sonic          53\n6 Chick Fil-A    27\n7 Subway         96\n8 Taco Bell     115\n```\n\n\n:::\n:::\n\n\n\n\n\nThe `fct_relevel` function has nice shortcuts as well for example to keep the rest of the ordering but only one or two items. See `?fct_relevel` for other options. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nff$restaurant |> \n  fct_relevel(\"Subway\", after = Inf) |> # move to end\n  fct_relevel(\"Taco Bell\") |> # move to front\n  levels()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Taco Bell\"   \"Arbys\"       \"Burger King\" \"Chick Fil-A\" \"Dairy Queen\"\n[6] \"Mcdonalds\"   \"Sonic\"       \"Subway\"     \n```\n\n\n:::\n:::\n\n\n\n:::\n\n\n\n\n## Decreasing number of levels \n\n:::{.callout-warning icon=false appearance=minimal}\nNo Video\n:::\n\nFor analysis purposes, sometimes you want to work with a smaller number of factor variables. Let's look at the restaurants that are included in the `fastfood` data set.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntable(ff$restaurant)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n      Arbys Burger King Chick Fil-A Dairy Queen   Mcdonalds       Sonic \n         55          70          27          42          57          53 \n     Subway   Taco Bell \n         96         115 \n```\n\n\n:::\n:::\n\n\n\n\n### Combining multiple categories into one \n\nLet's combine all the sandwich, and burger joints together. I am going to save this new variable as `restaurant_new`.\n\nThe syntax for the `fct_collapse` function is `new level` = `\"old level\"`, where the \"old level\" is in quotes. As always, it is good practice to create a two way table to make sure the code typed does what we expected it to do.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nff$restaurant_new <- fct_collapse(ff$restaurant, \n                                    BurgerJoint = c(\"Burger King\", \"Mcdonalds\", \"Sonic\"), \n                                    Sandwich = c(\"Arbys\", \"Subway\"))\n\ntable(ff$restaurant, ff$restaurant_new, useNA=\"always\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n             \n              Sandwich BurgerJoint Chick Fil-A Dairy Queen Taco Bell <NA>\n  Arbys             55           0           0           0         0    0\n  Burger King        0          70           0           0         0    0\n  Chick Fil-A        0           0          27           0         0    0\n  Dairy Queen        0           0           0          42         0    0\n  Mcdonalds          0          57           0           0         0    0\n  Sonic              0          53           0           0         0    0\n  Subway            96           0           0           0         0    0\n  Taco Bell          0           0           0           0       115    0\n  <NA>               0           0           0           0         0    0\n```\n\n\n:::\n:::\n\n\n\n\n### Keeping the most frequent categories\n\nSometimes we only want to keep the most frequent categories and then lump uncommon factor together levels into \"other\". The `fct_lump_n` function \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfct_lump_n(ff$restaurant, n=5) |>\n  fct_count()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 Ã— 2\n  f               n\n  <fct>       <int>\n1 Arbys          55\n2 Burger King    70\n3 Mcdonalds      57\n4 Subway         96\n5 Taco Bell     115\n6 Other         122\n```\n\n\n:::\n:::\n\n\n\n\n\n### Removing categories entirely\n\n:::{.callout-warning icon=false appearance=minimal}\n<a href=\"https://media.csuchico.edu/media/MATH+130+-+Lecture+06A+Removing+Factor+Levels/1_dv1a8kgh\" target=\"_blank\">Lesson Video</a>\n:::\n\nSometimes, you don't even want to consider certain levels. This often occurs in survey data where the respondent provides an answer of \"Refuse to answer\" or the data is coded as the word \"missing\". The word \"missing' is fundamentally different than the `NA` code for a missing value.\n\nFor demonstration purposes, let's get rid of the data from DQ. Who eats something other than ice cream at that place anyhow?\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nff$restaurant[ff$restaurant == \"Dairy Queen\"] <- NA\ntable(ff$restaurant)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n      Arbys Burger King Chick Fil-A Dairy Queen   Mcdonalds       Sonic \n         55          70          27           0          57          53 \n     Subway   Taco Bell \n         96         115 \n```\n\n\n:::\n:::\n\n\n\n\nEven though there are no records with the level `Dairy Queen`, the level itself still is there. R does not assume just because there are no records with that level, that the named level itself should be removed. We use the function `fct_drop` to drop the levels with no records.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nff$restaurant <- fct_drop(ff$restaurant)\ntable(ff$restaurant)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n      Arbys Burger King Chick Fil-A   Mcdonalds       Sonic      Subway \n         55          70          27          57          53          96 \n  Taco Bell \n        115 \n```\n\n\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
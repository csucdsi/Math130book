% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
\PassOptionsToPackage{dvipsnames,svgnames,x11names}{xcolor}
%
\documentclass[
  letterpaper,
  DIV=11,
  numbers=noendperiod]{scrreprt}

\usepackage{amsmath,amssymb}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{lmodern}
\ifPDFTeX\else  
    % xetex/luatex font selection
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\setlength{\emergencystretch}{3em} % prevent overfull lines
\setcounter{secnumdepth}{5}
% Make \paragraph and \subparagraph free-standing
\makeatletter
\ifx\paragraph\undefined\else
  \let\oldparagraph\paragraph
  \renewcommand{\paragraph}{
    \@ifstar
      \xxxParagraphStar
      \xxxParagraphNoStar
  }
  \newcommand{\xxxParagraphStar}[1]{\oldparagraph*{#1}\mbox{}}
  \newcommand{\xxxParagraphNoStar}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
  \let\oldsubparagraph\subparagraph
  \renewcommand{\subparagraph}{
    \@ifstar
      \xxxSubParagraphStar
      \xxxSubParagraphNoStar
  }
  \newcommand{\xxxSubParagraphStar}[1]{\oldsubparagraph*{#1}\mbox{}}
  \newcommand{\xxxSubParagraphNoStar}[1]{\oldsubparagraph{#1}\mbox{}}
\fi
\makeatother

\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{241,243,245}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.40,0.45,0.13}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\BuiltInTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\ExtensionTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.28,0.35,0.67}{#1}}
\newcommand{\ImportTok}[1]{\textcolor[rgb]{0.00,0.46,0.62}{#1}}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\RegionMarkerTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.07,0.07,0.07}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}

\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\newsavebox\pandoc@box
\newcommand*\pandocbounded[1]{% scales image to fit in text height/width
  \sbox\pandoc@box{#1}%
  \Gscale@div\@tempa{\textheight}{\dimexpr\ht\pandoc@box+\dp\pandoc@box\relax}%
  \Gscale@div\@tempb{\linewidth}{\wd\pandoc@box}%
  \ifdim\@tempb\p@<\@tempa\p@\let\@tempa\@tempb\fi% select the smaller of both
  \ifdim\@tempa\p@<\p@\scalebox{\@tempa}{\usebox\pandoc@box}%
  \else\usebox{\pandoc@box}%
  \fi%
}
% Set default figure placement to htbp
\def\fps@figure{htbp}
\makeatother

\KOMAoption{captions}{tableheading}
\makeatletter
\@ifpackageloaded{tcolorbox}{}{\usepackage[skins,breakable]{tcolorbox}}
\@ifpackageloaded{fontawesome5}{}{\usepackage{fontawesome5}}
\definecolor{quarto-callout-color}{HTML}{909090}
\definecolor{quarto-callout-note-color}{HTML}{0758E5}
\definecolor{quarto-callout-important-color}{HTML}{CC1914}
\definecolor{quarto-callout-warning-color}{HTML}{EB9113}
\definecolor{quarto-callout-tip-color}{HTML}{00A047}
\definecolor{quarto-callout-caution-color}{HTML}{FC5300}
\definecolor{quarto-callout-color-frame}{HTML}{acacac}
\definecolor{quarto-callout-note-color-frame}{HTML}{4582ec}
\definecolor{quarto-callout-important-color-frame}{HTML}{d9534f}
\definecolor{quarto-callout-warning-color-frame}{HTML}{f0ad4e}
\definecolor{quarto-callout-tip-color-frame}{HTML}{02b875}
\definecolor{quarto-callout-caution-color-frame}{HTML}{fd7e14}
\makeatother
\makeatletter
\@ifpackageloaded{bookmark}{}{\usepackage{bookmark}}
\makeatother
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\AtBeginDocument{%
\ifdefined\contentsname
  \renewcommand*\contentsname{Table of contents}
\else
  \newcommand\contentsname{Table of contents}
\fi
\ifdefined\listfigurename
  \renewcommand*\listfigurename{List of Figures}
\else
  \newcommand\listfigurename{List of Figures}
\fi
\ifdefined\listtablename
  \renewcommand*\listtablename{List of Tables}
\else
  \newcommand\listtablename{List of Tables}
\fi
\ifdefined\figurename
  \renewcommand*\figurename{Figure}
\else
  \newcommand\figurename{Figure}
\fi
\ifdefined\tablename
  \renewcommand*\tablename{Table}
\else
  \newcommand\tablename{Table}
\fi
}
\@ifpackageloaded{float}{}{\usepackage{float}}
\floatstyle{ruled}
\@ifundefined{c@chapter}{\newfloat{codelisting}{h}{lop}}{\newfloat{codelisting}{h}{lop}[chapter]}
\floatname{codelisting}{Listing}
\newcommand*\listoflistings{\listof{codelisting}{List of Listings}}
\makeatother
\makeatletter
\makeatother
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\@ifpackageloaded{subcaption}{}{\usepackage{subcaption}}
\makeatother

\usepackage{bookmark}

\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same} % disable monospaced font for URLs
\hypersetup{
  pdftitle={Introduction to R},
  pdfauthor={Donatello, Roualdes, Lytal, Guo},
  colorlinks=true,
  linkcolor={blue},
  filecolor={Maroon},
  citecolor={Blue},
  urlcolor={Blue},
  pdfcreator={LaTeX via pandoc}}


\title{Introduction to R}
\author{Donatello, Roualdes, Lytal, Guo}
\date{2025-01-01}

\begin{document}
\maketitle

\renewcommand*\contentsname{Table of contents}
{
\hypersetup{linkcolor=}
\setcounter{tocdepth}{2}
\tableofcontents
}

\bookmarksetup{startatroot}

\chapter*{Preface \& Course Overview}\label{preface-course-overview}
\addcontentsline{toc}{chapter}{Preface \& Course Overview}

\markboth{Preface \& Course Overview}{Preface \& Course Overview}

This notebook was created to host learning materials for Math 130:
Introduction to R at California State University, Chico.

Math 130 is designed as a short-course ``primer'' to be taken before, or
concurrently with, an upper division or graduate level Statistics course
such as Math 315 or Math 615.

The goal of Math 130 is to get the complete novice up and running with
the basic knowledge of how to use the statistical programming language R
in an environment that emphasizes reproducible research and literate
programming for data analysis. We recognize there are many topics and
many approaches to teach an introduction to the R programming language.
We have picked specific topics and methods that we believe learners will
need to succeed in subsequent classes.

The target audience is anyone who wants to do their own data analysis.
The course will culminate with an exploratory data analysis on either a
pre-specified data set or your data set of choice.

\section*{Logistics}\label{logistics}
\addcontentsline{toc}{section}{Logistics}

\markright{Logistics}

This course may be offered as in person or (a)synchronous online.
Regardless of the mode of instruction, all learning materials are found
on this website. Class time (when applicable) is spent expanding on
ideas and concepts, working through assignments as a class or in pairs.

The logistics of the course varies slightly by instructor and mode of
instruction. See below for your specific section.

\section*{Syllabus for current term}\label{syllabus-for-current-term}
\addcontentsline{toc}{section}{Syllabus for current term}

\markright{Syllabus for current term}

\begin{itemize}
\tightlist
\item
  \href{syllabus.html}{HTML webpage}
\item
  \href{syllabus.pdf}{Downloadable PDF}
\end{itemize}

\begin{quote}
move these to sub folder
\end{quote}

\begin{itemize}
\tightlist
\item
  \href{slides/00_welcome_rad.html}{Fall 2025 Dr.~Donatello - In person}
\end{itemize}

\begin{quote}
where to put discord \& common help?
\end{quote}

\section*{Navigating this notebook}\label{navigating-this-notebook}
\addcontentsline{toc}{section}{Navigating this notebook}

\markright{Navigating this notebook}

Throughout this notebook you will see various colored callout boxes,
weirdly highlighted text, and emojis. Here is what each of those mean.

\begin{tcolorbox}[enhanced jigsaw, arc=.35mm, titlerule=0mm, left=2mm, bottomrule=.15mm, bottomtitle=1mm, opacitybacktitle=0.6, colbacktitle=quarto-callout-note-color!10!white, colback=white, breakable, opacityback=0, colframe=quarto-callout-note-color-frame, toptitle=1mm, title=\textcolor{quarto-callout-note-color}{\faInfo}\hspace{0.5em}{blue boxes}, rightrule=.15mm, toprule=.15mm, leftrule=.75mm, coltitle=black]

Blue boxes are simple notes or pieces of information for you to
consider. Examples include lesson learning objectives.

\end{tcolorbox}

\begin{tcolorbox}[enhanced jigsaw, arc=.35mm, titlerule=0mm, left=2mm, bottomrule=.15mm, bottomtitle=1mm, opacitybacktitle=0.6, colbacktitle=quarto-callout-caution-color!10!white, colback=white, breakable, opacityback=0, colframe=quarto-callout-caution-color-frame, toptitle=1mm, title=\textcolor{quarto-callout-caution-color}{\faFire}\hspace{0.5em}{yellow boxes}, rightrule=.15mm, toprule=.15mm, leftrule=.75mm, coltitle=black]

means caution

\end{tcolorbox}

\begin{tcolorbox}[enhanced jigsaw, arc=.35mm, titlerule=0mm, left=2mm, bottomrule=.15mm, bottomtitle=1mm, opacitybacktitle=0.6, colbacktitle=quarto-callout-tip-color!10!white, colback=white, breakable, opacityback=0, colframe=quarto-callout-tip-color-frame, toptitle=1mm, title=\textcolor{quarto-callout-tip-color}{\faLightbulb}\hspace{0.5em}{green box}, rightrule=.15mm, toprule=.15mm, leftrule=.75mm, coltitle=black]

is a tip or an example

\end{tcolorbox}

\begin{tcolorbox}[enhanced jigsaw, arc=.35mm, titlerule=0mm, left=2mm, bottomrule=.15mm, bottomtitle=1mm, opacitybacktitle=0.6, colbacktitle=quarto-callout-important-color!10!white, colback=white, breakable, opacityback=0, colframe=quarto-callout-important-color-frame, toptitle=1mm, title=\textcolor{quarto-callout-important-color}{\faExclamation}\hspace{0.5em}{red box}, rightrule=.15mm, toprule=.15mm, leftrule=.75mm, coltitle=black]

Red boxes are warnings or advice on what \emph{not} to do.

\end{tcolorbox}

\begin{itemize}
\tightlist
\item
  :cinema: associated video
\item
  :pencil2: You try it
\item
  :x: Don't do this thing
\end{itemize}

\section*{Motivation - Tool choices}\label{motivation---tool-choices}
\addcontentsline{toc}{section}{Motivation - Tool choices}

\markright{Motivation - Tool choices}

\subsection*{R + R Studio = Success}\label{r-r-studio-success}
\addcontentsline{toc}{subsection}{R + R Studio = Success}

\begin{itemize}
\item
  The term \textbf{R} refers to both the programming language and the
  software that interprets the scripts written using it.
\item
  \textbf{RStudio} is currently a very popular way to not only write
  your R scripts but also to interact with the R software.
\item
  We will be programming in the R language, using the R Studio platform.
  You will have to install both onto your computer. Setup instructions
  are discussed later in section \texttt{FIXME}
\end{itemize}

\subsection*{Why use R?}\label{why-use-r}
\addcontentsline{toc}{subsection}{Why use R?}

\begin{itemize}
\tightlist
\item
  Open source, cross-platform, and free
\item
  Great for reproducibility
\item
  Flexible and extensible. Doesn't do something you want? Create a
  custom function for yourself.
\item
  Tons of learning resources
\item
  Currently R is used in all of Chico's upper division Statistics \&
  Data Science courses, as well as in some Science, Public Health,
  Economics, Finance, and some graduate courses.
\item
  Does not involve lots of pointing and clicking (that's a good thing!)
\item
  Works on data of all shapes and sizes
\item
  Produces high-quality graphics
\item
  Large and welcoming community
\end{itemize}

\subsection*{Why use R Studio?}\label{why-use-r-studio}
\addcontentsline{toc}{subsection}{Why use R Studio?}

\begin{itemize}
\tightlist
\item
  Customizable workspace that docks all windows together.
\item
  Notebook formats that allow for easy sharing of code and output, and
  integration with other languages (Python, C++, SQL, Stan)
\item
  Syntax highlighting, warning errors when missing a closing
  parentheses.
\item
  Cross-platform interface. Also works on Windows/iOS/Linux.
\item
  Tab completion for functions. Forget the syntax or a variable name?
  Popup helpers are available.
\item
  Free training videos available from the developers directly.
\item
  One button publishing of reproducible documents such as reports,
  interactive visualizations, presentations (like this one!), websites.
\end{itemize}

\subsection*{make this side by side and add appropriate alt
text}\label{make-this-side-by-side-and-add-appropriate-alt-text}
\addcontentsline{toc}{subsection}{make this side by side and add
appropriate alt text}

\includegraphics[width=2.60417in,height=\textheight,keepaspectratio]{img/r-manual.jpeg}\hfill
\hfill
\includegraphics[width=2.60417in,height=\textheight,keepaspectratio]{img/r-automatic.jpeg}

Left photo credit; Right photo credit. Entire figure credit: Data
Carpentry R for Social Scientists.

\begin{quote}
check this link
\end{quote}

\href{https://rmarkdown.rstudio.com/gallery.html}{Examples of things you
can do in RStudio}

\section*{Programming is scary!}\label{programming-is-scary}
\addcontentsline{toc}{section}{Programming is scary!}

\markright{Programming is scary!}

\includegraphics[width=4.19792in,height=\textheight,keepaspectratio]{img/hard.JPG}

\begin{quote}
check links
\end{quote}

Learning to program has other benefits

\begin{itemize}
\tightlist
\item
  Improves your logical skills and critical problem solving
\item
  Increases your attention to detail
\item
  Increases your self reliance and empowers you to control your own
  research.
\item
  Your PI will love your awesome graphics and reports.
\item
  Some people think what you do is magic.
\item
  Thinking graduate school?
  \href{http://www.nature.com/nature/journal/v541/n7638/full/nj7638-563a.html}{{[}expect
  to learn this on your own{]}}
\item
  \href{https://skillcrush.com/2015/01/28/laurence-bradford-10-reasons/}{{[}A
  few{]}}
  \href{https://careerfoundry.com/en/blog/web-development/7-benefits-of-learning-to-code/}{{[}other
  lists{]}}
  \href{https://skillcrush.com/2017/01/30/learn-to-code-benefits/}{{[}of
  reasons{]}}
\end{itemize}

\subsection*{Why no point and click?}\label{why-no-point-and-click}
\addcontentsline{toc}{subsection}{Why no point and click?}

Because it's not reproducible.

\begin{itemize}
\tightlist
\item
  Which boxes did you click last time?
\item
  New data? Gotta do it all over.
\item
  Need to expand your model? Gotta do it all over.
\item
  Made a mistake in the data coding? Gotta do it all over\ldots{}
\end{itemize}

\section*{References}\label{references}
\addcontentsline{toc}{section}{References}

\markright{References}

Some of this material presented is a derivation from work that is
Copyright Â© Software Carpentry (http://software-carpentry.org/) which is
under a \href{https://creativecommons.org/licenses/by/4.0/}{CC BY 4.0
license} which allows for adaptations and reuse of the work.

\part{Introduction to your new tools}

\chapter{Your New Tools}\label{your-new-tools}

\begin{quote}
update obj
\end{quote}

\begin{tcolorbox}[enhanced jigsaw, arc=.35mm, titlerule=0mm, left=2mm, bottomrule=.15mm, bottomtitle=1mm, opacitybacktitle=0.6, colbacktitle=quarto-callout-note-color!10!white, colback=white, breakable, opacityback=0, colframe=quarto-callout-note-color-frame, toptitle=1mm, title=\textcolor{quarto-callout-note-color}{\faInfo}\hspace{0.5em}{Learning Objectives}, rightrule=.15mm, toprule=.15mm, leftrule=.75mm, coltitle=black]

After completing this lesson learners will be able to:

\begin{itemize}
\tightlist
\item
  Use R and R Studio on their personal computer.
\item
  Describe the purpose of the RStudio Script, Console, Environment, and
  Plots panes.
\item
  Organize files and directories for a set of analyses as an R Project,
  and understand the purpose of the working directory.
\item
  Execute simple commands in the console
\item
  Use the built-in RStudio help interface to search for more information
  on R functions.
\item
  Demonstrate how to provide sufficient information for troubleshooting
  with the R user community.
\end{itemize}

\end{tcolorbox}

\section{Setup your class folder for success!
:cinema:}\label{setup-your-class-folder-for-success-cinema}

\begin{quote}
link to chapter video?
\end{quote}

Using a consistent folder structure across your projects will help keep
things organized, and will also make it easy to find/file things in the
future. This can be especially helpful when you have multiple projects.

\subsection{Naming Things}\label{naming-things}

You also need to choose a naming convention for your class folder and
stick with it. Recommended options are:

\begin{itemize}
\tightlist
\item
  ALL CAPS (\texttt{MATH130})\\
\item
  no caps (\texttt{math130})
\item
  snake\_case (\texttt{math\_130})
\item
  CamelCase (\texttt{Math130})
\end{itemize}

\subsection{Create Folders}\label{create-folders}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  On your computer, in an easy to find place, create a new folder named
  \texttt{math130}.
\item
  Then create three subfolders: \texttt{data}, \texttt{homework},
  \texttt{notes}.\\
  \begin{center}
  \includegraphics[width=1.55208in,height=\textheight,keepaspectratio]{img/folder_org.PNG}
  \end{center}
\end{enumerate}

\subsection{Adding files into your class
folder}\label{adding-files-into-your-class-folder}

When you download a file, right click and ``Save as'' or ``Save target
as'' and \textbf{actively choose} where to download this file.

:x: Do not let files live in your downloads folder.

:x: Do not open any files from your browser window after downloading.

:pencil2: Right click \href{../hw/hw1.Rmd}{{[}this link{]}} to download
and save Assignment 1 into your \texttt{homework} folder now.

\begin{quote}
need to fix hw1 link loc and qmd
\end{quote}

:cinema: \href{https://youtu.be/ayar0LFRg0U}{Windows video walk
through.}

\begin{quote}
to what?
\end{quote}

\section{Installing R and R Studio}\label{installing-r-and-r-studio}

\subsection{Tablet and Chromebook
users}\label{tablet-and-chromebook-users}

If you are using a tablet, Chromebook or otherwise do not have a
computer that you can install programs on, you can use Posit Cloud for
this class.

\begin{itemize}
\tightlist
\item
  Make a \textbf{Cloud FREE} account at https://posit.cloud/plans/free
\item
  Start a new project by clicking on the button in the top right corner
\item
  Then go to \hyperref[intro_rstudio]{slide \#6} to learn how to
  navigate RStudio.
\end{itemize}

The free account allows for 25 project hours/month, which may not be
enough for this class. If you run into time limits or you are using this
for another class you will have to upgrade to the \textbf{Cloud Student}
plan which is \$5/month.

Using the cloud is easier to initially setup, but having your own
installation on your computer ensures that

\begin{itemize}
\tightlist
\item
  you want to keep the program free forever
\item
  you will be able to put your files under version control
\item
  you always have access to your code even with unstable or no internet
\end{itemize}

\section{Download and install R}\label{download-and-install-r}

\begin{center}
\includegraphics[width=1.55208in,height=\textheight,keepaspectratio]{img/R.png}
\end{center}

\subsection{Step 1: Download R v 4.5+}\label{step-1-download-r-v-4.5}

\begin{itemize}
\tightlist
\item
  Windows 10 https://cran.r-project.org/bin/windows/base/
\item
  Mac OS X page - https://cran.r-project.org/bin/macosx/

  \begin{itemize}
  \tightlist
  \item
    First link under ``Latest Release'' and looks like
    \textbf{R-4.5.0.pkg}.
  \item
    :warning: You may later get a message about needing \emph{X11} or
    \emph{XQuartz}. The download for that program is also on this page.
    (Mac only)
  \end{itemize}
\item
  Choose to save the file, do not open or run.
\end{itemize}

\subsection{Step 2: Install R}\label{step-2-install-r}

\begin{itemize}
\tightlist
\item
  Install R by double clicking on the downloaded file and following the
  prompts.

  \begin{itemize}
  \tightlist
  \item
    Default settings are OK.
  \item
    Delete any desktop shortcuts that was created (looks like the icon
    above.)
  \end{itemize}
\end{itemize}

\begin{tcolorbox}[enhanced jigsaw, arc=.35mm, titlerule=0mm, left=2mm, bottomrule=.15mm, bottomtitle=1mm, opacitybacktitle=0.6, colbacktitle=quarto-callout-important-color!10!white, colback=white, breakable, opacityback=0, colframe=quarto-callout-important-color-frame, toptitle=1mm, title=\textcolor{quarto-callout-important-color}{\faExclamation}\hspace{0.5em}{ðŸŽ¦ Video Tutorials for both R and R Studio.}, rightrule=.15mm, toprule=.15mm, leftrule=.75mm, coltitle=black]

\begin{itemize}
\tightlist
\item
  \href{https://youtu.be/KAeHFzxbHTA?si=xpeDGqt7gurg_rFR}{Windows}
\item
  \href{https://youtu.be/ay25o485YXs?si=7r4qmmvtD15RM_eS}{Mac}
\end{itemize}

\end{tcolorbox}

\section{Download and install R
Studio}\label{download-and-install-r-studio}

\begin{center}
\includegraphics[width=1.55208in,height=\textheight,keepaspectratio]{img/RStudio.png}
\end{center}

\subsection{Step 1: Download the most recent version
from}\label{step-1-download-the-most-recent-version-from}

\begin{itemize}
\tightlist
\item
  \url{https://posit.co/download/rstudio-desktop/}
\item
  Your operating system should be automatically detected. If not, scroll
  down and choose your version.
\end{itemize}

\subsection{Install the program}\label{install-the-program}

\begin{itemize}
\tightlist
\item
  Windows: Double click on the downloaded file to run the installer
  program.
\item
  Mac: Double click on the downloaded file, then drag the R Studio Icon
  into your Applications folder.

  \begin{itemize}
  \tightlist
  \item
    After you are done, eject the ``Drive'' that you downloaded by
    dragging the icon to your trash.
  \end{itemize}
\end{itemize}

\section{Navigating R Studio}\label{navigating-r-studio}

We will be interacting with the programming language R \emph{only}
through R Studio. Not by itself. There are four panes, or windows, in R
Studio.

\begin{quote}
update to newest carpentry instructions
\end{quote}

\begin{tcolorbox}[enhanced jigsaw, arc=.35mm, titlerule=0mm, left=2mm, bottomrule=.15mm, bottomtitle=1mm, opacitybacktitle=0.6, colbacktitle=quarto-callout-caution-color!10!white, colback=white, breakable, opacityback=0, colframe=quarto-callout-caution-color-frame, toptitle=1mm, title=\textcolor{quarto-callout-caution-color}{\faFire}\hspace{0.5em}{yellow for videos?}, rightrule=.15mm, toprule=.15mm, leftrule=.75mm, coltitle=black]

ðŸŽ¦ Watch one of the following short videos to learn how to navigate R
Studio.

\begin{itemize}
\tightlist
\item
  \href{https://youtu.be/vx4SPeNvols?si=1iSqsH1uNLFkB7yF&t=239}{R Girls
  on YouTube}
\item
  \href{https://media.csuchico.edu/media/t/1_93i6jwy8}{Dr.~D's overview}
\end{itemize}

\end{tcolorbox}

\subsection{Setting preferences in R
Studio}\label{setting-preferences-in-r-studio}

AKA: Retain sanity while troubleshooting

\begin{quote}
side by side/text image
\end{quote}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Open R Studio and go to the file menu go to \emph{Tools} then
  \emph{Global Options}.
\item
  Uncheck ``Restore .RData into workspace at startup''
\item
  Where it says ``Save workspace to .RData on exit:'' Select
  ``Never''\,''
\item
  Click apply then ok to close that window.
\end{enumerate}

This will ensure that when you restart R you do not ``carry forward''
objects such as data sets that you were working on in a prior
assignment.

To effectively restart R, go to the file menu and click \emph{Session} ,
then ``Restart R'', or ``Restart R and clear output''. :cinema:
\href{https://youtu.be/49u5xAYfrgk}{Link to video walk through}

\chapter{Programming with R}\label{programming-with-r}

\begin{quote}
write objectives
\end{quote}

\section{Terminology}\label{terminology}

The basis of programming is that we write down instructions for the
computer to follow, and then we tell the computer to follow those
instructions.

We write, or \emph{code}, instructions in R because it is a common
language that both the computer and we can understand.

We call the instructions \emph{commands} and we tell the computer to
follow the instructions by \emph{executing} (also called \emph{running})
those commands.

The \textbf{console} pane is the place where commands written in the R
language can be typed and executed immediately by the computer. It is
also where the results will be shown for commands that have been
executed.

You can type commands directly into the console and press \texttt{Enter}
to execute those commands, but they will be forgotten when you close the
session.

\section{Code appearance}\label{code-appearance}

In these notes, code is displayed like this:

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{2}\SpecialCharTok{+}\DecValTok{2}
\end{Highlighting}
\end{Shaded}

where the output or result of the code is displayed with two pound signs
(\texttt{\#\#})

\section{R is an overgrown
calculator}\label{r-is-an-overgrown-calculator}

\begin{quote}
can I use webR for this page?
\end{quote}

:pencil: In the console type the following code, then press
\texttt{Enter}.

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{2}\SpecialCharTok{+}\DecValTok{2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 4
\end{verbatim}

Now try a more complicated equation.

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{2} \SpecialCharTok{+} \DecValTok{5}\SpecialCharTok{*}\NormalTok{(}\DecValTok{8}\SpecialCharTok{\^{}}\DecValTok{3}\NormalTok{)}\SpecialCharTok{{-}} \DecValTok{3}\SpecialCharTok{*}\NormalTok{log10}\ErrorTok{)}
\end{Highlighting}
\end{Shaded}

Uh oh, we got an Error. Nothing to worry about, errors happen all the
time.

:pencil: Put a open parenthesis \texttt{(} before \texttt{log10} to fix
it and try again.

\chapter{\textgreater{} R is waiting on
you\ldots{}}\label{r-is-waiting-on-you}

:pencil: In the console type the following code, then press
\texttt{Enter}.

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{2} \SpecialCharTok{+} \DecValTok{5}\SpecialCharTok{*}\NormalTok{(}\DecValTok{8}\SpecialCharTok{\^{}}\DecValTok{3}\NormalTok{)}\SpecialCharTok{{-}} \DecValTok{3}\SpecialCharTok{*}\FunctionTok{log}\NormalTok{(}\DecValTok{10}
\end{Highlighting}
\end{Shaded}

Notice the console shows a \texttt{+} prompt. This means that you
haven't finished entering a complete command.

This is because you have not `closed' a parenthesis or quotation,
i.e.~you don't have the same number of left-parentheses as
right-parentheses, or the same number of opening and closing quotation
marks.

When this happens, and you thought you finished typing your command,
click inside the console window and press \texttt{Esc}; this will cancel
the incomplete command and return you to the \texttt{\textgreater{}}
prompt.

\section{Packages}\label{packages}

\href{https://spaceballs.fandom.com/wiki/Spaceballs:_The\%E2\%80\%A6}{\_``Where
the real money from the movie is made.\_''}

R is considered an \textbf{Open Source} software program. That means
many (thousands) of people contribute to the software. They do this by
writing commands (called functions) to make a particular analysis
easier, or to make a graphic prettier.

When you download R, you get access to a lot of functions that we will
use. However these other \emph{user-written} packages add so much good
stuff that it really is the backbone of the customizability and
functionality that makes R so powerful of a language.

For example we will be creating graphics using functions like
\texttt{boxplot()} and \texttt{hist()} that exist in base R. But we will
quickly move on to creating graphics using functions contained in the
\texttt{ggplot2} package. We will be managing data using functions in
\texttt{dplyr} and reading in Excel files using \texttt{readxl}.
Installing packages will become your favorite past-time.

\section{Installing Packages}\label{installing-packages}

:pencil: Start by typing the following in the console to install the
\texttt{ggplot2} package.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install.packages}\NormalTok{(}\StringTok{"ggplot2"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

When the download and install is complete, you should see a message
simliar to:

\begin{verbatim}
The downloaded binary packages are in
    C:\Users\Robin\AppData\Local\Temp\Rtmpi8NAym\downloaded_packages
\end{verbatim}

:warning: R is case sensitive and spelling matters. If you get an error
message like the following:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Warning }\ControlFlowTok{in}\NormalTok{ install.packages }\SpecialCharTok{:}
\NormalTok{  package â€˜ggplotâ€™ is not }\FunctionTok{available}\NormalTok{ (}\ControlFlowTok{for}\NormalTok{ R version }\DecValTok{3}\NormalTok{.}\FloatTok{5.1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

The correct package name is \texttt{ggplot2}, not \texttt{ggplot}.

\begin{tcolorbox}[enhanced jigsaw, arc=.35mm, titlerule=0mm, left=2mm, bottomrule=.15mm, bottomtitle=1mm, opacitybacktitle=0.6, colbacktitle=quarto-callout-caution-color!10!white, colback=white, breakable, opacityback=0, colframe=quarto-callout-caution-color-frame, toptitle=1mm, title=\textcolor{quarto-callout-caution-color}{\faFire}\hspace{0.5em}{Caution}, rightrule=.15mm, toprule=.15mm, leftrule=.75mm, coltitle=black]

\textbf{Alternative Method of installing Packages:}\\
Use the Package tab in the lower right pane in R Studio.

\end{tcolorbox}

\section{Install all the things!}\label{install-all-the-things}

Now that you're a package installing pro, go ahead and install the
following packages that we will be using in the next few weeks.

\begin{quote}
set as two columns
\end{quote}

Install the list of packages to the left one at a time and wait for it
to finish before entering the next command.

\begin{itemize}
\tightlist
\item
  \texttt{tidyverse}
\item
  \texttt{rmarkdown}
\item
  \texttt{openintro}
\item
  \texttt{tinytex}
\end{itemize}

\section{Download and Install
TinyTex}\label{download-and-install-tinytex}

To convert your work into a professional looking PDF, or to write math
symbols in your homework, or you need a typesetting program called
\(\LaTeX\) (pronounced ``lay-tek'' or ``lah-tex''). It's a super neat
program, but also nearly 4Gb. Too big for our needs. That's where the
\texttt{tinytex} package came from. we're going to use it to install a
lightweight version of \(\LaTeX\). This will let us write math equations
in R Markdown, and create PDF's of your homework.

In your console type the following and hit \textbf{Enter}

\begin{verbatim}
tinytex::install_tinytex()
\end{verbatim}

This may take a few minutes, but then you're good to go!

\section{Seeking Help}\label{seeking-help}

\begin{quote}
help me help you
\end{quote}

\emph{Sometimes a second pair of eyeballs is all you need}

\pandocbounded{\includegraphics[keepaspectratio]{index_files/mediabag/seeking-help-fr-om-o.html}}{]}(img/debugging.jpg)\{fig-align=``center''
width=``149''\}

\emph{Much of this information is also on the \href{../faq.html}{FAQ}
page}

\begin{quote}
still accurate?
\end{quote}

\section{Advice on asking for help}\label{advice-on-asking-for-help}

The key to receiving help from someone is for them to rapidly grasp your
problem. You should make it as easy as possible to pinpoint where the
issue might be.

Try to use the correct words to describe your problem. For instance, a
package is not the same thing as a library. Most people will understand
what you meant, but it can make things confusing for people trying to
help you. Be as precise as possible when describing your problem.

:warning: Don't let not knowing exactly how to describe your problem
prevent you from asking. Screenshots help tremendously!

\textbf{When asking someone for help try to} 1. Explain what thing you
are trying to do 2. Explain/show the code you wrote to try to do that
thing 3. Explain/show your result, and if it's not obvious explain why
you feel it's not the correct result. (E.g. you expected the answer to
be 5, but instead it's 10. )

:warning: Don't spend more than 20 minutes banging your head on the wall
before you ask for help!

\section{Help from inside R Studio}\label{help-from-inside-r-studio}

\subsection{Use the built-in RStudio help interface to search for more
information on R
functions}\label{use-the-built-in-rstudio-help-interface-to-search-for-more-information-on-r-functions}

One of the fastest ways to get help is to use the RStudio help
interface. This panel by default can be found at the lower right hand
panel of RStudio. As seen in the screenshot, by typing the word
\texttt{mean}, RStudio tries to also give a number of suggestions that
you might be interested in. The description is then shown in the display
window.

\subsection{I know the name of the function I want to use, but I'm not
sure how to use
it}\label{i-know-the-name-of-the-function-i-want-to-use-but-im-not-sure-how-to-use-it}

If you need help with a specific function, let's say \texttt{barplot()},
you can type:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{?barplot}
\end{Highlighting}
\end{Shaded}

If you just need to remind yourself of the names of the arguments, you
can use:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{args}\NormalTok{(lm)}
\end{Highlighting}
\end{Shaded}

\subsection{I want to use a function that does X, there must be a
function for it but I don't know which
one\ldots{}}\label{i-want-to-use-a-function-that-does-x-there-must-be-a-function-for-it-but-i-dont-know-which-one}

If you are looking for a function to do a particular task, you can use
the \texttt{help.search()} function, which is called by the double
question mark \texttt{??}. However, this only looks through the
installed packages for help pages with a match to your search request

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{??kruskal}
\end{Highlighting}
\end{Shaded}

If you can't find what you are looking for, you can use the
\href{http://www.rdocumentation.org}{rdocumentation.org} website that
searches through the help files across all packages available.

Finally, a generic Google or internet search ``R
\textless task\textgreater{}'' will often either send you to the
appropriate package documentation or a helpful forum where someone else
has already asked your question.

\subsection{I get an error message that I don't
understand}\label{i-get-an-error-message-that-i-dont-understand}

Start by googling the error message. However, this doesn't always work
very well because often, package developers rely on the error catching
provided by R. You end up with general error messages that might not be
very helpful to diagnose a problem (e.g.~``subscript out of bounds'').
If the message is very generic, you might also include the name of the
function or package you're using in your query.

If you check Stack Overflow, search using the \texttt{{[}r{]}} tag. Most
questions have already been answered, but the challenge is to use the
right words in the search to find the answers:
\url{http://stackoverflow.com/questions/tagged/r}

:warning: Development of R moves pretty fast. When at all possible, use
results from the past 1-2 years. Anything over 5 years old for packages
such as \texttt{ggplot}, \texttt{dplyr}, and \texttt{forcats} are likely
obsolete.

\section{In Person help}\label{in-person-help}

\begin{itemize}
\tightlist
\item
  Start by ask the person sitting next to you! Don't hesitate to talk to
  your neighbor, compare your answers, and ask for help.
\item
  Ask in the Math \& Statistics
  \href{https://discord.gg/ck497bJty5}{Discord server} - we have a
  dedicated channel just for this class but a lot of students in the
  server know how to use R.
\item
  Attend
  \href{https://www.csuchico.edu/datascience/community-coding.shtml}{Community
  Coding}.

  \begin{itemize}
  \tightlist
  \item
    Drop in work session \& dedicated space to work on coding projects.
  \item
    Collaborate with your peers and learn from experts.
  \item
    Some hours are held over Zoom
  \end{itemize}
\end{itemize}

\section{Other Online}\label{other-online}

\begin{itemize}
\tightlist
\item
  In RStudio go to \texttt{Help} --\textgreater{} \texttt{Cheatsheets}
  or to this URL https://posit.co/resources/cheatsheets/
\item
  \href{http://stackoverflow.com/questions/tagged/r}{Stack Overflow}: if
  your question hasn't been answered before and is well crafted, chances
  are you will get an answer in less than 5 min. Remember to follow
  their guidelines on
  \href{http://stackoverflow.com/help/how-to-ask}{how to ask a good
  question}.
\item
  \href{https://groups.google.com/forum/\#!forum/chico-rug}{Chico R
  Users Google Group}.
\item
  The \href{https://forum.posit.co/}{Posit Community}: it is read by a
  lot of people and is welcoming to new users.
\item
  If your question is about a specific package, see if there is a
  mailing list for it. Usually it's included in the DESCRIPTION file of
  the package that can be accessed using
  `packageDescription(``name-of-package:. You may also want to try to
  email the author of the package directly, or open an issue on the code
  repository (e.g., GitHub).
\end{itemize}

\section{Using AI tools}\label{using-ai-tools}

\begin{quote}
write guidance here
\end{quote}

\section{Written}\label{written}

If you're a book kinda person, there is plenty of help available as
well. Many have online versions or free PDF's.

\begin{itemize}
\tightlist
\item
  R Markdown, the Definitive Guide:
  https://bookdown.org/yihui/rmarkdown/
\item
  R for Data Science https://r4ds.had.co.nz/
\item
  Cookbook for R http://www.cookbook-r.com/
\item
  R Graphics Cookbook (I use this all the time) -- Chapter 8 in the
  above link
\item
  The Art of R Programming https://nostarch.com/artofr.htm
\item
  R for\ldots{} http://r4stats.com/

  \begin{itemize}
  \tightlist
  \item
    Excel Users https://www.rforexcelusers.com/
  \item
    SAS and SPSS Users http://r4stats.com/books/r4sas-spss/
  \item
    STATA Users http://r4stats.com/books/r4stata/
  \end{itemize}
\end{itemize}

\chapter{Final Tips}\label{final-tips}

\section{Saving and closing your
work.}\label{saving-and-closing-your-work.}

Unless you're returning to work in R Studio in a short while, you should
make a habit to save all open tabs and completely shut down R studio
when you are done working. This ensures your environment is cleared.
\emph{This is a good thing.}

\section{Restart R}\label{restart-r}

To restart R without shutting the entire window down, go to the file
menu bar in the top,

\begin{quote}
\emph{Session} --\textgreater{} Restart R and Clear Output
\end{quote}

This is good to do when switching between projects/classes.

\chapter{Reproducibility with Quarto}\label{reproducibility-with-quarto}

In this lesson you will learn to write a document using R markdown,
integrate live R code into a literate statistical program, compile R
markdown documents using \texttt{knitr} and related tools, and organize
a data analysis sandbox so that it is reproducible and accessible to
others.

\section{Learning Objectives}\label{learning-objectives-1}

After completing this lesson learners will be able to create a new R
markdown document, identify the components of a R Markdown document, and
explain how R markdown files facilitates sharing of reproducible
research.

\subsection{Pre-requisites}\label{pre-requisites}

\begin{itemize}
\tightlist
\item
  Have R and R Studio installed
\item
  Have the following packages installed: \texttt{rmarkdown}
\end{itemize}

\section{Document structure}\label{document-structure}

R Markdown is an example of literate programming where the explanation
of the program (or analysis) logic is presented in a natural language
(such as English), with supporting pieces of code embedded in the
document itself. R Markdown combines normal text such as this sentence,
code and the output from the code all in one Rmarkdown (\texttt{.Rmd})
file.

The following page lays out the format of an RMarkdown document with
several details included.

\emph{Image credit on next page: Data Visualization by Kieran Healy.
Available at http://socviz.co/}

\section{Components of a R Markdown
document}\label{components-of-a-r-markdown-document}

`../static/img/rmarkdown\_components.png'

\section{Code Chunks}\label{code-chunks}

\begin{itemize}
\item
  Code chunks start with three back ticks (to the left of the 1) and an
  r in braces. Chunks close (end) with another three back ticks. Note
  the background color of this section has changed to a different shade.
  This helps you identify you have closed your code chunk properly.
\item
  You can insert code chunks by using the button in the top right of an
  RMD file (Insert --\textgreater{} R), or by typing
  \texttt{CTRL+ALT+I}.
\item
  Only code goes in code chunks. That's why they're called \textbf{code}
  chunks.

  \begin{itemize}
  \tightlist
  \item
    No normal text.
  \item
    All explanatory text goes outside a code chunk.
  \end{itemize}
\end{itemize}

\section{Test your setup}\label{test-your-setup}

Let's create your first markdown file!

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  In R Studio go to \emph{File} --\textgreater{} \emph{New File}
  --\textgreater{} \emph{R Markdown}
\item
  Title this document \textbf{My First R Markdown Document}, then click
  OK.
\item
  Click the small blue disk icon to save this file into your class
  folder.
\item
  Save this file using the file name \textbf{test\_markdown\_document}.

  \begin{itemize}
  \tightlist
  \item
    File names cannot have spaces or special characters.
  \item
    Do not specify the file type. It will be set automatically.
  \end{itemize}
\item
  Click the \textbf{KNIT} button (has the yarn ball next to it) to
  convert this file into HTML.
\item
  Look at the HTML file that was created. You should be able to match
  the code with the resulting output.
\end{enumerate}

This is what we mean by reproducible. If you make a change in the code
document, and re-knit (aka compile), your changes will be reflected in
the generated document.

If you are asked to install additional packages, go ahead and say yes.
Then go back to \href{02_setup_slides.html}{lesson 02} and make sure you
have all the necessary packages listed.

\section{Make a change}\label{make-a-change}

Play around with modifying the text and the R code.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Change the code from \texttt{summary(cars)} to
  \texttt{summary(iris)}.\\
\item
  Write a sentence below this code chunk. It could be ``Hello world''.
\item
  Add a code chunk and type the equation \texttt{2+2} in the code chunk.
\item
  Re-knit this document and observe your changes.
\end{enumerate}

You are now ready to start the first assignment.

\section{Start Assignment 1}\label{start-assignment-1}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \textbf{Right click} and select \textbf{save as} (or save target as)
  to download \href{../hw/hw1.Rmd}{{[}HW 1.Rmd{]}} code file to your
  class folder.
\item
  Navigate to your class folder and double click to open this file in R
  Studio

  \begin{itemize}
  \tightlist
  \item
    You might have to tell your computer what program to use.
  \item
    Do NOT open this file from your browser window.
  \end{itemize}
\item
  Double click on this file (from your class folder) to open it in R
  studio.
\item
  This \texttt{.Rmd} file is a template for you to use to write your
  assignment. Write your answers directly into this document.
\item
  After you answer each question, knit the file to ensure that your work
  is saved, and that your answers are being correctly displayed in the
  final document.
\end{enumerate}

\section{Additional Resources}\label{additional-resources}

\begin{itemize}
\tightlist
\item
  While the introductory video no longer works, there are additional
  lessons on using R Markdown at the following site:
  http://rmarkdown.rstudio.com/lesson-1.html

  \begin{itemize}
  \tightlist
  \item
    Relevant portions in this tutorial are ``How it works'', ``Code
    Chunks'', and ``Output Formats''
  \end{itemize}
\item
  Gallery of the vast range of output and product types that you can
  create using R Markdown including PDF reports, interactive dashboards,
  maps, webpages like this one and more:
  https://rmarkdown.rstudio.com/gallery.html
\end{itemize}

\part{Working with R}

\chapter{Getting Started with R}\label{getting-started-with-r}

This lesson is designed to explain the basics of how R works as a
programming language.

\begin{tcolorbox}[enhanced jigsaw, arc=.35mm, titlerule=0mm, left=2mm, bottomrule=.15mm, bottomtitle=1mm, opacitybacktitle=0.6, colbacktitle=quarto-callout-caution-color!10!white, colback=white, breakable, opacityback=0, colframe=quarto-callout-caution-color-frame, toptitle=1mm, title=\textcolor{quarto-callout-caution-color}{\faFire}\hspace{0.5em}{Learning Objectives}, rightrule=.15mm, toprule=.15mm, leftrule=.75mm, coltitle=black]

\begin{itemize}
\tightlist
\item
  Define the following terms as they relate to R: object, assign, call,
  function, arguments, options.
\item
  Assign values to objects in R.
\item
  Learn how to \emph{name} objects
\item
  Solve simple arithmetic operations in R.
\item
  Call functions and use arguments to change their default options.
\item
  Inspect the content of vectors and manipulate their content.
\item
  Subset and extract values from vectors.
\item
  Write logical statements that resolve as TRUE and FALSE.
\item
  Describe what a data frame is.
\item
  Summarize the contents of a data frame.
\item
  Extract vectors out of data frames using variable names.
\end{itemize}

\end{tcolorbox}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\section{Writing Scripts (Video)}\label{writing-scripts-video}

In lesson 02 we saw that we could write R code in the console and get
immediate results. There are two main ways of interacting with R: by
using the console or by using script files (plain text files that
contain your code). We will be working in R markdown files exclusively
in this class, but it is important to be aware that there are also
script files that have an extension of \texttt{.R}. These can contain
code and comments only, not normal text sentences like this.

Because we want our code and workflow to be reproducible, and often your
code may span several lines at a time, it is better to type the commands
we want in a script, and save the script. This way, there is a complete
record of what we did, and anyone (including our future selves!) can
easily replicate the results on their computer. It's also easier to fix
mistakes this way, without having to retype in the entire command.

\paragraph{Start a new Rmarkdown file}\label{start-a-new-rmarkdown-file}

\begin{itemize}
\tightlist
\item
  Go to File --\textgreater{} New File --\textgreater{} R Markdown to
  open a new R markdown window.
\item
  Give this file a name such as ``Lesson 04 notes'', and put your name
  as the author.
\item
  Delete all the template language below line 11.
\end{itemize}

Now let's go back to that long expression from lesson 2 (corrected), but
this time type it into a new code chunk. Recall we can make a new code
chunk by pressing \texttt{CTRL}+\texttt{ALT}+\texttt{I}, or by clicking
on \emph{Insert} then \emph{R}. Also recall that we submit this code by
pressing \texttt{Ctrl}+\texttt{Enter} or clicking the green play arrow
in the top right corner of the code chunk.

\begin{verbatim}
2 + 5*(8^3)- 3*log(10)
\end{verbatim}

\paragraph{Make a change to the above expression and run the command
again.}\label{make-a-change-to-the-above-expression-and-run-the-command-again.}

For the rest of this lesson, retype each code chunk below into the notes
file you just created. Be sure to annotate these notes as you would take
notes in any other class. For you to retain what you are reading and
learning, writing out what these pieces of code are doing (e.g.~the
assignment operator \texttt{\textless{}-}) in \textbf{your own words} is
an effective learning technique.

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\section{Creating objects in R
(Video)}\label{creating-objects-in-r-video}

To do useful and interesting things, we need to assign \emph{values} to
\emph{objects}. To create an object, we need to give it a name followed
by the assignment operator \texttt{\textless{}-}, and the value we want
to give it:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weight\_kg }\OtherTok{\textless{}{-}} \DecValTok{55}
\end{Highlighting}
\end{Shaded}

\texttt{\textless{}-} is the assignment operator. It assigns values on
the right to objects on the left. So, after executing
\texttt{x\ \textless{}-\ 3}, the value of \texttt{x} is \texttt{3}.

\textbf{Objects can be given any name such as \texttt{x},
\texttt{current\_temperature}, or \texttt{subject\_id}. However there
are some naming guidelines you need to be aware of.}

\begin{itemize}
\tightlist
\item
  You want your object names to be explicit and not too long.
\item
  They cannot start with a number (\texttt{2x} is not valid, but
  \texttt{x2} is).
\item
  R is case sensitive (e.g., \texttt{weight\_kg} is different from
  \texttt{Weight\_kg}).
\item
  There are some names that cannot be used because they are the names of
  fundamental functions in R (e.g., \texttt{if}, \texttt{else},
  \texttt{for}, see
  \href{https://stat.ethz.ch/R-manual/R-devel/library/base/html/Reserved.html}{here}
  for a complete list).
\item
  It's best to not use other function names (e.g., \texttt{c},
  \texttt{T}, \texttt{mean}, \texttt{data}, \texttt{df},
  \texttt{weights}) because these already tend to be in use by different
  parts of R.
\item
  See \href{https://google.github.io/styleguide/Rguide.xml}{Google's}
  style guide for more information.
\end{itemize}

When assigning a value to an object, R does not print anything. You can
force R to print the value by using parentheses or by typing the object
name:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weight\_kg }\OtherTok{\textless{}{-}} \DecValTok{55}    \CommentTok{\# doesn\textquotesingle{}t print anything}
\NormalTok{(weight\_kg }\OtherTok{\textless{}{-}} \DecValTok{55}\NormalTok{)  }\CommentTok{\# but putting parenthesis around the call prints the value of \textasciigrave{}weight\_kg\textasciigrave{}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 55
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weight\_kg          }\CommentTok{\# and so does typing the name of the object}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 55
\end{verbatim}

Now that R has \texttt{weight\_kg} in memory, we can do arithmetic with
it. For instance, we may want to convert this weight into pounds (weight
in pounds is 2.2 times the weight in kg):

\begin{Shaded}
\begin{Highlighting}[]
\FloatTok{2.2} \SpecialCharTok{*}\NormalTok{ weight\_kg}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 121
\end{verbatim}

We can also change an object's value by assigning it a new one:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weight\_kg }\OtherTok{\textless{}{-}} \FloatTok{57.5}
\FloatTok{2.2} \SpecialCharTok{*}\NormalTok{ weight\_kg}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 126.5
\end{verbatim}

This means that assigning a value to one object does not change the
values of other objects For example, let's store the animal's weight in
pounds in a new object, \texttt{weight\_lb}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weight\_lb }\OtherTok{\textless{}{-}} \FloatTok{2.2} \SpecialCharTok{*}\NormalTok{ weight\_kg}
\end{Highlighting}
\end{Shaded}

and then change \texttt{weight\_kg} to 100.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weight\_kg }\OtherTok{\textless{}{-}} \DecValTok{100}
\end{Highlighting}
\end{Shaded}

R executes code in top-down order. So what happens on line 10 occurs
before line 11. What do you think is the current content of the object
\texttt{weight\_lb}? 126.5 or 220?

\emph{\textbf{Comments.}} \emph{The comment character in R is
\texttt{\#}, anything to the right of a \texttt{\#} in a script will be
ignored by R. It is useful to leave notes, and explanations in your
scripts as demonstrated earlier.}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\section{Functions and their arguments
(Video)}\label{functions-and-their-arguments-video}

Functions are ``canned scripts'' that automate more complicated sets of
commands including operations assignments, etc. Many functions are
predefined, or can be made available by importing R \emph{packages}
(lesson 02).

A function usually takes one or more inputs called \emph{arguments}, and
often (but not always) return a \emph{value}.

A typical example would be the function \texttt{sqrt()}. The input is
the number \texttt{4}, and the return value (the output) is the square
root of 4, namely 2. Executing a function (`running it') is called
\emph{calling} the function.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sqrt}\NormalTok{(}\DecValTok{4}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 2
\end{verbatim}

Let's look into the \texttt{round} function.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{round}\NormalTok{(}\FloatTok{3.14159}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 3
\end{verbatim}

We can learn more about this function by typing \texttt{?round}. The
\textbf{Usage} section of the help documentation shows you what the
default values for each argument are. This is a very important piece to
pay attention. Sometimes the default behaviors are not what you want to
happen.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{round}\NormalTok{(x, }\AttributeTok{digits=}\DecValTok{0}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

In the \textbf{Arguments} section the help file defines what each
argument does.

\begin{itemize}
\tightlist
\item
  \texttt{x} is the object that you want to round. It must be a
  \emph{numeric vector}.
\item
  \texttt{digits} is an integer indicating the number of decimal places
  to round to.
\end{itemize}

Above, we called \texttt{round()} with just one argument,
\texttt{3.14159}, and it has returned the value \texttt{3}. That's
because the default is to round to the nearest whole number. We see that
if we want a different number of digits, we can type
\texttt{digits\ =\ 2} or however many we want.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{round}\NormalTok{(}\FloatTok{3.14159}\NormalTok{, }\AttributeTok{digits =} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 3.14
\end{verbatim}

If you provide the arguments in the exact same order as they are defined
you don't have to name them:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{round}\NormalTok{(}\FloatTok{3.14159}\NormalTok{, }\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 3.14
\end{verbatim}

And if you do name the arguments, you can switch their order:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{round}\NormalTok{(}\AttributeTok{digits =} \DecValTok{2}\NormalTok{, }\AttributeTok{x =} \FloatTok{3.14159}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 3.14
\end{verbatim}

This is a simple function with only one argument. Functions are the
backbone of how R does it's thing. You will get lots of practice with
functions, and quickly encounter functions that require many arguments.

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\section{Data Types (Video)}\label{data-types-video}

R objects come in different data types.

\subsection{Numbers}\label{numbers}

When a number is stored in an object it is now called a
\textbf{numerical} variable. We can do math on numeric variables.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{im\_a\_number }\OtherTok{\textless{}{-}} \DecValTok{50}
\NormalTok{im\_a\_number}\SpecialCharTok{*}\DecValTok{2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 100
\end{verbatim}

\subsection{Letters}\label{letters}

Letters, words, and entire sentences can also be stored in objects.
These are then called \textbf{character} or \textbf{string} variables.
We can't do math on character variables, and if we try to R gives us an
error message.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(im\_a\_character }\OtherTok{\textless{}{-}} \StringTok{"dog"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "dog"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{im\_a\_character}\SpecialCharTok{*}\DecValTok{2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Error in im_a_character * 2: non-numeric argument to binary operator
\end{verbatim}

In statistics classes, character variables are often treated as
\textbf{categorical} variables, which can also be called \textbf{factor}
variables. Factor variables in R are special types of categorical
variables. We will learn how to work with factor variables in week 2.

\subsection{Boolean}\label{boolean}

When the value of an object can only be \texttt{TRUE} or \texttt{FALSE}
it is called a \textbf{Boolean} variable. These are created by writing a
\textbf{logical statement} where the answer is either TRUE or FALSE.
Silly examples include ``Is 3 greater than 4?'' and ``Is the square root
of 4 equal to 2?''

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{3}\SpecialCharTok{\textgreater{}}\DecValTok{4}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sqrt}\NormalTok{(}\DecValTok{4}\NormalTok{)}\SpecialCharTok{==}\DecValTok{2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] TRUE
\end{verbatim}

We will see how to use these logical statements to do things such as
subsetting data and creating new variables.

\section{Data Structures (Video)}\label{data-structures-video}

Data structures is how we refer to a collection of pieces of data, like
a series of numbers, or a list of words.

\subsection{Vectors}\label{vectors}

A vector is the most common and basic data structure in R, and is pretty
much the workhorse of R.

We can assign a series of values to a vector using the \texttt{c()}
function. For example we can create a vector of animal weights and
assign it to a new object \texttt{weight\_g}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(weight\_g }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{50}\NormalTok{, }\DecValTok{60}\NormalTok{, }\DecValTok{65}\NormalTok{, }\DecValTok{82}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 50 60 65 82
\end{verbatim}

A vector can also contain characters:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(animals }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"mouse"}\NormalTok{, }\StringTok{"rat"}\NormalTok{, }\StringTok{"dog"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "mouse" "rat"   "dog"  
\end{verbatim}

The quotes around ``mouse'', ``rat'', etc. are essential here. Without
the quotes R will assume objects have been created called
\texttt{mouse}, \texttt{rat} and \texttt{dog}. As these objects don't
exist in R's memory, there will be an error message.

An important feature of a vector, is that all of the elements are the
same type of data. That is, each element in the vector has to be the
same type. You can use the function \texttt{class()} to see what data
type a vector is.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(weight\_g)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "numeric"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(animals)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "character"
\end{verbatim}

If you try to mix and match data types within a vector, some
``coercion'' will occur. If you combine letters and numbers, everything
will be treated as letters.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(mix\_match }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(weight\_g, animals))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "50"    "60"    "65"    "82"    "mouse" "rat"   "dog"  
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(mix\_match)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "character"
\end{verbatim}

This is VERY important to keep in mind when you import data into R from
another program like Excel. If you have any letters (like the word
``missing'', or ``NA'') in a column, all data from that column will be
treated as character strings. And you can't do math (such as take a
mean) on words.

Vectors are one of the many \textbf{data structures} that R uses. Other
important ones are lists (\texttt{list}), matrices (\texttt{matrix}),
data frames (\texttt{data.frame}), factors (\texttt{factor}) and arrays
(\texttt{array}). We will only talk about
\texttt{vectors},\texttt{data.frame}s and \texttt{factors} in this class
(not all in this lesson).

\subsection{Doing math on vectors}\label{doing-math-on-vectors}

You can perform math operations on the elements of a vector such as

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weight\_KG }\OtherTok{\textless{}{-}}\NormalTok{ weight\_g}\SpecialCharTok{/}\DecValTok{1000}
\NormalTok{weight\_KG}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 0.050 0.060 0.065 0.082
\end{verbatim}

When adding two vectors together, the elements in the same position are
added to each other. So element 1 in the vector \texttt{a} is added to
element 1 in vector \texttt{b}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{)}
\NormalTok{b }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{6}\NormalTok{,}\DecValTok{7}\NormalTok{,}\DecValTok{8}\NormalTok{)}
\NormalTok{a}\SpecialCharTok{+}\NormalTok{b}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1]  7  9 11
\end{verbatim}

More complex calculations can be performed on multiple vectors.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{wt\_lb }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{155}\NormalTok{, }\DecValTok{135}\NormalTok{, }\DecValTok{90}\NormalTok{)}
\NormalTok{ht\_in }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{72}\NormalTok{, }\DecValTok{64}\NormalTok{, }\DecValTok{50}\NormalTok{)}
\NormalTok{bmi }\OtherTok{\textless{}{-}} \DecValTok{703}\SpecialCharTok{*}\NormalTok{wt\_lb }\SpecialCharTok{/}\NormalTok{ ht\_in}\SpecialCharTok{\^{}}\DecValTok{2}
\NormalTok{bmi}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 21.01948 23.17017 25.30800
\end{verbatim}

All these operations on vectors behave the same way when dealing with
variables in a data set (data.frame).

If you want to add the values \emph{within} a vector, you use functions
such as \texttt{sum()}, \texttt{max()} and \texttt{mean()}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sum}\NormalTok{(a)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 6
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{max}\NormalTok{(b)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 8
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mean}\NormalTok{(a}\SpecialCharTok{+}\NormalTok{b)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 9
\end{verbatim}

\subsection{Subsetting vectors}\label{subsetting-vectors}

If we want to extract one or several values from a vector, we must
provide one or several indices in square brackets. For instance:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{animals }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"mouse"}\NormalTok{, }\StringTok{"rat"}\NormalTok{, }\StringTok{"dog"}\NormalTok{, }\StringTok{"cat"}\NormalTok{)}
\NormalTok{animals[}\DecValTok{2}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "rat"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{animals[}\FunctionTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "rat" "dog"
\end{verbatim}

The number in the indices indicates which element to extract. For
example we can extract the 3rd element in \texttt{weight\_g} by typing

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weight\_g[}\DecValTok{3}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 65
\end{verbatim}

\subsection{Conditional subsetting}\label{conditional-subsetting}

Another common way of subsetting is by using a logical vector.
\texttt{TRUE} will select the element with the same index, while
\texttt{FALSE} will not. Typically, these logical vectors are not typed
by hand, but are the output of other functions or logical tests such as:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weight\_g }\SpecialCharTok{\textgreater{}} \DecValTok{50}  \CommentTok{\# returns TRUE or FALSE depending on which elements that meet the condition}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] FALSE  TRUE  TRUE  TRUE
\end{verbatim}

We can use this output to select elements in a \emph{different} vector
where the value of that logical statement is TRUE. For instance, if you
wanted to select only the values where weight in grams is above 50 we
would type:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weight\_g[weight\_g }\SpecialCharTok{\textgreater{}} \DecValTok{50}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 60 65 82
\end{verbatim}

You can combine multiple tests using \texttt{\&} (both conditions are
true, AND) or \texttt{\textbar{}} (at least one of the conditions is
true, OR):

\emph{Weight is less than 30g or greater than 60g}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weight\_g[weight\_g }\SpecialCharTok{\textless{}} \DecValTok{30} \SpecialCharTok{|}\NormalTok{ weight\_g }\SpecialCharTok{\textgreater{}} \DecValTok{60}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 65 82
\end{verbatim}

\emph{Weight is between 60 and 80lbs}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weight\_g[weight\_g }\SpecialCharTok{\textgreater{}=} \DecValTok{60} \SpecialCharTok{\&}\NormalTok{ weight\_g }\SpecialCharTok{\textless{}=} \DecValTok{80}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 60 65
\end{verbatim}

Here, \texttt{\textless{}} stands for ``less than'',
\texttt{\textgreater{}} for ``greater than'', \texttt{\textgreater{}=}
for ``greater than or equal to'', and \texttt{==} for ``equal to''. The
double equal sign \texttt{==} is a test for numerical equality between
the left and right hand sides, and should not be confused with the
single \texttt{=} sign, which performs variable assignment (similar to
\texttt{\textless{}-}).

A common task is to search for certain strings in a vector. One could
use the ``or'' operator \texttt{\textbar{}} to test for equality to
multiple values, but this can quickly become tedious. The function
\texttt{\%in\%} allows you to test if any of the elements of a search
vector are found:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{animals }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"mouse"}\NormalTok{, }\StringTok{"rat"}\NormalTok{, }\StringTok{"dog"}\NormalTok{, }\StringTok{"cat"}\NormalTok{)}
\NormalTok{animals[animals }\SpecialCharTok{==} \StringTok{"cat"} \SpecialCharTok{|}\NormalTok{ animals }\SpecialCharTok{==} \StringTok{"rat"}\NormalTok{] }\CommentTok{\# returns both rat and cat}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "rat" "cat"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{animals }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{"rat"}\NormalTok{, }\StringTok{"cat"}\NormalTok{, }\StringTok{"dog"}\NormalTok{, }\StringTok{"duck"}\NormalTok{, }\StringTok{"goat"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] FALSE  TRUE  TRUE  TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{animals[animals }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{"rat"}\NormalTok{, }\StringTok{"cat"}\NormalTok{, }\StringTok{"dog"}\NormalTok{, }\StringTok{"duck"}\NormalTok{, }\StringTok{"goat"}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "rat" "dog" "cat"
\end{verbatim}

\subsection{Order matters.}\label{order-matters.}

When considering string or character vectors or data elements, R treats
everything in alphabetical order. Thus

\begin{Shaded}
\begin{Highlighting}[]
\StringTok{"four"} \SpecialCharTok{\textgreater{}} \StringTok{"five"}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] TRUE
\end{verbatim}

This will come back to bug you when dealing with categorical data types
called \texttt{factor}s in a later lesson. Don't worry, we'll show you
how to be the boss of your factors and not let R tell you that ``one''
is greater than ``four''.

\section{Data Frames (Video)}\label{data-frames-video}

Data frames are like spreadsheet data, rectangular with rows and
columns. Ideally each row represents data on a single observation and
each column contains data on a single variable, or characteristic, of
the observation. This is called \texttt{tidy\ data}. This is an
important concept that you are encouraged to read more about if you will
be doing your own data collection and research.
\href{https://www.jstatsoft.org/article/view/v059i10}{This article is a
good place to start}.

A data frame is the representation of data in the format of a table
where the columns are vectors that all have the same length. Because
columns are vectors, each column must contain a single type of data
(e.g., characters, integers, factors). For example, here is a figure
depicting a data frame comprising a numeric, a character, and a logical
vector.

\begin{figure}[H]

{\centering \pandocbounded{\includegraphics[keepaspectratio]{../static/img/data-frame.png}}

}

\caption{\emph{figure depicting a data frame}}

\end{figure}%

For this part of the lesson we will use a data set called
\texttt{diamonds} that comes with the \texttt{ggplot2} package that you
installed as part of lesson 02. In a later lesson we will learn how to
import data from an external file into R. We can load the
\texttt{diamonds} data set into our global environment by typing

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{diamonds }\OtherTok{\textless{}{-}}\NormalTok{ ggplot2}\SpecialCharTok{::}\NormalTok{diamonds}
\end{Highlighting}
\end{Shaded}

\paragraph{To see the raw data values, click on the square spreadsheet
icon to the right of the data set name in the top right panel of RStudio
(circled in green in the image
below).}\label{to-see-the-raw-data-values-click-on-the-square-spreadsheet-icon-to-the-right-of-the-data-set-name-in-the-top-right-panel-of-rstudio-circled-in-green-in-the-image-below.}

\begin{figure}[H]

{\centering \pandocbounded{\includegraphics[keepaspectratio]{../static/img/data.PNG}}

}

\caption{\emph{screenshot of dataset in the global environment}}

\end{figure}%

This area also tells us a little bit about the data set, specifically
that it has 53,940 rows and 10 variables.

When data sets are very large such as this one, it may be difficult to
see all columns or all rows. We can get an idea of the structure of the
data frame including variable names and types by using the \texttt{str}
function,

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str}\NormalTok{(diamonds)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
tibble [53,940 x 10] (S3: tbl_df/tbl/data.frame)
 $ carat  : num [1:53940] 0.23 0.21 0.23 0.29 0.31 0.24 0.24 0.26 0.22 0.23 ...
 $ cut    : Ord.factor w/ 5 levels "Fair"<"Good"<..: 5 4 2 4 2 3 3 3 1 3 ...
 $ color  : Ord.factor w/ 7 levels "D"<"E"<"F"<"G"<..: 2 2 2 6 7 7 6 5 2 5 ...
 $ clarity: Ord.factor w/ 8 levels "I1"<"SI2"<"SI1"<..: 2 3 5 4 2 6 7 3 4 5 ...
 $ depth  : num [1:53940] 61.5 59.8 56.9 62.4 63.3 62.8 62.3 61.9 65.1 59.4 ...
 $ table  : num [1:53940] 55 61 65 58 58 57 57 55 61 61 ...
 $ price  : int [1:53940] 326 326 327 334 335 336 336 337 337 338 ...
 $ x      : num [1:53940] 3.95 3.89 4.05 4.2 4.34 3.94 3.95 4.07 3.87 4 ...
 $ y      : num [1:53940] 3.98 3.84 4.07 4.23 4.35 3.96 3.98 4.11 3.78 4.05 ...
 $ z      : num [1:53940] 2.43 2.31 2.31 2.63 2.75 2.48 2.47 2.53 2.49 2.39 ...
\end{verbatim}

The \texttt{diamonds} data set contains numeric variables such as
\texttt{carat}, \texttt{depth}, and \texttt{price}, and ordered factor
variables including the \texttt{cut}, \texttt{color}, and
\texttt{clarity} of those diamonds.

\subsection{\texorpdfstring{Inspecting \texttt{data.frame}
objects}{Inspecting data.frame objects}}\label{inspecting-data.frame-objects}

Here is a non-exhaustive list of functions to get a sense of the
content/structure of the data. Let's try them out!

\begin{itemize}
\tightlist
\item
  Size:

  \begin{itemize}
  \tightlist
  \item
    \texttt{dim(diamonds)} - returns a vector with the number of rows in
    the first element, and the number of columns as the second element
    (the dimensions of the object)
  \item
    \texttt{nrow(diamonds)} - returns the number of rows
  \item
    \texttt{ncol(diamonds)} - returns the number of columns
  \end{itemize}
\item
  Content:

  \begin{itemize}
  \tightlist
  \item
    \texttt{head(diamonds)} - shows the first 6 rows
  \item
    \texttt{tail(diamonds)} - shows the last 6 rows
  \end{itemize}
\item
  Names:

  \begin{itemize}
  \tightlist
  \item
    \texttt{names(diamonds)} - returns the column names (synonym of
    colnames() for data.frame objects)
  \item
    \texttt{rownames(diamonds)} - returns the row names
  \end{itemize}
\item
  Summary:

  \begin{itemize}
  \tightlist
  \item
    \texttt{str(diamonds)} - structure of the object and information
    about the class, length and content of each column
  \item
    \texttt{summary(diamonds)} - summary statistics for each column
  \end{itemize}
\end{itemize}

Note: most of these functions are ``generic'', they can be used on other
types of objects besides a data.frame

\subsection{Identifying variables}\label{identifying-variables}

Data frames can be subset by specifying indices (as shown previously),
but also by calling their column names directly:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{diamonds[, }\StringTok{"depth"}\NormalTok{]}
\NormalTok{diamonds[, }\DecValTok{5}\NormalTok{] }
\NormalTok{diamonds}\SpecialCharTok{$}\NormalTok{depth}
\end{Highlighting}
\end{Shaded}

The \texttt{\$} notation has the format \texttt{data\$variable} and so
can be thought of as specifying which data set the variable is in. It is
easy to imagine a situation where two different data sets have the same
name.

This allows us to perform calculations on an individual variable. Below
is an example of finding the average price for all diamonds in the data
set.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mean}\NormalTok{(diamonds}\SpecialCharTok{$}\NormalTok{price)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 3932.8
\end{verbatim}

You can also subset a variable based on the value of a secondary
variable. Here is an example of finding the average price for
\texttt{Good} quality diamonds.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mean}\NormalTok{(diamonds}\SpecialCharTok{$}\NormalTok{price[diamonds}\SpecialCharTok{$}\NormalTok{cut}\SpecialCharTok{==}\StringTok{"Good"}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 3928.864
\end{verbatim}

Note that the \$ is used in both locations where we want to identify a
variable.

\chapter{Working with Data}\label{working-with-data}

In this lesson we will learn how to summarize data in a data frame, and
to do basic data management tasks such as making new variables, recoding
data and dealing with missing data. (Introduction Video)

\subsection{Learning Objectives}\label{learning-objectives-3}

After completing this lesson learners will be able to

\begin{itemize}
\tightlist
\item
  Summarize variables inside a data frame
\item
  Make new variables inside a data frame.
\item
  Selectively edit (and recode) data elements.
\item
  Identify when data values are missing
\item
  Summarize data in the presence of missing values.
\end{itemize}

\subsection{Preparation}\label{preparation}

Prior to this lesson learners should

\begin{itemize}
\tightlist
\item
  Download the \href{05_dm_notes.Rmd}{{[}05\_dm\_notes.Rmd{]}} R
  markdown file and save into your \texttt{notes/Math130} folder.

  \begin{itemize}
  \tightlist
  \item
    Open this in RStudio and ensure the first code chunk will run
    without error.
  \end{itemize}
\item
  Install the \texttt{ggplot2}, \texttt{openintro} and \texttt{dplyr}
  packages
  (\href{https://norcalbiostat.github.io/MATH130/notes/02_setup_slides.html\#19}{this
  was done as part of lesson 02}).
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(dplyr)}
\FunctionTok{library}\NormalTok{(ggplot2)}
\NormalTok{ncbirths }\OtherTok{\textless{}{-}}\NormalTok{ openintro}\SpecialCharTok{::}\NormalTok{ncbirths}
\end{Highlighting}
\end{Shaded}

\section{Missing Data (Video)}\label{missing-data-video}

Missing data occurs when the value for a variable is missing. Think of
it as a blank cell in an spreadsheet. Missing values can cause some
problems during analysis, so let's see how to detect missing values and
how to work around them.

Consider the \texttt{ncbirths} data set, specifically the first column
containing data on the father's age (\texttt{fage}).

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{head}\NormalTok{(ncbirths)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 6 x 13
   fage  mage mature    weeks premie visits marital gained weight lowbirthweight
  <int> <int> <fct>     <int> <fct>   <int> <fct>    <int>  <dbl> <fct>         
1    NA    13 younger ~    39 full ~     10 not ma~     38   7.63 not low       
2    NA    14 younger ~    42 full ~     15 not ma~     20   7.88 not low       
3    19    15 younger ~    37 full ~     11 not ma~     38   6.63 not low       
4    21    15 younger ~    41 full ~      6 not ma~     34   8    not low       
5    NA    15 younger ~    39 full ~      9 not ma~     27   6.38 not low       
6    NA    15 younger ~    38 full ~     19 not ma~     22   5.38 low           
# i 3 more variables: gender <fct>, habit <fct>, whitemom <fct>
\end{verbatim}

\begin{itemize}
\tightlist
\item
  R puts a \texttt{NA} as a placeholder when the value for that piece of
  data is missing.
\item
  Missing data can be a result of many things: skip patterns in a survey
  (i.e.~non-smokers don't get asked how many packs per week they smoke),
  errors in data reads from a machine, etc.
\end{itemize}

\textbf{Problem 1} \texttt{R} can't do arithmetic on missing data. So
\texttt{5\ +\ NA\ =\ NA}, and if you were to try to calculate the
\texttt{mean()} of a variable, you'd also get \texttt{NA}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mean}\NormalTok{(ncbirths}\SpecialCharTok{$}\NormalTok{fage)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] NA
\end{verbatim}

\textbf{Problem 2} Some plots will show \texttt{NA} as it's own
category, which is undesirable.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(ncbirths, }\FunctionTok{aes}\NormalTok{(premie))}\SpecialCharTok{+}\FunctionTok{geom\_bar}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{dm_files/figure-pdf/unnamed-chunk-4-1.pdf}}

\subsection{Identifying missing
values}\label{identifying-missing-values}

To find out how many values in a particular variable are missing we can
use one of two approaches:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Look at the raw data using \texttt{head()} or \texttt{str()}. This may
  not be helpful if there is no missing values in the first 6 rows, or
  if there is a large number of variables to look through.
\item
  Look at data summaries using \texttt{table()} for categorical data and
  \texttt{summary()} for numerical data. In the examples below you can
  see that entries for ``NA'' are included in the output.
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{table}\NormalTok{(ncbirths}\SpecialCharTok{$}\NormalTok{habit, }\AttributeTok{useNA=}\StringTok{"always"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}

nonsmoker    smoker      <NA> 
      873       126         1 
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{summary}\NormalTok{(ncbirths}\SpecialCharTok{$}\NormalTok{fage)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
  14.00   25.00   30.00   30.26   35.00   55.00     171 
\end{verbatim}

\subsection{Is it NA?}\label{is-it-na}

The function \texttt{is.na()} returns TRUE or FALSE for each element in
the provided vector for whether or not that element is missing.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"green"}\NormalTok{, }\ConstantTok{NA}\NormalTok{, }\DecValTok{3}\NormalTok{)}
\FunctionTok{is.na}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] FALSE  TRUE FALSE
\end{verbatim}

In this example, the vector \texttt{x} is created with three elements,
the second one is missing. Calling the function \texttt{is.na()} on the
vector \texttt{x}, results in three values, where only the second one is
TRUE -- meaning the second element is missing.

This can be extended to do things such as using the \texttt{sum()}
function to count the number of missing values in a variable. Here we
are \emph{nesting} the functions \texttt{is.na()} is written entirely
inside the \texttt{sum()} function.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sum}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(ncbirths}\SpecialCharTok{$}\NormalTok{fage))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 171
\end{verbatim}

There are 171 records in this data set where the age for the father is
not present.

\section{Summarizing data (Video)}\label{summarizing-data-video}

Two common methods used to summarize data are \texttt{table()} for
categorical factor variables, and \texttt{summary()} for numeric
variables.

\section{Frequency Tables for categorical
data}\label{frequency-tables-for-categorical-data}

Frequency tables are used only on categorical data, and the table
results show you how many records in the data set have that particular
factor level.

You can create a frequency table by using the \texttt{table()} function.
The \texttt{useNA="always"} argument tells \texttt{R} to always include
an entry for missing values \texttt{\textless{}NA\textgreater{}}, even
if there are none.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{table}\NormalTok{(ncbirths}\SpecialCharTok{$}\NormalTok{lowbirthweight, }\AttributeTok{useNA=}\StringTok{"always"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}

    low not low    <NA> 
    111     889       0 
\end{verbatim}

The variable \texttt{ncbirths\$lowbirthweight} has 111 records with a
value of \texttt{low}, and 889 records with the value of
\texttt{not\ low}.

\subsection{Summary statistics for numerical
data}\label{summary-statistics-for-numerical-data}

Numerical variables can be summarized using statistics such as the min,
max, mean and median. The function \texttt{summary()} prints out the
five number summary, and includes the mean. This function also displays
the number of missing values for that variable.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{summary}\NormalTok{(ncbirths}\SpecialCharTok{$}\NormalTok{visits)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
    0.0    10.0    12.0    12.1    15.0    30.0       9 
\end{verbatim}

Mothers included in this data set visited the doctor on average 12.1
times during their pregnancy.

\section{Data editing / Recoding
(Video)}\label{data-editing-recoding-video}

Sometimes we have a need to edit, or change data. We can change values
of existing data by using logical statements.

To choose all observations (rows) of a \texttt{data} set, where a
\texttt{variable} is equal to some \texttt{value}, you would type

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data[data}\SpecialCharTok{$}\NormalTok{variable}\SpecialCharTok{==}\NormalTok{value]  }\CommentTok{\# example code}
\end{Highlighting}
\end{Shaded}

We can use this method of selecting rows, to change data in those
specific rows.

\textbf{Example 1: Too low birthweight}

Let's look at the numerical distribution of birthweight of the baby.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{summary}\NormalTok{(ncbirths}\SpecialCharTok{$}\NormalTok{weight)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  1.000   6.380   7.310   7.101   8.060  11.750 
\end{verbatim}

The value of 1 lb seems very low. The researchers you are working with
decide that is a mistake and should be excluded from the data. We would
then set all records where \texttt{weight=1} to missing.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ncbirths}\SpecialCharTok{$}\NormalTok{weight[ncbirths}\SpecialCharTok{$}\NormalTok{weight}\SpecialCharTok{==}\DecValTok{1}\NormalTok{] }\OtherTok{\textless{}{-}} \ConstantTok{NA}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  The specific variable \texttt{ncbirths\$weight} is on the left side
  outside the \texttt{{[}{]}}. So just the variable \texttt{weight} is
  being changed. * Recall that bracket notation \texttt{{[}{]}} can be
  used to select rows where a certain logical statement is true. So
  \texttt{{[}ncbirths\$weight==1{]}} will only show records where
  \texttt{weight} is equal to 1.
\item
  Notice where the assignment arrow (\texttt{\textless{}-}) is at. This
  code assigns the value of \texttt{NA} (missing) to the variable
  \texttt{weight}, where \texttt{weight==1}.
\end{itemize}

But what about other weights that aren't quite as low as 1, but still
unusually low? The boxplot below shows outlying values as dots on the
low end of birthweight.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{boxplot}\NormalTok{(ncbirths}\SpecialCharTok{$}\NormalTok{weight)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{dm_files/figure-pdf/unnamed-chunk-13-1.pdf}}

Let's set all birth weights less than 4 lbs to missing.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ncbirths}\SpecialCharTok{$}\NormalTok{weight[ncbirths}\SpecialCharTok{$}\NormalTok{weight }\SpecialCharTok{\textless{}} \DecValTok{4}\NormalTok{] }\OtherTok{\textless{}{-}} \ConstantTok{NA}
\end{Highlighting}
\end{Shaded}

It is important to plot the data again, to make sure that there are no
values below 4 now.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{boxplot}\NormalTok{(ncbirths}\SpecialCharTok{$}\NormalTok{weight)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{dm_files/figure-pdf/unnamed-chunk-15-1.pdf}}

\section{Creating new variables
(Video)}\label{creating-new-variables-video}

\textbf{New variables should be added to the data frame.} This can be
done using \texttt{\$} sign notation.

The new variable you want to create goes on the left side of the
assignment operator \texttt{\textless{}-}, and how you want to create
that new variable goes on the right side.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data}\SpecialCharTok{$}\NormalTok{new\_variable }\OtherTok{\textless{}{-}}\NormalTok{ creation statement}
\end{Highlighting}
\end{Shaded}

\subsection{Example: Row-wise difference between two existing
variables}\label{example-row-wise-difference-between-two-existing-variables}

As a pregnancy progresses, both the mother and the baby gain weight. The
variable \texttt{gained} is the total amount of weight the mother gained
in her pregnancy. The variable \texttt{weight} is how much the baby
weighed at birth.

The following code creates a new variable \texttt{wtgain\_mom} the
weight gained by the mother, that is not due to the baby by subtracting
\texttt{weight} from \texttt{gained}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ncbirths}\SpecialCharTok{$}\NormalTok{wtgain\_mom }\OtherTok{\textless{}{-}}\NormalTok{ ncbirths}\SpecialCharTok{$}\NormalTok{gained }\SpecialCharTok{{-}}\NormalTok{ ncbirths}\SpecialCharTok{$}\NormalTok{weight}
\end{Highlighting}
\end{Shaded}

To confirm this variable was created correctly, we look at the data
contained in three variables in question.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{head}\NormalTok{(ncbirths[,}\FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}gained\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}weight\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}wtgain\_mom\textquotesingle{}}\NormalTok{)])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 6 x 3
  gained weight wtgain_mom
   <int>  <dbl>      <dbl>
1     38   7.63       30.4
2     20   7.88       12.1
3     38   6.63       31.4
4     34   8          26  
5     27   6.38       20.6
6     22   5.38       16.6
\end{verbatim}

\subsection{Dichtomizing data}\label{dichtomizing-data}

The \texttt{ifelse()} is hands down the easiest way to create a binary
variable (dichotomizing, only 2 levels)

Let's add a variable to identify if a mother in the North Carolina
births data set was underage at the time of birth.

\begin{itemize}
\tightlist
\item
  We will define this as if the mothers age \texttt{mage} is under 18.
\item
  We will create a new factor variable with two values:
  \texttt{underage} and \texttt{adult}.
\item
  We will use the \texttt{ifelse()} function.

  \begin{itemize}
  \tightlist
  \item
    It's set of arguments are:
    \texttt{ifelse(logical,\ value\ if\ TRUE,\ value\ if\ FALSE)}
  \item
    The \texttt{logical} argument is a statement that resolves as a
    \texttt{boolean} variable, as either TRUE or FALSE.
  \item
    The second argument is what you want the resulting variable to
    contain if the logical argument is \texttt{TRUE}
  \item
    The last argument is what you want the resulting variable to contain
    if the logical argument is \texttt{FALSE}
  \end{itemize}
\end{itemize}

Make a new variable \texttt{underage} on the \texttt{ncbirths} data set.
If \texttt{mage} is under 18, then the value of this new variable is
\texttt{underage}, else it is labeled as \texttt{adult}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ncbirths}\SpecialCharTok{$}\NormalTok{underage }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(ncbirths}\SpecialCharTok{$}\NormalTok{mage }\SpecialCharTok{\textless{}} \DecValTok{18}\NormalTok{, }\StringTok{"underage"}\NormalTok{, }\StringTok{"adult"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

You should always make sure your code works as intended.

\begin{itemize}
\tightlist
\item
  First let's look at the frequency table of \texttt{underage} and see
  if records exist with the new categories, and if there are any missing
  values.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{table}\NormalTok{(ncbirths}\SpecialCharTok{$}\NormalTok{underage, }\AttributeTok{useNA=}\StringTok{"always"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}

   adult underage     <NA> 
     963       37        0 
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Next let's check it against the value of \texttt{mage} itself. Let's
  look at all rows where mothers age is either 17 or 18
  \texttt{mage\ \%in\%\ c(17,18)}, and only the columns of interest.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ncbirths[ncbirths}\SpecialCharTok{$}\NormalTok{mage }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\DecValTok{17}\NormalTok{,}\DecValTok{18}\NormalTok{),}\FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}mage\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}underage\textquotesingle{}}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 57 x 2
    mage underage
   <int> <chr>   
 1    17 underage
 2    17 underage
 3    17 underage
 4    17 underage
 5    17 underage
 6    17 underage
 7    17 underage
 8    17 underage
 9    17 underage
10    17 underage
# i 47 more rows
\end{verbatim}

Notice I snuck a new operator in on you - \texttt{\%in\%}. This is a way
you can provide a list of values (a.k.a a vector) and say ``if the value
of the variable I want is \%in\% any of these options in this
vector\ldots{}'' do the thing.

\section{Chaining using the pipe
(Video)}\label{chaining-using-the-pipe-video}

\pandocbounded{\includegraphics[keepaspectratio]{../static/img/pipe.png}}

The pipe is technically part of the \texttt{magrittr} package, but quite
often we will use it in conjunction with functions from the
\texttt{dplyr} package introduced in a later lesson. In fact it's so
commonly used with \texttt{dplyr} functions that it the
\texttt{magrittr} package is loaded when you load \texttt{dplyr} (which
is what we do here). However, the pipe operator is so useful in many
other places that it deserves it's own introduction here.

\begin{quote}
``and then\ldots.''
\end{quote}

This is what I read to myself when using the pipe
(\texttt{\%\textgreater{}\%}). The pipe lets you chain functions
together, as long as the first argument of the function is a
\texttt{data.frame} or a variable in a \texttt{data.frame}.

\subsection{Example: Frequency tables \& summary
statistics}\label{example-frequency-tables-summary-statistics}

Earlier we saw that to create a frequency table for categorical variable
we can type:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{table}\NormalTok{(ncbirths}\SpecialCharTok{$}\NormalTok{mature)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}

 mature mom younger mom 
        133         867 
\end{verbatim}

This is also accomplished by first stating the variable, then piping in
the summary function.

\begin{quote}
If you get an error message saying something like {function not found},
that is a message to you that you need to load the library. See the
\hyperref[preparation]{preparation} section of these notes to remind
yourself how to do this.
\end{quote}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ncbirths}\SpecialCharTok{$}\NormalTok{mature }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{table}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
.
 mature mom younger mom 
        133         867 
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ncbirths}\SpecialCharTok{$}\NormalTok{mage }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{mean}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 27
\end{verbatim}

I read this as ``Take the \texttt{mage} variable on the
\texttt{ncbirths} data set, \emph{and then} calculate the mean.''

The pipe \texttt{\%\textgreater{}\%} allows multiple steps to be chained
together to execute a series of commands all at once. The usefulness of
this approach will be apparent before the class is finished.

\chapter{Working with Factors}\label{working-with-factors}

In this lesson we will discuss ways to organize and deal with
categorical data, also known as factor data types. (Intro Video)

\subsection{Student Learning
Objectives}\label{student-learning-objectives}

After completing this lesson students will be able to

\begin{itemize}
\tightlist
\item
  Convert a numeric variable to a factor variable.
\item
  Apply and change labels to factor
\item
  Understand and control the ordering of the factor.
\item
  Combine multiple levels of a factor variable into one level
\end{itemize}

\section{Preparation}\label{preparation-1}

Prior to this lesson learners should

\begin{itemize}
\tightlist
\item
  Download the \href{notes/factors_notes.qmd}{{[}factors\_notes.qmd{]}}
  Quarto file and save into your \texttt{notes/Math130} folder.

  \begin{itemize}
  \tightlist
  \item
    Open this in RStudio and ensure the first code chunk will run
    without error.
  \end{itemize}
\item
  Install the \texttt{forcats} package
  (\href{https://norcalbiostat.github.io/MATH130/notes/02_setup_slides.html\#19}{this
  was done as part of lesson 02}).
\end{itemize}

We're going to use two data sets from the \texttt{openintro} package.
The \texttt{email} data set contains information on emails received by a
specific account for the first three months in 2012, and the
\texttt{fastfood} data set describes nutrition amounts in 515 fast food
items. More information can be seen about these data sets by viewing the
help files using \texttt{?email} and \texttt{?fastfood}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(forcats)}
\NormalTok{email }\OtherTok{\textless{}{-}}\NormalTok{ openintro}\SpecialCharTok{::}\NormalTok{email}
\NormalTok{ff    }\OtherTok{\textless{}{-}}\NormalTok{ openintro}\SpecialCharTok{::}\NormalTok{fastfood}
\end{Highlighting}
\end{Shaded}

The goal of the \texttt{forcats} package is to provide a suite of useful
tools that solve common problems with factors. Often in R there are
multiple ways to accomplish the same task. Some examples in this lesson
will show how to perform a certain task using base R functions, as well
as functions from the \texttt{forcats} package.

\section{What is a factor? (Video)}\label{what-is-a-factor-video}

The term factor refers to a data type used to store categorical
variables. The difference between a categorical variable and a
continuous variable is that a categorical variable corresponds to a
limited number of categories, while a continuous variable can correspond
to an infinite number of values.

An example of a categorical variable is the \texttt{number} variable in
the \texttt{email} data set. This variable contains data on whether
there was no number, a small number (under 1 million), or a big number
in the content of the email.

First we should confirm that R sees \texttt{number} as a factor.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(email}\SpecialCharTok{$}\NormalTok{number)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "factor"
\end{verbatim}

We can use the \texttt{levels()} function to get to know factor
variables.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{levels}\NormalTok{(email}\SpecialCharTok{$}\NormalTok{number)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "none"  "small" "big"  
\end{verbatim}

There are three levels: \texttt{none}, \texttt{small}, and \texttt{big}.

How many records are in each level? There are a few ways we can
determine this, here are two:

\textbf{Base R}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{table}\NormalTok{(email}\SpecialCharTok{$}\NormalTok{number)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}

 none small   big 
  549  2827   545 
\end{verbatim}

\textbf{forcats}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{fct\_count}\NormalTok{(email}\SpecialCharTok{$}\NormalTok{number)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 3 x 2
  f         n
  <fct> <int>
1 none    549
2 small  2827
3 big     545
\end{verbatim}

Note that \texttt{fct\_count} also gives you the number of records with
that factor level. This is yet another way to generate a frequency
table.

\section{Convert a number to Factor
(Video)}\label{convert-a-number-to-factor-video}

Sometimes data are entered into the computer using numeric codes such as
0 and 1. These codes stand for categories, such as ``no'' and ``yes''.
Sometimes we want to analyze these binary variables in two ways:

\begin{itemize}
\tightlist
\item
  For statistical analyses, the data must be numeric 0/1.
\item
  For many graphics, the data must be a factor, ``no/yes''.
\end{itemize}

\textbf{Example: Is the email flagged as spam?} The \texttt{spam}
variable is recorded as an integer variable with values 0 and 1.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{table}\NormalTok{(email}\SpecialCharTok{$}\NormalTok{spam)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}

   0    1 
3554  367 
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(email}\SpecialCharTok{$}\NormalTok{spam)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "factor"
\end{verbatim}

We use the function \texttt{factor()} to convert the numeric variable
\texttt{spam} to a factor, applying \texttt{labels} to convert 0 to
``no'' and 1 to ``yes''.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{email}\SpecialCharTok{$}\NormalTok{spam\_fac }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(email}\SpecialCharTok{$}\NormalTok{spam, }\AttributeTok{labels=}\FunctionTok{c}\NormalTok{(}\StringTok{"no"}\NormalTok{, }\StringTok{"yes"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

The ordering of the \texttt{labels} argument \emph{must} be in the same
order (left to right) as the factor levels themselves. Look back at the
order of columns in the \texttt{table} - it goes 0 then 1. Thus our
labels need to go ``no'' then ``yes''.

\textbf{Always confirm your recode}

Here we confirm that the new variable was created correctly by creating
a two-way contingency table by calling the
\texttt{table(old\ variable,\ new\ variable)} function on both the old
and new variables.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{table}\NormalTok{(email}\SpecialCharTok{$}\NormalTok{spam, email}\SpecialCharTok{$}\NormalTok{spam\_fac, }\AttributeTok{useNA=}\StringTok{"always"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
      
         no  yes <NA>
  0    3554    0    0
  1       0  367    0
  <NA>    0    0    0
\end{verbatim}

Here we see that all the 0's were recoded to 'no's, and all the 1's
recoded to ``yes''\,'s, and there are no new missing values. Success!

\section{Factor ordering (Video)}\label{factor-ordering-video}

Let's revisit the variable \texttt{number}, that contains the size of
the number in the email.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{table}\NormalTok{(email}\SpecialCharTok{$}\NormalTok{number)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}

 none small   big 
  549  2827   545 
\end{verbatim}

Specifically the ordering from left to right of the factors. This is
ordinal data, in that \texttt{none} is inherently ``smaller'' than
\texttt{small}, which is smaller than \texttt{big}. Though R correctly
ordered these data, it may default to alphabetical order in other cases,
so beware! You may need to correct the ordering for other data sets.

Let's see a few ways of how to control the ordering.

\subsection{Manually specified}\label{manually-specified}

We need to take control of these factors! We can do that by re-factoring
the existing factor variable, but this time specifying the
\texttt{levels} of the factor (since it already has labels). Say we
decide to reverse the order so we go from big to small to none, in
decreasing order of size.

\textbf{Base R}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{factor}\NormalTok{(email}\SpecialCharTok{$}\NormalTok{number, }\AttributeTok{levels=}\FunctionTok{c}\NormalTok{(}\StringTok{"big"}\NormalTok{, }\StringTok{"small"}\NormalTok{, }\StringTok{"none"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{table}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
.
  big small  none 
  545  2827   549 
\end{verbatim}

\textbf{forcats}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{email}\SpecialCharTok{$}\NormalTok{number }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{fct\_relevel}\NormalTok{(}\StringTok{"big"}\NormalTok{, }\StringTok{"small"}\NormalTok{, }\StringTok{"none"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{table}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
.
  big small  none 
  545  2827   549 
\end{verbatim}

In each of these examples, I pipe (\texttt{\%\textgreater{}\%}) the
\texttt{table()} function at the end so I can see the results of the
reordering. This helps me visually confirm that the code used changed
the factor levels to be left to right in decreasing content size order.
This will be important for graphing.

\begin{quote}
Since I did not use the assignment operator (\texttt{\textless{}-})
here, these changes were not made to the variable in the \texttt{email}
data set. The examples below demonstrate making an adjustmet to a factor
variable and saving that adjustment as a new variable in the data set.
\end{quote}

\section{Factor (re)naming (Video)}\label{factor-renaming-video}

Sometimes factors come to us in names we don't prefer. We want them to
say something else.

\textbf{Base R} The easiest way here is to re-factor the variable and
apply new \texttt{labels}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{email}\SpecialCharTok{$}\NormalTok{my\_new\_number }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(email}\SpecialCharTok{$}\NormalTok{number, }\AttributeTok{labels=}\FunctionTok{c}\NormalTok{( }\StringTok{"None"}\NormalTok{, }\StringTok{"\textless{}1M"}\NormalTok{,}\StringTok{"1M+"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

Ok, but did this work? Trust, but verify.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{table}\NormalTok{(email}\SpecialCharTok{$}\NormalTok{number, email}\SpecialCharTok{$}\NormalTok{my\_new\_number, }\AttributeTok{useNA=}\StringTok{"always"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       
        None  <1M  1M+ <NA>
  none   549    0    0    0
  small    0 2827    0    0
  big      0    0  545    0
  <NA>     0    0    0    0
\end{verbatim}

The ``big'' factor is now labeled ``1M+'', ``none'' is named ``None'',
and ``small'' is ``\textless1M''.

\textbf{forcats}: use the \texttt{fct\_recode("NEW"\ =\ "old")} function
here.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{email}\SpecialCharTok{$}\NormalTok{my\_forcats\_number }\OtherTok{\textless{}{-}} \FunctionTok{fct\_recode}\NormalTok{(email}\SpecialCharTok{$}\NormalTok{number, }\StringTok{"BIG"} \OtherTok{=} \StringTok{"big"}\NormalTok{, }\StringTok{"NONE"} \OtherTok{=} \StringTok{"none"}\NormalTok{, }\StringTok{"SMALL"} \OtherTok{=} \StringTok{"small"}\NormalTok{)}
\FunctionTok{table}\NormalTok{(email}\SpecialCharTok{$}\NormalTok{number, email}\SpecialCharTok{$}\NormalTok{my\_forcats\_number, }\AttributeTok{useNA=}\StringTok{"always"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       
        NONE SMALL  BIG <NA>
  none   549     0    0    0
  small    0  2827    0    0
  big      0     0  545    0
  <NA>     0     0    0    0
\end{verbatim}

\section{Collapsing factor levels
(Video)}\label{collapsing-factor-levels-video}

For analysis purposes, sometimes you want to work with a smaller number
of factor variables. Let's look at the restaurants that are included in
the \texttt{fastfood} data set.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{table}\NormalTok{(ff}\SpecialCharTok{$}\NormalTok{restaurant)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}

      Arbys Burger King Chick Fil-A Dairy Queen   Mcdonalds       Sonic 
         55          70          27          42          57          53 
     Subway   Taco Bell 
         96         115 
\end{verbatim}

Let's combine all the sandwich, and burger joints together. I am going
to save this new variable as \texttt{restaurant\_new}.

The syntax for the \texttt{fct\_collapse} function is
\texttt{new\ level} = \texttt{"old\ level"}, where the ``old level'' is
in quotes. As always, it is good practice to create a two way table to
make sure the code typed does what we expected it to do.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ff}\SpecialCharTok{$}\NormalTok{restaurant\_new }\OtherTok{\textless{}{-}} \FunctionTok{fct\_collapse}\NormalTok{(ff}\SpecialCharTok{$}\NormalTok{restaurant, }
                                    \AttributeTok{BurgerJoint =} \FunctionTok{c}\NormalTok{(}\StringTok{"Burger King"}\NormalTok{, }\StringTok{"Mcdonalds"}\NormalTok{, }\StringTok{"Sonic"}\NormalTok{), }
                                    \AttributeTok{Sammich =} \FunctionTok{c}\NormalTok{(}\StringTok{"Arbys"}\NormalTok{, }\StringTok{"Subway"}\NormalTok{))}

\FunctionTok{table}\NormalTok{(ff}\SpecialCharTok{$}\NormalTok{restaurant, ff}\SpecialCharTok{$}\NormalTok{restaurant\_new, }\AttributeTok{useNA=}\StringTok{"always"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
             
              Sammich BurgerJoint Chick Fil-A Dairy Queen Taco Bell <NA>
  Arbys            55           0           0           0         0    0
  Burger King       0          70           0           0         0    0
  Chick Fil-A       0           0          27           0         0    0
  Dairy Queen       0           0           0          42         0    0
  Mcdonalds         0          57           0           0         0    0
  Sonic             0          53           0           0         0    0
  Subway           96           0           0           0         0    0
  Taco Bell         0           0           0           0       115    0
  <NA>              0           0           0           0         0    0
\end{verbatim}

Let's take this one step further and shorten the factor names and rename
the levels with spaces (like \texttt{Taco\ Bell}).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ff}\SpecialCharTok{$}\NormalTok{restaurant\_shortname }\OtherTok{\textless{}{-}} \FunctionTok{fct\_recode}\NormalTok{(ff}\SpecialCharTok{$}\NormalTok{restaurant\_new, }
                                      \StringTok{"Ckn"} \OtherTok{=} \StringTok{"Chick Fil{-}A"}\NormalTok{, }
                                      \StringTok{"DQ"} \OtherTok{=} \StringTok{"Dairy Queen"}\NormalTok{, }
                                      \StringTok{"TB"} \OtherTok{=} \StringTok{"Taco Bell"}\NormalTok{, }
                                      \StringTok{"Samm"} \OtherTok{=} \StringTok{\textquotesingle{}Sammich\textquotesingle{}}\NormalTok{, }
                                      \StringTok{"Burg"}\OtherTok{=} \StringTok{"BurgerJoint"}\NormalTok{)}

\FunctionTok{table}\NormalTok{(ff}\SpecialCharTok{$}\NormalTok{restaurant, ff}\SpecialCharTok{$}\NormalTok{restaurant\_shortname, }\AttributeTok{useNA=}\StringTok{"always"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
             
              Samm Burg Ckn  DQ  TB <NA>
  Arbys         55    0   0   0   0    0
  Burger King    0   70   0   0   0    0
  Chick Fil-A    0    0  27   0   0    0
  Dairy Queen    0    0   0  42   0    0
  Mcdonalds      0   57   0   0   0    0
  Sonic          0   53   0   0   0    0
  Subway        96    0   0   0   0    0
  Taco Bell      0    0   0   0 115    0
  <NA>           0    0   0   0   0    0
\end{verbatim}

\subsection{Let's chain this all
together.}\label{lets-chain-this-all-together.}

Sporadically throughout this lesson, and at the end of the last lesson
I've used the pipe \texttt{\%\textgreater{}\%} operator as somewhat of a
shortcut. This amazing piece of code lets us string together commands.
Let's see how to accomplish both changes to the restaurant variable in
one single step.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ff}\SpecialCharTok{$}\NormalTok{restaurant }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{fct\_collapse}\NormalTok{(}\AttributeTok{BurgerJoint =} \FunctionTok{c}\NormalTok{(}\StringTok{"Burger King"}\NormalTok{, }\StringTok{"Mcdonalds"}\NormalTok{, }\StringTok{"Sonic"}\NormalTok{), }
                               \AttributeTok{Sammich     =} \FunctionTok{c}\NormalTok{(}\StringTok{"Arbys"}\NormalTok{, }\StringTok{"Subway"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
                  \FunctionTok{fct\_recode}\NormalTok{(}\StringTok{"Ckn"}  \OtherTok{=} \StringTok{"Chick Fil{-}A"}\NormalTok{, }
                             \StringTok{"DQ"}   \OtherTok{=} \StringTok{"Dairy Queen"}\NormalTok{, }
                             \StringTok{"TB"}   \OtherTok{=} \StringTok{"Taco Bell"}\NormalTok{, }
                             \StringTok{"Samm"} \OtherTok{=} \StringTok{\textquotesingle{}Sammich\textquotesingle{}}\NormalTok{, }
                             \StringTok{"Burg "}\OtherTok{=} \StringTok{"BurgerJoint"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
                  \FunctionTok{table}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
.
 Samm Burg    Ckn    DQ    TB 
  151   180    27    42   115 
\end{verbatim}

A few things to note when chaining commands together:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  the first argument (the data or variable) is not included.
\item
  the pipe itself must be at the end of a ``sentence''
\end{enumerate}

Don't worry if this doesn't make immediate sense right now. We'll talk
more on chaining commands together in a later lesson. There is no harm
in accomplishing a task in more than one step.

\section{Removing factor levels
(Video)}\label{removing-factor-levels-video}

Sometimes, you don't even want to consider certain levels. This often
occurs in survey data where the respondent provides an answer of
``Refuse to answer'' or the data is coded as the word ``missing''. The
word ``missing' is fundamentally different than the \texttt{NA} code for
a missing value.

For demonstration purposes, let's get rid of the data from DQ. Who eats
something other than ice cream at that place anyhow?

The most straight forward way to set a variable missing based on it's
value is to use a logical statement to choose what rows the variable is
set to missing.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ff}\SpecialCharTok{$}\NormalTok{restaurant\_shortname[ff}\SpecialCharTok{$}\NormalTok{restaurant\_shortname }\SpecialCharTok{==} \StringTok{"DQ"}\NormalTok{] }\OtherTok{\textless{}{-}} \ConstantTok{NA}
\FunctionTok{table}\NormalTok{(ff}\SpecialCharTok{$}\NormalTok{restaurant\_shortname, }\AttributeTok{useNA=}\StringTok{"always"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}

Samm Burg  Ckn   DQ   TB <NA> 
 151  180   27    0  115   42 
\end{verbatim}

This table shows that there are 42 records missing
\texttt{restaraunt\_shortname}, and 0 records with the level
\texttt{DQ}. Unfortunately, the level itself still is there. R does not
assume just because there are no records with that level, that the named
level itself should be removed. We can use the function
\texttt{fct\_drop} to drop the levels with no records.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{fct\_drop}\NormalTok{(ff}\SpecialCharTok{$}\NormalTok{restaurant\_shortname) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{table}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
.
Samm Burg  Ckn   TB 
 151  180   27  115 
\end{verbatim}

If we knew ahead of time we wanted to drop DQ, we could have set that
level to \texttt{NULL} when we did the initial recode.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ff}\SpecialCharTok{$}\NormalTok{restaurant }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{fct\_collapse}\NormalTok{(}\AttributeTok{BurgerJoint =} \FunctionTok{c}\NormalTok{(}\StringTok{"Burger King"}\NormalTok{, }\StringTok{"Mcdonalds"}\NormalTok{, }\StringTok{"Sonic"}\NormalTok{), }
                               \AttributeTok{Sammich =} \FunctionTok{c}\NormalTok{(}\StringTok{"Arbys"}\NormalTok{, }\StringTok{"Subway"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
                  \FunctionTok{fct\_recode}\NormalTok{(}\StringTok{"Ckn"}  \OtherTok{=} \StringTok{"Chick Fil{-}A"}\NormalTok{, }
                              \AttributeTok{NULL   =} \StringTok{"Dairy Queen"}\NormalTok{, }
                             \StringTok{"TB"}   \OtherTok{=} \StringTok{"Taco Bell"}\NormalTok{, }
                             \StringTok{"Samm"} \OtherTok{=} \StringTok{\textquotesingle{}Sammich\textquotesingle{}}\NormalTok{, }
                             \StringTok{"Burg "}\OtherTok{=} \StringTok{"BurgerJoint"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
                  \FunctionTok{table}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
.
 Samm Burg    Ckn    TB 
  151   180    27   115 
\end{verbatim}

\chapter{Creating Graphics}\label{creating-graphics}

Visualizing your data is hands down the most important thing you can
learn to do. Seeing is critical to understanding. There are two
audiences in mind when creating data visualizations:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  For your eyes only (FYEO). These are quick and dirty plots, without
  annotation. Meant to be looked at once or twice.
\item
  To share with others. These need to completely stand on their own.
  Axes labels, titles, colors as needed, possibly captions.
\end{enumerate}

You will see, and slowly learn, how to add these annotations and how to
clean up your graphics to make them sharable. Functions inside the
\texttt{ggplot2} package automatically does a lot of this work for you.
Remember this package has to be loaded prior to being able to access the
functions within.

(Introduction Video)

\subsection{Learning Objectives}\label{learning-objectives-4}

After completing this lesson students will be able to create basic data
visualizations using both base R and the \texttt{ggplot2} package.

\paragraph{Prior to this lesson learners
should}\label{prior-to-this-lesson-learners-should}

\begin{itemize}
\tightlist
\item
  Download the \href{07_plots_notes.Rmd}{{[}07\_plots\_notes.Rmd{]}} R
  markdown file and save into your \texttt{Math130/notes} folder.
\end{itemize}

\section{\texorpdfstring{The syntax of
\texttt{ggplot}}{The syntax of ggplot}}\label{the-syntax-of-ggplot}

The reason we use the functions in \texttt{ggplot2} is for consistency
in the structure of it's arguments. Here is a bare bones generic
plotting function:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(data, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{x, }\AttributeTok{y=}\NormalTok{y, }\AttributeTok{col=}\NormalTok{col, }\AttributeTok{fill=}\NormalTok{fill, }\AttributeTok{group=}\NormalTok{group)) }\SpecialCharTok{+}  \FunctionTok{geom\_THING}\NormalTok{() }
\end{Highlighting}
\end{Shaded}

\subsection{Required arguments}\label{required-arguments}

\begin{itemize}
\tightlist
\item
  \texttt{data}: What data set is this plot using? This is ALWAYS the
  first argument.
\item
  \texttt{aes()}: This is the \emph{aesthetics} of the plot. What
  variable is on the x, and what is on the y? Do you want to color by
  another variable, perhaps fill some box by the value of another
  variable, or group by a variable.
\item
  \texttt{geom\_THING()}: Every plot has to have a geometry. What is the
  shape of the thing you want to plot? Do you want to plot point? Use
  \texttt{geom\_points()}. Want to connect those points with a line? Use
  \texttt{geom\_lines()}. We will see many varieties in this lab.
\end{itemize}

\subsection{The Diamonds Data}\label{the-diamonds-data}

We will use a subset of the \texttt{diamonds} dataset that comes with
the \texttt{ggplot2} package. This dataset contains the prices and other
attributes of almost 54,000 diamonds. Review \texttt{?diamonds} to learn
about the variables we will be using.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(ggplot2)}
\NormalTok{diamonds }\OtherTok{\textless{}{-}}\NormalTok{ ggplot2}\SpecialCharTok{::}\NormalTok{diamonds}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{1410}\NormalTok{) }\CommentTok{\# Make the sample reproducible}
\NormalTok{dsmall }\OtherTok{\textless{}{-}}\NormalTok{ diamonds[}\FunctionTok{sample}\NormalTok{(}\FunctionTok{nrow}\NormalTok{(diamonds), }\DecValTok{1000}\NormalTok{), ]}
\end{Highlighting}
\end{Shaded}

\section{Univariate (One Variable)
(Video)}\label{univariate-one-variable-video}

\subsection{Categorical variables}\label{categorical-variables}

Both Nominal and Ordinal data types can be visualized using the same
methods: tables, barcharts and pie charts.

\subsubsection{Tables}\label{tables}

Tables are the most common way to get summary statistics of a
categorical variable. The \texttt{table()} function produces a frequency
table, where each entry represents the number of records in the data set
holding the corresponding labeled value.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{table}\NormalTok{(dsmall}\SpecialCharTok{$}\NormalTok{cut)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}

     Fair      Good Very Good   Premium     Ideal 
       34        99       220       257       390 
\end{verbatim}

There are 34 Fair quality diamonds, 99 Good quality diamonds, and 390
Ideal quality diamonds in this sample.

\subsubsection{Barcharts / Barplots}\label{barcharts-barplots}

A Barchart or barplot takes these frequencies, and draws bars along the
X-axis where the height of the bars is determined by the frequencies
seen in the table.

The geometry needed to draw a barchart in ggplot is
\texttt{geom\_bar()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(dsmall, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{cut)) }\SpecialCharTok{+} \FunctionTok{geom\_bar}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{plots_files/figure-pdf/unnamed-chunk-4-1.pdf}}

We can reorder these levels on the fly so they are being shown in
decreasing frequency using the \texttt{fct\_infreq} function from the
\texttt{forcats} library.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(dsmall, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{forcats}\SpecialCharTok{::}\FunctionTok{fct\_infreq}\NormalTok{(cut))) }\SpecialCharTok{+} \FunctionTok{geom\_bar}\NormalTok{() }\SpecialCharTok{+} \FunctionTok{xlab}\NormalTok{(}\StringTok{"cut"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{plots_files/figure-pdf/unnamed-chunk-5-1.pdf}}

\begin{quote}
Special note. The \texttt{::} notation is a shortcut to use a function
from inside a package without actually loading the entire package. This
can be useful when you're only using a function once or twice in an
analysis.
\end{quote}

\subsection{Continuous variable}\label{continuous-variable}

The price, carat, and depth of the diamonds are all continuous
variables. Let's explore the distribution of \texttt{price}.

\subsubsection{Histograms}\label{histograms}

Rather than showing the value of each observation, we prefer to think of
the value as belonging to a \emph{bin}. The height of the bars in a
histogram display the frequency of values that fall into those of those
bins.

Since the x-axis is continuous the bars touch. This is unlike the
barchart that has a categorical x-axis, and vertical bars that are
separated.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(dsmall, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{price)) }\SpecialCharTok{+} \FunctionTok{geom\_histogram}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{plots_files/figure-pdf/unnamed-chunk-6-1.pdf}}

\subsubsection{Density plots}\label{density-plots}

To get a better idea of the true shape of the distribution we can
``smooth'' out the bins and create what's called a \texttt{density} plot
or curve. Notice that the shape of this distribution curve is
much\ldots{} ``wigglier'' than the histogram may have implied.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(dsmall, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{price)) }\SpecialCharTok{+} \FunctionTok{geom\_density}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{plots_files/figure-pdf/unnamed-chunk-7-1.pdf}}

\subsubsection{Histograms + density}\label{histograms-density}

Often it is more helpful to have the density (or kernel density) plot
\emph{on top of} a histogram plot.

\begin{itemize}
\tightlist
\item
  The syntax starts the same: we'll add a new geom,
  \texttt{geom\_density} and color the line blue.
\item
  Then we add the histogram geom using \texttt{geom\_histogram} but must
  specify that the y axis should be on the density, not frequency,
  scale.

  \begin{itemize}
  \tightlist
  \item
    Note that this has to go inside the aesthetic statement
    \texttt{aes()}.
  \end{itemize}
\item
  I'm also going to get rid of the fill by using \texttt{NA} so the
  colored bars don't plot over the density line.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(dsmall, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{price)) }\SpecialCharTok{+} \FunctionTok{geom\_density}\NormalTok{(}\AttributeTok{col=}\StringTok{"blue"}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{geom\_histogram}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y=}\NormalTok{..density..), }\AttributeTok{colour=}\StringTok{"black"}\NormalTok{, }\AttributeTok{fill=}\ConstantTok{NA}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{plots_files/figure-pdf/unnamed-chunk-8-1.pdf}}

\subsubsection{Boxplots}\label{boxplots}

Another very common way to visualize the distribution of a continuous
variable is using a boxplot. Boxplots are useful for quickly identifying
where the bulk of your data lie. R specifically draws a ``modified''
boxplot where values that are considered outliers are plotted as dots.

\paragraph{base}\label{base}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{boxplot}\NormalTok{(dsmall}\SpecialCharTok{$}\NormalTok{price)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{plots_files/figure-pdf/unnamed-chunk-9-1.pdf}}

Notice that the only axis labeled is the y=axis. Like a dotplot the x
axis, or ``width'', of the boxplot is meaningless here. We can make the
axis more readable by flipping the plot on its side.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{boxplot}\NormalTok{(dsmall}\SpecialCharTok{$}\NormalTok{price, }\AttributeTok{horizontal =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{main=}\StringTok{"Distribution of diamond prices"}\NormalTok{, }\AttributeTok{xlab=}\StringTok{"Dollars"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{plots_files/figure-pdf/unnamed-chunk-10-1.pdf}}

Horizontal is a bit easier to read in my opinion.

What about ggplot? ggplot doesn't really like to do univariate boxplots.
You'll see those later when we create one boxplot per group.

\subsubsection{New variable}\label{new-variable}

Before we move on, I want to see \texttt{price} displayed as ranges of
5,000 instead of a continuous measure from 0 to 20,000. I will us the
\texttt{cut\_width} function to create a new categorical variable here
called \texttt{price\_range}.
\href{https://ggplot2.tidyverse.org/reference/cut_interval.html}{See
this page for this, and other functions in ggplot that discretize
numeric data into categorical}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dsmall}\SpecialCharTok{$}\NormalTok{price\_range }\OtherTok{\textless{}{-}} \FunctionTok{cut\_width}\NormalTok{(dsmall}\SpecialCharTok{$}\NormalTok{price}\SpecialCharTok{/}\DecValTok{1000}\NormalTok{, }\AttributeTok{width=}\DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Notice I also divided price by 1000, so 2.5 means 2500. Now that
\texttt{price\_range} is a categorical variable, I can create a barchart
to visualize the frequencies of each bin.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(dsmall, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{price\_range)) }\SpecialCharTok{+} \FunctionTok{geom\_bar}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{plots_files/figure-pdf/unnamed-chunk-12-1.pdf}}

\section{Bivariate (Two Variables)
(Video)}\label{bivariate-two-variables-video}

\subsection{Categorical v.
Categorical}\label{categorical-v.-categorical}

\subsubsection{Two-way Tables}\label{two-way-tables}

Cross-tabs, cross-tabulations and two-way tables (all the same thing,
different names) can be created by using the \texttt{table()} function.

\subsubsection{Frequency table}\label{frequency-table}

The frequency table is constructed using the \texttt{table()} function.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{table}\NormalTok{(dsmall}\SpecialCharTok{$}\NormalTok{cut, dsmall}\SpecialCharTok{$}\NormalTok{price\_range)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
           
            [-2.5,2.5] (2.5,7.5] (7.5,12.5] (12.5,17.5] (17.5,22.5]
  Fair              15        13          4           1           1
  Good              41        45          8           5           0
  Very Good        108        78         22          12           0
  Premium          111        86         35          20           5
  Ideal            237       103         34          14           2
\end{verbatim}

There are 4 Fair diamonds that cost between 7.5 and 12.5 thousand
dollars, and 103 Ideal quality diamonds that cost between 2.5 and 7.5k.

\paragraph{Cell proportions}\label{cell-proportions}

Wrapping \texttt{prop.table()} around a table gives you the
\textbf{cell} proportions.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{table}\NormalTok{(dsmall}\SpecialCharTok{$}\NormalTok{cut, dsmall}\SpecialCharTok{$}\NormalTok{price\_range) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{prop.table}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
           
            [-2.5,2.5] (2.5,7.5] (7.5,12.5] (12.5,17.5] (17.5,22.5]
  Fair           0.015     0.013      0.004       0.001       0.001
  Good           0.041     0.045      0.008       0.005       0.000
  Very Good      0.108     0.078      0.022       0.012       0.000
  Premium        0.111     0.086      0.035       0.020       0.005
  Ideal          0.237     0.103      0.034       0.014       0.002
\end{verbatim}

\begin{itemize}
\tightlist
\item
  1.5\% of all diamonds are Fair cut and cost under 2.5k.
\item
  0.5\% of all diamonds are Premium cut and cost over 17.5k
\end{itemize}

\paragraph{Row proportions}\label{row-proportions}

To get the \textbf{row} proportions, specify \texttt{margin=1}. The
percentages now add up to 1 across the rows.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{table}\NormalTok{(dsmall}\SpecialCharTok{$}\NormalTok{cut, dsmall}\SpecialCharTok{$}\NormalTok{price\_range) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{prop.table}\NormalTok{(}\AttributeTok{margin=}\DecValTok{1}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{round}\NormalTok{(}\DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
           
            [-2.5,2.5] (2.5,7.5] (7.5,12.5] (12.5,17.5] (17.5,22.5]
  Fair           0.441     0.382      0.118       0.029       0.029
  Good           0.414     0.455      0.081       0.051       0.000
  Very Good      0.491     0.355      0.100       0.055       0.000
  Premium        0.432     0.335      0.136       0.078       0.019
  Ideal          0.608     0.264      0.087       0.036       0.005
\end{verbatim}

\begin{itemize}
\tightlist
\item
  44.1\% of Fair quality diamonds cost under 2.5k
\item
  1.9\% of Premium quality diamonds cost over 17.5k.
\end{itemize}

\paragraph{Column proportions}\label{column-proportions}

To get the \textbf{column} proportions, you specify \texttt{margin=2}.
The percentages now add up to 1 down the columns.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{table}\NormalTok{(dsmall}\SpecialCharTok{$}\NormalTok{cut, dsmall}\SpecialCharTok{$}\NormalTok{price\_range) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{prop.table}\NormalTok{(}\AttributeTok{margin=}\DecValTok{2}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{round}\NormalTok{(}\DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
           
            [-2.5,2.5] (2.5,7.5] (7.5,12.5] (12.5,17.5] (17.5,22.5]
  Fair           0.029     0.040      0.039       0.019       0.125
  Good           0.080     0.138      0.078       0.096       0.000
  Very Good      0.211     0.240      0.214       0.231       0.000
  Premium        0.217     0.265      0.340       0.385       0.625
  Ideal          0.463     0.317      0.330       0.269       0.250
\end{verbatim}

\begin{itemize}
\tightlist
\item
  8\% of diamonds that cost under 2.5k are of Good quality
\item
  25\% of diamonds that cost over 17.5k are Ideal quality
\end{itemize}

\subsubsection{Grouped bar charts}\label{grouped-bar-charts}

To compare proportions of one categorical variable within the same level
of another, is to use grouped barcharts.

Plot the cut on the x axis, but then \texttt{fill} using the second
categorical variable. This has the effect of visualizing the
\textbf{row} percents from the table above. Here it is the percent of
\texttt{price\_range}, within each type of \texttt{cut}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(dsmall, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{cut, }\AttributeTok{fill=}\NormalTok{price\_range)) }\SpecialCharTok{+} \FunctionTok{geom\_bar}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{plots_files/figure-pdf/unnamed-chunk-17-1.pdf}}

The default is a stacked barchart. So add the argument
\texttt{position=dodge} inside the \texttt{geom\_bar} layer to put the
bars side by side.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(dsmall, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{cut, }\AttributeTok{fill=}\NormalTok{price\_range)) }\SpecialCharTok{+} \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{position =} \StringTok{"dodge"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{plots_files/figure-pdf/unnamed-chunk-18-1.pdf}}

And look, an automatic legend. What if I wanted to better compare cut
within price range? This is the \textbf{column} percentages. Just switch
which variable is the x axis and which one is used to fill the colors!

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(dsmall, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{price\_range, }\AttributeTok{fill=}\NormalTok{cut)) }\SpecialCharTok{+} \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{position =} \StringTok{"dodge"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{plots_files/figure-pdf/unnamed-chunk-19-1.pdf}}

And this easy change is why we love \texttt{ggplot2}.

\subsection{Continuous v. Continuous}\label{continuous-v.-continuous}

\subsubsection{Scatterplot}\label{scatterplot}

The most common method of visualizing the relationship between two
continuous variables is by using a scatterplot.

With ggplot we specify both the x and y variables, and add a point.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(dsmall, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{carat, }\AttributeTok{y=}\NormalTok{price)) }\SpecialCharTok{+} \FunctionTok{geom\_point}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{plots_files/figure-pdf/unnamed-chunk-20-1.pdf}}

\paragraph{Adding lines to the
scatterplots}\label{adding-lines-to-the-scatterplots}

Two most common trend lines added to a scatterplots are the ``best fit''
straight line and the ``lowess'' smoother line. This is done by adding a
\texttt{geom\_smooth()} layer.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(dsmall, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{carat, }\AttributeTok{y=}\NormalTok{price)) }\SpecialCharTok{+} \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+} \FunctionTok{geom\_smooth}\NormalTok{() }
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{plots_files/figure-pdf/unnamed-chunk-21-1.pdf}}

Here the point-wise confidence interval for this lowess line is shown in
grey. If you want to turn the confidence interval off, use
\texttt{se=FALSE}. Also notice that the smoothing geom uses a different
function or window than the \texttt{lowess} function used in base
graphics.

Here it is again using the \texttt{ggplot} plotting function and adding
another \texttt{geom\_smooth()} layer for the \texttt{lm} (linear model)
line in blue, and the lowess line (by not specifying a method) in red.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(dsmall, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{carat, }\AttributeTok{y=}\NormalTok{price)) }\SpecialCharTok{+} \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{se=}\ConstantTok{FALSE}\NormalTok{, }\AttributeTok{method=}\StringTok{"lm"}\NormalTok{, }\AttributeTok{color=}\StringTok{"blue"}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{se=}\ConstantTok{FALSE}\NormalTok{, }\AttributeTok{color=}\StringTok{"red"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{plots_files/figure-pdf/unnamed-chunk-22-1.pdf}}

\subsection{Continuous v. Categorical}\label{continuous-v.-categorical}

Create an appropriate plot for a continuous variable, and plot it for
each level of the categorical variable by shading the plots or coloring
the lines depending on the group.

\subsubsection{Overlaid density plots}\label{overlaid-density-plots}

You could \texttt{fill} the density curves depending on the group, but
then it's hard to see overlap.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(dsmall, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{depth, }\AttributeTok{fill=}\NormalTok{cut)) }\SpecialCharTok{+} \FunctionTok{geom\_density}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{plots_files/figure-pdf/unnamed-chunk-23-1.pdf}}

We can adjust the transparency of the density curve by applying a value
to \texttt{alpha} inside the density layer. Alpha is a measure of
transparency, from 0=clear to 1=opaque.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(dsmall, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{depth, }\AttributeTok{fill=}\NormalTok{cut)) }\SpecialCharTok{+} \FunctionTok{geom\_density}\NormalTok{(}\AttributeTok{alpha=}\NormalTok{.}\DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{plots_files/figure-pdf/unnamed-chunk-24-1.pdf}}

Now we can see that there are some premium cut diamonds with depths
around 62. This peak was hidden from us before.

You could also just color the lines and leave the fill alone.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(dsmall, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{depth, }\AttributeTok{color=}\NormalTok{cut)) }\SpecialCharTok{+} \FunctionTok{geom\_density}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{plots_files/figure-pdf/unnamed-chunk-25-1.pdf}}

We won't talk about changing colors or the background in this lab, but
the yellow is pretty hard to read.

\subsubsection{Grouped boxplots}\label{grouped-boxplots}

\texttt{ggplot} is happy to do grouped boxplots. Put the continuous
variable on the y, categorical on the x.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(dsmall, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{price\_range, }\AttributeTok{y=}\NormalTok{carat)) }\SpecialCharTok{+} \FunctionTok{geom\_boxplot}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{plots_files/figure-pdf/unnamed-chunk-26-1.pdf}}

\paragraph{Adding violins to the
boxplot}\label{adding-violins-to-the-boxplot}

A violin plot is like a density plot, turned on its side, and reflected
around the axis for symmetry purposes. Overlaying a boxplot and a violin
plot serves a similar purpose to Histograms + Density plots. It shows
outliers, the location of most the data, and better shows the shape/skew
of the distribution. Let's also \texttt{fill} the geometries with the
same color as what is on the x-axis. Not 100\% needed but nice for
display sometimes.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(dsmall, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{price\_range, }\AttributeTok{y=}\NormalTok{carat, }\AttributeTok{fill=}\NormalTok{price\_range)) }\SpecialCharTok{+}
        \FunctionTok{geom\_violin}\NormalTok{(}\AttributeTok{alpha=}\NormalTok{.}\DecValTok{1}\NormalTok{) }\SpecialCharTok{+} 
        \FunctionTok{geom\_boxplot}\NormalTok{(}\AttributeTok{alpha=}\NormalTok{.}\DecValTok{5}\NormalTok{, }\AttributeTok{width=}\NormalTok{.}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{plots_files/figure-pdf/unnamed-chunk-27-1.pdf}}

\chapter{Data management and
aggregation}\label{data-management-and-aggregation}

\section{Introduction (Video)}\label{introduction-video}

When working with data you must:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Figure out what you want to do.
\item
  Precisely describe what you want in the form of a computer program.
\item
  Execute the code.
\end{enumerate}

The dplyr package makes each of these steps as fast and easy as possible
by:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Elucidating the most common data manipulation operations, so that your
  options are helpfully constrained when thinking about how to tackle a
  problem.
\item
  Providing simple functions that correspond to the most common data
  manipulation verbs, so that you can easily translate your thoughts
  into code.
\item
  Using efficient data storage back ends, so that you spend as little
  time waiting for the computer as possible.
\end{enumerate}

\begin{tcolorbox}[enhanced jigsaw, arc=.35mm, titlerule=0mm, left=2mm, bottomrule=.15mm, bottomtitle=1mm, opacitybacktitle=0.6, colbacktitle=quarto-callout-note-color!10!white, colback=white, breakable, opacityback=0, colframe=quarto-callout-note-color-frame, toptitle=1mm, title=\textcolor{quarto-callout-note-color}{\faInfo}\hspace{0.5em}{Learning Objectives}, rightrule=.15mm, toprule=.15mm, leftrule=.75mm, coltitle=black]

After completing this lesson students will be able to

\begin{itemize}
\tightlist
\item
  Explain the difference between a \texttt{data.table} and a
  \texttt{tibble}.
\item
  Build and execute a chain of command to accomplish a data management
  task
\item
  Extract certain rows using \texttt{select}.
\item
  Create new variables using \texttt{mutate}.
\item
  Rename variables using \texttt{rename}
\item
  Subset the data based on a criteria using \texttt{filter}.
\item
  Create summary statistics using \texttt{group\_by} and
  \texttt{summarize}
\item
  Learn how to use code chunk options to disable warning messages.
\end{itemize}

\end{tcolorbox}

\begin{tcolorbox}[enhanced jigsaw, arc=.35mm, titlerule=0mm, left=2mm, bottomrule=.15mm, bottomtitle=1mm, opacitybacktitle=0.6, colbacktitle=quarto-callout-important-color!10!white, colback=white, breakable, opacityback=0, colframe=quarto-callout-important-color-frame, toptitle=1mm, title=\textcolor{quarto-callout-important-color}{\faExclamation}\hspace{0.5em}{Preparation}, rightrule=.15mm, toprule=.15mm, leftrule=.75mm, coltitle=black]

Prior to this lesson students should

\begin{itemize}
\tightlist
\item
  Download the \href{08_dplyr_notes.Rmd}{{[}08\_dplyr\_notes.Rmd{]}} R
  markdown file and save into your \texttt{Math130/notes} folder.
\item
  Ensure that the \texttt{dplyr} and \texttt{nycflights13} packages are
  installed by running the first code chunk.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(dplyr)}
\NormalTok{flights }\OtherTok{\textless{}{-}}\NormalTok{ nycflights13}\SpecialCharTok{::}\NormalTok{flights}
\end{Highlighting}
\end{Shaded}

\end{tcolorbox}

\subsection{Exploring airline flight data with
dplyr.}\label{exploring-airline-flight-data-with-dplyr.}

The \texttt{nycflights13} package contains several data sets that can be
used to help understand what causes delays. We will be using the
\texttt{flights} data set which contains information about all flights
that departed from NYC (e.g.~EWR, JFK and LGA) in 2013.

\subsection{Tibbles}\label{tibbles}

The \texttt{flights} data set, and any data set created with
\texttt{dplyr}, has a specific data type called a \texttt{tibble}. These
are not as furry and prolific as their cousins the \texttt{tribbles}.
\texttt{tibbles} behaves for all intents and purposes as a
\texttt{data.frame}, just gets displayed differently. For example, the
\texttt{flights} data set contains data on 19 characteristics
(variables) from 336,776 flights. There's no way I would want to print
out a data set that large. But I'm gonna\ldots.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{flights}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 336,776 x 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   <int> <int> <int>    <int>          <int>     <dbl>    <int>          <int>
 1  2013     1     1      517            515         2      830            819
 2  2013     1     1      533            529         4      850            830
 3  2013     1     1      542            540         2      923            850
 4  2013     1     1      544            545        -1     1004           1022
 5  2013     1     1      554            600        -6      812            837
 6  2013     1     1      554            558        -4      740            728
 7  2013     1     1      555            600        -5      913            854
 8  2013     1     1      557            600        -3      709            723
 9  2013     1     1      557            600        -3      838            846
10  2013     1     1      558            600        -2      753            745
# i 336,766 more rows
# i 11 more variables: arr_delay <dbl>, carrier <chr>, flight <int>,
#   tailnum <chr>, origin <chr>, dest <chr>, air_time <dbl>, distance <dbl>,
#   hour <dbl>, minute <dbl>, time_hour <dttm>
\end{verbatim}

The output has been trimmed to something more reasonable for our viewing
pleasure. This may not seem such a big deal because R Studio already
provides some level of truncation for our viewing pleasure.

\section{Basic verbs (Video)}\label{basic-verbs-video}

The \texttt{dplyr} package contains new data manipulation functions,
also called verbs. We will look at the following verbs:

\begin{itemize}
\tightlist
\item
  \texttt{filter()}: Returns a subset of the rows.
\item
  \texttt{select()}: Returns only the listed columns.
\item
  \texttt{rename()}: Renames the variables listed.
\item
  \texttt{mutate()}: Adds columns from existing data.
\item
  \texttt{summarise()}: Reduces each group to a single row by
  calculating aggregate measures.
\item
  \texttt{group\_by()}: Groups a data set on a factor variable, such
  that all functions performed are then done on each level of the
  factor.
\end{itemize}

\subsection{Filter}\label{filter}

\texttt{filter()} allows you to select a subset of the rows of a data
frame. The first argument is the name of the data frame, and the second
and subsequent are filtering expressions evaluated in the context of
that data frame. For example, we can select all flights on January 1st
with

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{filter}\NormalTok{(flights, month }\SpecialCharTok{==} \DecValTok{1}\NormalTok{, day }\SpecialCharTok{==} \DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 842 x 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   <int> <int> <int>    <int>          <int>     <dbl>    <int>          <int>
 1  2013     1     1      517            515         2      830            819
 2  2013     1     1      533            529         4      850            830
 3  2013     1     1      542            540         2      923            850
 4  2013     1     1      544            545        -1     1004           1022
 5  2013     1     1      554            600        -6      812            837
 6  2013     1     1      554            558        -4      740            728
 7  2013     1     1      555            600        -5      913            854
 8  2013     1     1      557            600        -3      709            723
 9  2013     1     1      557            600        -3      838            846
10  2013     1     1      558            600        -2      753            745
# i 832 more rows
# i 11 more variables: arr_delay <dbl>, carrier <chr>, flight <int>,
#   tailnum <chr>, origin <chr>, dest <chr>, air_time <dbl>, distance <dbl>,
#   hour <dbl>, minute <dbl>, time_hour <dttm>
\end{verbatim}

\texttt{filter()} works similarly to \texttt{subset()} except that you
can give it any number of filtering conditions which are joined together
with \&. You can use other Boolean operators explicitly. Here we select
flights in January or February.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{filter}\NormalTok{(flights, month }\SpecialCharTok{==} \DecValTok{1} \SpecialCharTok{|}\NormalTok{ month }\SpecialCharTok{==} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 51,955 x 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   <int> <int> <int>    <int>          <int>     <dbl>    <int>          <int>
 1  2013     1     1      517            515         2      830            819
 2  2013     1     1      533            529         4      850            830
 3  2013     1     1      542            540         2      923            850
 4  2013     1     1      544            545        -1     1004           1022
 5  2013     1     1      554            600        -6      812            837
 6  2013     1     1      554            558        -4      740            728
 7  2013     1     1      555            600        -5      913            854
 8  2013     1     1      557            600        -3      709            723
 9  2013     1     1      557            600        -3      838            846
10  2013     1     1      558            600        -2      753            745
# i 51,945 more rows
# i 11 more variables: arr_delay <dbl>, carrier <chr>, flight <int>,
#   tailnum <chr>, origin <chr>, dest <chr>, air_time <dbl>, distance <dbl>,
#   hour <dbl>, minute <dbl>, time_hour <dttm>
\end{verbatim}

\subsection{Select}\label{select}

Often you work with large data sets with many columns where only a few
are actually of interest to you. \texttt{select()} allows you to rapidly
zoom in on a useful subset using operations that usually only work on
numeric variable positions.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{select}\NormalTok{(flights, month, day, year)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 336,776 x 3
   month   day  year
   <int> <int> <int>
 1     1     1  2013
 2     1     1  2013
 3     1     1  2013
 4     1     1  2013
 5     1     1  2013
 6     1     1  2013
 7     1     1  2013
 8     1     1  2013
 9     1     1  2013
10     1     1  2013
# i 336,766 more rows
\end{verbatim}

You can use a colon (:) to select all columns physically located between
two variables.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{select}\NormalTok{(flights, year}\SpecialCharTok{:}\NormalTok{day)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 336,776 x 3
    year month   day
   <int> <int> <int>
 1  2013     1     1
 2  2013     1     1
 3  2013     1     1
 4  2013     1     1
 5  2013     1     1
 6  2013     1     1
 7  2013     1     1
 8  2013     1     1
 9  2013     1     1
10  2013     1     1
# i 336,766 more rows
\end{verbatim}

To exclude specific columns you use the minus sign (-)

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{select}\NormalTok{(flights, }\SpecialCharTok{{-}}\NormalTok{carrier)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 336,776 x 18
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   <int> <int> <int>    <int>          <int>     <dbl>    <int>          <int>
 1  2013     1     1      517            515         2      830            819
 2  2013     1     1      533            529         4      850            830
 3  2013     1     1      542            540         2      923            850
 4  2013     1     1      544            545        -1     1004           1022
 5  2013     1     1      554            600        -6      812            837
 6  2013     1     1      554            558        -4      740            728
 7  2013     1     1      555            600        -5      913            854
 8  2013     1     1      557            600        -3      709            723
 9  2013     1     1      557            600        -3      838            846
10  2013     1     1      558            600        -2      753            745
# i 336,766 more rows
# i 10 more variables: arr_delay <dbl>, flight <int>, tailnum <chr>,
#   origin <chr>, dest <chr>, air_time <dbl>, distance <dbl>, hour <dbl>,
#   minute <dbl>, time_hour <dttm>
\end{verbatim}

This also works to exclude all columns EXCEPT the ones between two
variables.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{select}\NormalTok{(flights, }\SpecialCharTok{{-}}\NormalTok{(year}\SpecialCharTok{:}\NormalTok{day))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 336,776 x 16
   dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier
      <int>          <int>     <dbl>    <int>          <int>     <dbl> <chr>  
 1      517            515         2      830            819        11 UA     
 2      533            529         4      850            830        20 UA     
 3      542            540         2      923            850        33 AA     
 4      544            545        -1     1004           1022       -18 B6     
 5      554            600        -6      812            837       -25 DL     
 6      554            558        -4      740            728        12 UA     
 7      555            600        -5      913            854        19 B6     
 8      557            600        -3      709            723       -14 EV     
 9      557            600        -3      838            846        -8 B6     
10      558            600        -2      753            745         8 AA     
# i 336,766 more rows
# i 9 more variables: flight <int>, tailnum <chr>, origin <chr>, dest <chr>,
#   air_time <dbl>, distance <dbl>, hour <dbl>, minute <dbl>, time_hour <dttm>
\end{verbatim}

\subsection{Rename}\label{rename}

Sometimes variables come to you in really obscure naming conventions.
What the heck is SBA641? New to \texttt{dplyr} 1.0.0 is the
\texttt{rename()} function. Works like magic to convert
\texttt{old\ name} to a \texttt{new\ name}. The generic syntax is
\texttt{rename(new\ =\ old)}

So to rename \texttt{dep\_time} to \texttt{departure\_time} we would
type

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{rename}\NormalTok{(flights, }\AttributeTok{departure\_time =}\NormalTok{ dep\_time)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 336,776 x 19
    year month   day departure_time sched_dep_time dep_delay arr_time
   <int> <int> <int>          <int>          <int>     <dbl>    <int>
 1  2013     1     1            517            515         2      830
 2  2013     1     1            533            529         4      850
 3  2013     1     1            542            540         2      923
 4  2013     1     1            544            545        -1     1004
 5  2013     1     1            554            600        -6      812
 6  2013     1     1            554            558        -4      740
 7  2013     1     1            555            600        -5      913
 8  2013     1     1            557            600        -3      709
 9  2013     1     1            557            600        -3      838
10  2013     1     1            558            600        -2      753
# i 336,766 more rows
# i 12 more variables: sched_arr_time <int>, arr_delay <dbl>, carrier <chr>,
#   flight <int>, tailnum <chr>, origin <chr>, dest <chr>, air_time <dbl>,
#   distance <dbl>, hour <dbl>, minute <dbl>, time_hour <dttm>
\end{verbatim}

The variable name on the 3rd column now says \texttt{departure\_time}
instead of \texttt{dep\_time}.

\begin{quote}
For the purpose of these lecture notes I am not making this change
permenant. There is no assignment operator \texttt{\textless{}-} used
here, so this change is not going to persist into later code.
\end{quote}

\subsection{Mutate}\label{mutate}

As well as selecting from the set of existing columns, it's often useful
to add new columns that are functions of existing columns. This is the
job of \texttt{mutate()}!

Here we create two variables: gain (as arrival delay minus departure
delay) and speed (as distance divided by time, converted to hours).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a }\OtherTok{\textless{}{-}} \FunctionTok{mutate}\NormalTok{(flights, }\AttributeTok{gain =}\NormalTok{ arr\_delay }\SpecialCharTok{{-}}\NormalTok{ dep\_delay, }
                \AttributeTok{speed =}\NormalTok{ distance }\SpecialCharTok{/}\NormalTok{ air\_time }\SpecialCharTok{*} \DecValTok{60}\NormalTok{)}
\FunctionTok{select}\NormalTok{(a, gain, distance, air\_time, speed)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 336,776 x 4
    gain distance air_time speed
   <dbl>    <dbl>    <dbl> <dbl>
 1     9     1400      227  370.
 2    16     1416      227  374.
 3    31     1089      160  408.
 4   -17     1576      183  517.
 5   -19      762      116  394.
 6    16      719      150  288.
 7    24     1065      158  404.
 8   -11      229       53  259.
 9    -5      944      140  405.
10    10      733      138  319.
# i 336,766 more rows
\end{verbatim}

One key advantage of mutate is that you can refer to the columns you
just created. Mutate flights to create two variables,
\texttt{gain\ =\ arr\_delay\ -\ dep\_delay} and
\texttt{gain\_per\_hour\ =\ gain\ /\ (air\_time\ /\ 60)}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mutate}\NormalTok{(flights, }\AttributeTok{gain =}\NormalTok{ arr\_delay }\SpecialCharTok{{-}}\NormalTok{ dep\_delay, }
                \AttributeTok{gain\_per\_hour =}\NormalTok{ gain }\SpecialCharTok{/}\NormalTok{ (air\_time }\SpecialCharTok{/} \DecValTok{60}\NormalTok{ ))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 336,776 x 21
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   <int> <int> <int>    <int>          <int>     <dbl>    <int>          <int>
 1  2013     1     1      517            515         2      830            819
 2  2013     1     1      533            529         4      850            830
 3  2013     1     1      542            540         2      923            850
 4  2013     1     1      544            545        -1     1004           1022
 5  2013     1     1      554            600        -6      812            837
 6  2013     1     1      554            558        -4      740            728
 7  2013     1     1      555            600        -5      913            854
 8  2013     1     1      557            600        -3      709            723
 9  2013     1     1      557            600        -3      838            846
10  2013     1     1      558            600        -2      753            745
# i 336,766 more rows
# i 13 more variables: arr_delay <dbl>, carrier <chr>, flight <int>,
#   tailnum <chr>, origin <chr>, dest <chr>, air_time <dbl>, distance <dbl>,
#   hour <dbl>, minute <dbl>, time_hour <dttm>, gain <dbl>, gain_per_hour <dbl>
\end{verbatim}

\subsection{Summarize}\label{summarize}

The last verb is \texttt{summarise()}, which collapses a data frame to a
single row. It's not very useful yet. We can create a new variable
called delay that is the average departure delay on the entire flights
data set.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{summarise}\NormalTok{(flights, }\AttributeTok{delay =} \FunctionTok{mean}\NormalTok{(dep\_delay, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 1 x 1
  delay
  <dbl>
1  12.6
\end{verbatim}

\section{Grouped Operations (Video)}\label{grouped-operations-video}

The above verbs are useful, but they become really powerful when you
combine them with the idea of ``group by'', repeating the operation
individually on groups of observations within the dataset. In dplyr, you
use the \texttt{group\_by()} function to describe how to break a dataset
down into groups of rows. You can then use the resulting object in
exactly the same functions as above; they'll automatically work ``by
group'' when the input is a grouped.

Let's demonstrate how some of these functions work after grouping the
flights data set by month. First we'll create a new data set that is
grouped by month.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{by\_month }\OtherTok{\textless{}{-}} \FunctionTok{group\_by}\NormalTok{(flights, month)}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  The \texttt{summarise()} verb allows you to calculate summary
  statistics for each group. This is probably the most common function
  that is used in conjunction with \texttt{group\_by}. For example, the
  average distance flown per month.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{summarise}\NormalTok{(by\_month, }\AttributeTok{avg\_airtime =} \FunctionTok{mean}\NormalTok{(distance, }\AttributeTok{na.rm=}\ConstantTok{TRUE}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 12 x 2
   month avg_airtime
   <int>       <dbl>
 1     1       1007.
 2     2       1001.
 3     3       1012.
 4     4       1039.
 5     5       1041.
 6     6       1057.
 7     7       1059.
 8     8       1062.
 9     9       1041.
10    10       1039.
11    11       1050.
12    12       1065.
\end{verbatim}

Or simply the total number of flights per month.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{summarize}\NormalTok{(by\_month, }\AttributeTok{count=}\FunctionTok{n}\NormalTok{())}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 12 x 2
   month count
   <int> <int>
 1     1 27004
 2     2 24951
 3     3 28834
 4     4 28330
 5     5 28796
 6     6 28243
 7     7 29425
 8     8 29327
 9     9 27574
10    10 28889
11    11 27268
12    12 28135
\end{verbatim}

\section{Chaining Operations (Video)}\label{chaining-operations-video}

Consider the following group of operations that take the data set
\texttt{flights}, and produce a final data set (\texttt{a4}) that
contains only the flights where the daily average delay is greater than
a half hour.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a1 }\OtherTok{\textless{}{-}} \FunctionTok{group\_by}\NormalTok{(flights, year, month, day)}
\NormalTok{a2 }\OtherTok{\textless{}{-}} \FunctionTok{select}\NormalTok{(a1, arr\_delay, dep\_delay)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Adding missing grouping variables: `year`, `month`, `day`
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a3 }\OtherTok{\textless{}{-}} \FunctionTok{summarise}\NormalTok{(a2,}
                \AttributeTok{arr =} \FunctionTok{mean}\NormalTok{(arr\_delay, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
                \AttributeTok{dep =} \FunctionTok{mean}\NormalTok{(dep\_delay, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
`summarise()` has grouped output by 'year', 'month'. You can override using the
`.groups` argument.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a4 }\OtherTok{\textless{}{-}} \FunctionTok{filter}\NormalTok{(a3, arr }\SpecialCharTok{\textgreater{}} \DecValTok{30} \SpecialCharTok{|}\NormalTok{ dep }\SpecialCharTok{\textgreater{}} \DecValTok{30}\NormalTok{)}
\FunctionTok{head}\NormalTok{(a4)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 6 x 5
# Groups:   year, month [3]
   year month   day   arr   dep
  <int> <int> <int> <dbl> <dbl>
1  2013     1    16  34.2  24.6
2  2013     1    31  32.6  28.7
3  2013     2    11  36.3  39.1
4  2013     2    27  31.3  37.8
5  2013     3     8  85.9  83.5
6  2013     3    18  41.3  30.1
\end{verbatim}

It does the trick, but what if you don't want to save all the
intermediate results (\texttt{a1} - \texttt{a3})? Well these verbs are
\texttt{function}, so they can be wrapped inside other functions to
create a nesting type structure.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{filter}\NormalTok{(}
  \FunctionTok{summarise}\NormalTok{(}
    \FunctionTok{select}\NormalTok{(}
      \FunctionTok{group\_by}\NormalTok{(flights, year, month, day),}
\NormalTok{      arr\_delay, dep\_delay}
\NormalTok{    ),}
    \AttributeTok{arr =} \FunctionTok{mean}\NormalTok{(arr\_delay, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{dep =} \FunctionTok{mean}\NormalTok{(dep\_delay, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{  ),}
\NormalTok{  arr }\SpecialCharTok{\textgreater{}} \DecValTok{30} \SpecialCharTok{|}\NormalTok{ dep }\SpecialCharTok{\textgreater{}} \DecValTok{30}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Woah, that is HARD to read! This is difficult to read because the order
of the operations is from inside to out, and the arguments are a long
way away from the function. To get around this problem, dplyr provides
the \texttt{\%\textgreater{}\%} operator.
\texttt{x\ \%\textgreater{}\%\ f(y)} turns into \texttt{f(x,\ y)} so you
can use it to rewrite multiple operations so you can read from
left-to-right, top-to-bottom:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{flights }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(year, month, day) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(arr\_delay, dep\_delay) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarise}\NormalTok{(}
    \AttributeTok{arr =} \FunctionTok{mean}\NormalTok{(arr\_delay, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{dep =} \FunctionTok{mean}\NormalTok{(dep\_delay, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(arr }\SpecialCharTok{\textgreater{}} \DecValTok{30} \SpecialCharTok{|}\NormalTok{ dep }\SpecialCharTok{\textgreater{}} \DecValTok{30}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Adding missing grouping variables: `year`, `month`, `day`
`summarise()` has grouped output by 'year', 'month'. You can override using the
`.groups` argument.
\end{verbatim}

\begin{verbatim}
# A tibble: 49 x 5
# Groups:   year, month [11]
    year month   day   arr   dep
   <int> <int> <int> <dbl> <dbl>
 1  2013     1    16  34.2  24.6
 2  2013     1    31  32.6  28.7
 3  2013     2    11  36.3  39.1
 4  2013     2    27  31.3  37.8
 5  2013     3     8  85.9  83.5
 6  2013     3    18  41.3  30.1
 7  2013     4    10  38.4  33.0
 8  2013     4    12  36.0  34.8
 9  2013     4    18  36.0  34.9
10  2013     4    19  47.9  46.1
# i 39 more rows
\end{verbatim}

Another way you can read this is by thinking ``and then'' when you see
the \texttt{\%\textgreater{}\%} operator. So the above code takes the
data set flights\\
.. and then groups by day\\
.. and then selects the delay variables\\
.. and then calculates the means\\
.. and then filters on a delay over half hour.

The same 4 steps that resulted in the \texttt{a4} data set, but without
all the intermediate data saved! This can be \textbf{very important}
when dealing with Big Data. \texttt{R} stores all data in memory, so if
your little computer only has 2G of RAM and you're working with a data
set that is 500M in size, your computers memory will be used up fast.
\texttt{a1} takes 500M, \texttt{a2} another 500M, by now your computer
is getting slow. Make another copy at \texttt{a3} and it gets worse,
\texttt{a4} now likely won't even be able to be created because you'll
be out of memory.

\chapter{Getting data into R}\label{getting-data-into-r}

\section{Introduction (Video)}\label{introduction-video-1}

In this lesson we will introduce ways to get data from external files
into R, how R works with data, and how to use functions to explore your
data frame.

\begin{tcolorbox}[enhanced jigsaw, arc=.35mm, titlerule=0mm, left=2mm, bottomrule=.15mm, bottomtitle=1mm, opacitybacktitle=0.6, colbacktitle=quarto-callout-note-color!10!white, colback=white, breakable, opacityback=0, colframe=quarto-callout-note-color-frame, toptitle=1mm, title=\textcolor{quarto-callout-note-color}{\faInfo}\hspace{0.5em}{Learning Objectives}, rightrule=.15mm, toprule=.15mm, leftrule=.75mm, coltitle=black]

After completing this lesson learners will be able to

\begin{itemize}
\tightlist
\item
  Import data that is stored in an external Excel, CSV or tab-delimited
  text file into R.
\item
  Compare and contrast the three file types discussed in this lesson.
\item
  Use functions to examine data objects to ensure data was imported
  correctly.
\end{itemize}

\end{tcolorbox}

\begin{tcolorbox}[enhanced jigsaw, arc=.35mm, titlerule=0mm, left=2mm, bottomrule=.15mm, bottomtitle=1mm, opacitybacktitle=0.6, colbacktitle=quarto-callout-important-color!10!white, colback=white, breakable, opacityback=0, colframe=quarto-callout-important-color-frame, toptitle=1mm, title=\textcolor{quarto-callout-important-color}{\faExclamation}\hspace{0.5em}{Prior to this lesson learners should}, rightrule=.15mm, toprule=.15mm, leftrule=.75mm, coltitle=black]

\begin{itemize}
\tightlist
\item
  Download the \href{09_import_notes.Rmd}{{[}09\_import\_notes.Rmd{]}} R
  markdown file and save into your \texttt{Math130/notes} folder.
\item
  Install the following packages: \texttt{gridExtra},
  \texttt{RColorBrewer} and \texttt{sjPlot}.
\item
  Right click each link and save the following data sets into your
  \texttt{Math130/data} folder.
\end{itemize}

:x: \textbf{DO NOT RENAME ANYTHING} If you download multiple copies of
the data, do not keep the versions that have a (1) or some number in the
name. Do not leave these files in your downloads folder.

\begin{itemize}
\tightlist
\item
  \href{https://www.norcalbiostat.com/data/NCbirths.csv}{NCBirths}
\item
  \href{https://www.norcalbiostat.com/data/email.txt}{email}
\item
  \href{https://www.norcalbiostat.com/data/fatal-police-shootings-data.xlsx}{Police
  Shootings}
\end{itemize}

\end{tcolorbox}

\section{File types (Video)}\label{file-types-video}

In this lesson we are only going to explore reading files that exist on
your computer into R from three most commonly used data sources: A
tab-delimited text file, A CSV file and an Excel file. The three
different files we will be using have different file types, or
extensions.

\begin{itemize}
\tightlist
\item
  \texttt{email.txt} is a \texttt{.txt} or ``text'' file.
\item
  \texttt{NCBirths.csv} is a \texttt{.csv} or ``comma separated values''
  file.
\item
  \texttt{fatal-police-shootings-data.xlsx} is a \texttt{.xlsx} or Excel
  file.
\end{itemize}

Each of these file types differ in the type of \emph{delimiter} used.
The \emph{delimiter} is a character or symbol that separates columns of
data from each other when stored in an external file. Recall back to the
earlier lesson on data frames and matrices. Each column in the matrix
represented data on a specific variable. Something had to tell R how to
distinguish which values went with which variable.

There are two main types of delimiters we will consider in this class;
comma and tab. That does not mean that data can't be stored in other
ways, these are just the two most common.

Each of these different data types requires a different function or
mechanism to import the data into R. If you use the wrong mechanism, the
data may not be read in correctly if at all.

\section{General Importing data
(Video)}\label{general-importing-data-video}

To import data into R, we have to tell the program explicitly where to
find the files you just downloaded. To do that we need to find the
file's \emph{path}. The \emph{path} is a programmatic way to direct your
computer to the location of a file. It's like the file's address, or,
where it lives on your computer.

In all the examples below, the path shown (\texttt{data/}) is the path
on \textbf{MY} computer. You will have to update this path to
\textbf{YOUR} path on \textbf{YOUR} machine that points to your MATH130
folder.

You can find the path of a file by navigating to the desired file in
your finder or browser window. Right click and copy the file to the
clipboard, then right click and pasting into a R markdown file. This
will show a path that looks something like this:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{file}\SpecialCharTok{:}\ErrorTok{///}\NormalTok{C}\SpecialCharTok{:}\ErrorTok{/}\NormalTok{Math }\DecValTok{130}\SpecialCharTok{/}\NormalTok{Data}\SpecialCharTok{/}\NormalTok{Challenger.txt}
\end{Highlighting}
\end{Shaded}

You will need to remove the \texttt{file:///} part at the beginning
before using this path. You will have three chances in this lab to
practice this.

\subsection{Special Instructions for
Mac}\label{special-instructions-for-mac}

\begin{itemize}
\tightlist
\item
  Navigate to the file or folder you wish to copy the path for
  Right-click (or Control+Click, or a Two-Finger click on trackpads) on
  the file or folder in the Mac Finder
\item
  While in the right-click menu, hold down the OPTION key to reveal the
  ``Copy (item name) as Pathname'' option, which replaces the standard
  Copy option. Once selected, the file or folders path is now in the
  clipboard, ready to be pasted anywhere
\end{itemize}

\emph{Source:
https://stackoverflow.com/questions/52695546/how-to-copy-path-of-a-file-in-mac-os}

\section{Checking the import was
successful}\label{checking-the-import-was-successful}

The first thing you should always do after importing a data file is look
at the raw data and ask yourself the following things:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Were the variable names read in correctly?
\item
  Is there the expected number of rows and columns?
\item
  Are the data types for each variable as expected?
\end{enumerate}

There are many ways this can be done. Here are three:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \texttt{str()} to show you the structure of the data frame.
\item
  \texttt{head()} to show you the top 6 rows
\item
  \texttt{data{[}1:x,\ 1:x{]}} - when the data frame is too large for
  the above two to work well, we can use matrix notation to view only
  the first X columns, and first X rows.
\end{enumerate}

Next we will read in three different data sets, each with unique file
types, and look at each one to make sure it was read in correctly.

\section{Text files}\label{text-files}

Text files are very simple files that have a \texttt{.txt} file
extension. Common delimiters include a space, a comma (,) or a tab.
Uncommon delimiters could include a \% or even a semi-colon. By opening
the file directly on your computer (not in R) you can see what delimiter
is being used.

We will use the \texttt{read.table()} function that is in base R to read
in any type of delimited file. A tab-delimited text file can be read in
using \texttt{"\textbackslash{}t"} as the deliminator character. In this
class you \textbf{ALWAYS} want to include \texttt{header=TRUE} to
signify that the data in the first row contains our column names.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{email }\OtherTok{\textless{}{-}} \FunctionTok{read.table}\NormalTok{(}\StringTok{"data/email.txt"}\NormalTok{, }\AttributeTok{header=}\ConstantTok{TRUE}\NormalTok{, }\AttributeTok{sep=}\StringTok{"}\SpecialCharTok{\textbackslash{}t}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Here we call the \texttt{str()} or \emph{structure} function to examine
the data that was imported.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str}\NormalTok{(email)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
'data.frame':   3921 obs. of  21 variables:
 $ spam        : int  0 0 0 0 0 0 0 0 0 0 ...
 $ to_multiple : int  0 0 0 0 0 0 1 1 0 0 ...
 $ from        : int  1 1 1 1 1 1 1 1 1 1 ...
 $ cc          : int  0 0 0 0 0 0 0 1 0 0 ...
 $ sent_email  : int  0 0 0 0 0 0 1 1 0 0 ...
 $ time        : chr  "2011-12-31 22:16:41" "2011-12-31 23:03:59" "2012-01-01 08:00:32" "2012-01-01 01:09:49" ...
 $ image       : int  0 0 0 0 0 0 0 1 0 0 ...
 $ attach      : int  0 0 0 0 0 0 0 1 0 0 ...
 $ dollar      : int  0 0 4 0 0 0 0 0 0 0 ...
 $ winner      : chr  "no" "no" "no" "no" ...
 $ inherit     : int  0 0 1 0 0 0 0 0 0 0 ...
 $ viagra      : int  0 0 0 0 0 0 0 0 0 0 ...
 $ password    : int  0 0 0 0 2 2 0 0 0 0 ...
 $ num_char    : num  11.37 10.5 7.77 13.26 1.23 ...
 $ line_breaks : int  202 202 192 255 29 25 193 237 69 68 ...
 $ format      : int  1 1 1 1 0 0 1 1 0 1 ...
 $ re_subj     : int  0 0 0 0 0 0 0 0 0 0 ...
 $ exclaim_subj: int  0 0 0 0 0 0 0 0 0 0 ...
 $ urgent_subj : int  0 0 0 0 0 0 0 0 0 0 ...
 $ exclaim_mess: int  0 1 6 48 1 1 1 18 1 0 ...
 $ number      : chr  "big" "small" "small" "small" ...
\end{verbatim}

\begin{itemize}
\tightlist
\item
  The \texttt{email} data set has 3921 observations, and 21 variables.
\item
  The variable names were read in correctly, as evidenced by the words
  in the far right corner after the \texttt{\$}.
\item
  Most variables are treated as numeric integers, except a few are
  factors. Including \texttt{time}. If we wanted to examine a time
  trend, we would need to convert the class into a \texttt{datetime}
\end{itemize}

\begin{quote}
What happens if you forget to include the arguments for \texttt{header}
or \texttt{sep}? Try that now and discuss what happened.
\end{quote}

\textbf{Forgetting both arguments}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{email }\OtherTok{\textless{}{-}} \FunctionTok{read.table}\NormalTok{(}\StringTok{"data/email.txt"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Error in read.table("data/email.txt"): duplicate 'row.names' are not allowed
\end{verbatim}

\textbf{Forgetting the header}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{email }\OtherTok{\textless{}{-}} \FunctionTok{read.table}\NormalTok{(}\StringTok{"data/email.txt"}\NormalTok{, }\AttributeTok{sep=}\StringTok{"}\SpecialCharTok{\textbackslash{}t}\StringTok{"}\NormalTok{)}
\FunctionTok{head}\NormalTok{(email)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
    V1          V2   V3 V4         V5                  V6    V7     V8     V9
1 spam to_multiple from cc sent_email                time image attach dollar
2    0           0    1  0          0 2011-12-31 22:16:41     0      0      0
3    0           0    1  0          0 2011-12-31 23:03:59     0      0      0
4    0           0    1  0          0 2012-01-01 08:00:32     0      0      4
5    0           0    1  0          0 2012-01-01 01:09:49     0      0      0
6    0           0    1  0          0 2012-01-01 02:00:01     0      0      0
     V10     V11    V12      V13      V14         V15    V16     V17
1 winner inherit viagra password num_char line_breaks format re_subj
2     no       0      0        0    11.37         202      1       0
3     no       0      0        0   10.504         202      1       0
4     no       1      0        0    7.773         192      1       0
5     no       0      0        0   13.256         255      1       0
6     no       0      0        2    1.231          29      0       0
           V18         V19          V20    V21
1 exclaim_subj urgent_subj exclaim_mess number
2            0           0            0    big
3            0           0            1  small
4            0           0            6  small
5            0           0           48  small
6            0           0            1   none
\end{verbatim}

\textbf{Forgetting the separator}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{email }\OtherTok{\textless{}{-}} \FunctionTok{read.table}\NormalTok{(}\StringTok{"data/email.txt"}\NormalTok{, }\AttributeTok{header=}\ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Error in read.table("data/email.txt", header = TRUE): duplicate 'row.names' are not allowed
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{head}\NormalTok{(email)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
    V1          V2   V3 V4         V5                  V6    V7     V8     V9
1 spam to_multiple from cc sent_email                time image attach dollar
2    0           0    1  0          0 2011-12-31 22:16:41     0      0      0
3    0           0    1  0          0 2011-12-31 23:03:59     0      0      0
4    0           0    1  0          0 2012-01-01 08:00:32     0      0      4
5    0           0    1  0          0 2012-01-01 01:09:49     0      0      0
6    0           0    1  0          0 2012-01-01 02:00:01     0      0      0
     V10     V11    V12      V13      V14         V15    V16     V17
1 winner inherit viagra password num_char line_breaks format re_subj
2     no       0      0        0    11.37         202      1       0
3     no       0      0        0   10.504         202      1       0
4     no       1      0        0    7.773         192      1       0
5     no       0      0        0   13.256         255      1       0
6     no       0      0        2    1.231          29      0       0
           V18         V19          V20    V21
1 exclaim_subj urgent_subj exclaim_mess number
2            0           0            0    big
3            0           0            1  small
4            0           0            6  small
5            0           0           48  small
6            0           0            1   none
\end{verbatim}

\section{CSV: Comma Separated Values}\label{csv-comma-separated-values}

CSV is a fancy way of saying a text file with comma-separated values
(i.e.~CSV). This file type can also open in Excel--the icons even look
similar. We could use \texttt{read.table()} to import this data file,
but \texttt{read.csv()} is optimized to read in CSV files.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{NCbirths }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"data/NCbirths.csv"}\NormalTok{, }\AttributeTok{header=}\ConstantTok{TRUE}\NormalTok{)}
\FunctionTok{head}\NormalTok{(NCbirths)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  fage mage      mature weeks    premie visits marital gained weight
1   NA   13 younger mom    39 full term     10 married     38   7.63
2   NA   14 younger mom    42 full term     15 married     20   7.88
3   19   15 younger mom    37 full term     11 married     38   6.63
4   21   15 younger mom    41 full term      6 married     34   8.00
5   NA   15 younger mom    39 full term      9 married     27   6.38
6   NA   15 younger mom    38 full term     19 married     22   5.38
  lowbirthweight gender     habit  whitemom
1        not low   male nonsmoker not white
2        not low   male nonsmoker not white
3        not low female nonsmoker     white
4        not low   male nonsmoker     white
5        not low female nonsmoker not white
6            low   male nonsmoker not white
\end{verbatim}

\begin{itemize}
\tightlist
\item
  The \texttt{NCbirths} data set has 1000 rows and 13 columns.
\item
  Variable names are read in OK.
\item
  Most the data is begin read in as factors and integers.
\item
  There are some \texttt{NA} values for the variable \texttt{fage}
  (fathers age).
\end{itemize}

\section{Excel files}\label{excel-files}

The best method to read in Excel files is from the
\href{http://readxl.tidyverse.org/}{\texttt{readxl} package} by
\href{http://hadley.nz/}{Hadley Wickham}. This package need to be
installed first, and then can be simply loaded using the
\texttt{library()} function each time you start an \texttt{R} session
where you will be reading in this type of data.

The \texttt{read\_excel()} function is what we are going to use. Note
the use of the underscore \texttt{\_} instead of a period \texttt{.}
between \texttt{read} and \texttt{excel}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(readxl)}
\NormalTok{police  }\OtherTok{\textless{}{-}} \FunctionTok{read\_excel}\NormalTok{(}\StringTok{"data/fatal{-}police{-}shootings{-}data.xlsx"}\NormalTok{, }\AttributeTok{sheet=}\DecValTok{1}\NormalTok{, }\AttributeTok{col\_names=}\ConstantTok{TRUE}\NormalTok{)}
\NormalTok{police[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{,}\DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
# A tibble: 10 x 5
      id name                date                manner_of_death  armed     
   <dbl> <chr>               <dttm>              <chr>            <chr>     
 1     3 Tim Elliot          2015-01-02 00:00:00 shot             gun       
 2     4 Lewis Lee Lembke    2015-01-02 00:00:00 shot             gun       
 3     5 John Paul Quintero  2015-01-03 00:00:00 shot and Tasered unarmed   
 4     8 Matthew Hoffman     2015-01-04 00:00:00 shot             toy weapon
 5     9 Michael Rodriguez   2015-01-04 00:00:00 shot             nail gun  
 6    11 Kenneth Joe Brown   2015-01-04 00:00:00 shot             gun       
 7    13 Kenneth Arnold Buck 2015-01-05 00:00:00 shot             gun       
 8    15 Brock Nichols       2015-01-06 00:00:00 shot             gun       
 9    16 Autumn Steele       2015-01-06 00:00:00 shot             unarmed   
10    17 Leslie Sapp III     2015-01-06 00:00:00 shot             toy weapon
\end{verbatim}

\begin{itemize}
\tightlist
\item
  The variable \texttt{date} is a \texttt{dttm} or \emph{date-time}
  variable. This means \texttt{R} recognizes it directly as a date, not
  some string of numbers.
\item
  Categorical variables such as \texttt{manner\_of\_death} and
  \texttt{city} are read in as \texttt{character} instead of factor. We
  may or may not want to change that later.
\item
  Numeric variables such as \texttt{age} are of type \texttt{dbl}
  (double). This is similar to \texttt{integer} or \texttt{numeric}, so
  we are fine.
\end{itemize}

\chapter{Graphing Enhancements}\label{graphing-enhancements}

\section*{Introduction (Video)}\label{introduction-video-2}
\addcontentsline{toc}{section}{Introduction (Video)}

\markright{Introduction (Video)}

The first lesson on graphing focused on creating the correct graphics
for the data types. This lesson expands on those tools and demonstrates
how to customize some features and add enhancements to clarify or to add
information to a plot.

\begin{tcolorbox}[enhanced jigsaw, arc=.35mm, titlerule=0mm, left=2mm, bottomrule=.15mm, bottomtitle=1mm, opacitybacktitle=0.6, colbacktitle=quarto-callout-note-color!10!white, colback=white, breakable, opacityback=0, colframe=quarto-callout-note-color-frame, toptitle=1mm, title=\textcolor{quarto-callout-note-color}{\faInfo}\hspace{0.5em}{Learning Objectives}, rightrule=.15mm, toprule=.15mm, leftrule=.75mm, coltitle=black]

After completing this lesson students will be able to

\begin{itemize}
\tightlist
\item
  Change the color of plots
\item
  Create a grid/panel of plots.
\item
  Create several multivariable graphics
\item
  Know of a few new packages that contain functions that enhance plots
\end{itemize}

\end{tcolorbox}

\begin{tcolorbox}[enhanced jigsaw, arc=.35mm, titlerule=0mm, left=2mm, bottomrule=.15mm, bottomtitle=1mm, opacitybacktitle=0.6, colbacktitle=quarto-callout-important-color!10!white, colback=white, breakable, opacityback=0, colframe=quarto-callout-important-color-frame, toptitle=1mm, title=\textcolor{quarto-callout-important-color}{\faExclamation}\hspace{0.5em}{Too much to memorize!}, rightrule=.15mm, toprule=.15mm, leftrule=.75mm, coltitle=black]

There is \emph{NO} need to remember all of these adjustments when there
are incredibly handy reference guides available. The resource section of
the \href{../wk4.html}{Week 4 overview} has links to some of my favorite
sites.

\end{tcolorbox}

\begin{tcolorbox}[enhanced jigsaw, arc=.35mm, titlerule=0mm, left=2mm, bottomrule=.15mm, bottomtitle=1mm, opacitybacktitle=0.6, colbacktitle=quarto-callout-important-color!10!white, colback=white, breakable, opacityback=0, colframe=quarto-callout-important-color-frame, toptitle=1mm, title=\textcolor{quarto-callout-important-color}{\faExclamation}\hspace{0.5em}{Preparation}, rightrule=.15mm, toprule=.15mm, leftrule=.75mm, coltitle=black]

Prior to this lesson students should

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Install the following packages: \texttt{gridExtra},
  \texttt{RColorBrewer} and \texttt{sjPlot} packages.
\item
  Download the notes file for this lesson
\item
  Update the paths to read in the data and ensure the first code chunk
  of your notes work.
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(ggplot2); }\FunctionTok{library}\NormalTok{(dplyr)}
\NormalTok{knitr}\SpecialCharTok{::}\NormalTok{opts\_chunk}\SpecialCharTok{$}\FunctionTok{set}\NormalTok{(}\AttributeTok{warning=}\ConstantTok{FALSE}\NormalTok{, }\AttributeTok{message=}\ConstantTok{FALSE}\NormalTok{) }
\NormalTok{email }\OtherTok{\textless{}{-}} \FunctionTok{read.table}\NormalTok{(}\StringTok{"data/email.txt"}\NormalTok{, }\AttributeTok{header=}\ConstantTok{TRUE}\NormalTok{, }\AttributeTok{sep=}\StringTok{"}\SpecialCharTok{\textbackslash{}t}\StringTok{"}\NormalTok{)}
\NormalTok{NCbirths }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"data/NCbirths.csv"}\NormalTok{, }\AttributeTok{header=}\ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\end{tcolorbox}

\section{Themes (Video)}\label{themes-video}

The standard theme has a gray background, white grid lines etc. Themes
can be changed by adding \texttt{theme\_X()} where \texttt{X} has
several options

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(email, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{line\_breaks, }\AttributeTok{y=}\NormalTok{num\_char)) }\SpecialCharTok{+} \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+} \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{plots2_files/figure-pdf/unnamed-chunk-2-1.pdf}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(email, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{line\_breaks, }\AttributeTok{y=}\NormalTok{num\_char)) }\SpecialCharTok{+} \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+} \FunctionTok{theme\_void}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{plots2_files/figure-pdf/unnamed-chunk-2-2.pdf}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(email, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{line\_breaks, }\AttributeTok{y=}\NormalTok{num\_char)) }\SpecialCharTok{+} \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+} \FunctionTok{theme\_dark}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{plots2_files/figure-pdf/unnamed-chunk-2-3.pdf}}

See more about themes here:
http://www.sthda.com/english/wiki/ggplot2-themes-and-background-colors-the-3-elements

\section{Legends (Video)}\label{legends-video}

\subsection{Titles}\label{titles}

Add the \texttt{name=} argument to whatever layer you added that created
the legend. Here I specified a \texttt{fill}, and it was a
\texttt{discrete} variable. So I use the
\texttt{scale\_fill\_discrete()} layer.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(email, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{y=}\NormalTok{num\_char, }\AttributeTok{x=}\NormalTok{number, }\AttributeTok{fill=}\NormalTok{number)) }\SpecialCharTok{+} \FunctionTok{geom\_boxplot}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{scale\_fill\_discrete}\NormalTok{(}\AttributeTok{name=}\StringTok{"Size of number"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{plots2_files/figure-pdf/unnamed-chunk-3-1.pdf}}

Here I \texttt{col}or the box outlines so the layer is
\texttt{scale\_color\_discrete()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(email, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{y=}\NormalTok{num\_char, }\AttributeTok{x=}\NormalTok{number, }\AttributeTok{col=}\NormalTok{number)) }\SpecialCharTok{+} \FunctionTok{geom\_boxplot}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{scale\_color\_discrete}\NormalTok{(}\AttributeTok{name=}\StringTok{"Size of number"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{plots2_files/figure-pdf/unnamed-chunk-4-1.pdf}}

\subsection{Removing the legend}\label{removing-the-legend}

In this case the legend show the same information. That's redundant and
takes up space, so let's remove it entirely by adding
\texttt{guide="none"} to the \texttt{scale\_} layer.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(email, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{y=}\NormalTok{num\_char, }\AttributeTok{x=}\NormalTok{number, }\AttributeTok{col=}\NormalTok{number)) }\SpecialCharTok{+} \FunctionTok{geom\_boxplot}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{scale\_color\_discrete}\NormalTok{(}\AttributeTok{guide=}\StringTok{"none"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{plots2_files/figure-pdf/unnamed-chunk-5-1.pdf}}

\section{Titles (Video)}\label{titles-video}

A good plot needs to stand alone and convey as much information as
possible.

\begin{itemize}
\tightlist
\item
  \texttt{ggtitle()} adds an overall plot title
\item
  \texttt{ylab()} and \texttt{xlab()} adjust the axis labels.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(email, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{y=}\NormalTok{num\_char, }\AttributeTok{x=}\NormalTok{number, }\AttributeTok{col=}\NormalTok{number)) }\SpecialCharTok{+} \FunctionTok{geom\_boxplot}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{scale\_color\_discrete}\NormalTok{(}\AttributeTok{guide=}\StringTok{"none"}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Distribution of the number of characters in an email based on the size of the number in the email"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Number of characters"}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{xlab}\NormalTok{(}\StringTok{"Size of number in email"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{plots2_files/figure-pdf/unnamed-chunk-6-1.pdf}}

\section{Removing NA categories
(Video)}\label{removing-na-categories-video}

This happens when there is no data is present for one or more levels.
One way to get around this is to use \texttt{select} to only choose
variables that we are going to use in the plot directly, delete all rows
with any missing values using \texttt{na.omit()}, then pipe
\texttt{ggplot} directly in after deleting all rows with missing data.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{NCbirths }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(mage, whitemom, marital, habit) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{na.omit}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{mage, }\AttributeTok{fill=}\NormalTok{whitemom)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_density}\NormalTok{(}\AttributeTok{alpha=}\NormalTok{.}\DecValTok{2}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{facet\_grid}\NormalTok{(marital}\SpecialCharTok{\textasciitilde{}}\NormalTok{habit)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{plots2_files/figure-pdf/unnamed-chunk-7-1.pdf}}

\begin{quote}
Warning: \texttt{na.omit()} can be dangerous to use. It will drop EVERY
row with ANY value missing. We are using it safely here because we are
only selecting the variables that we will use in the plot.
\end{quote}

\section{Changing colors (Video)}\label{changing-colors-video}

\subsection{Manual}\label{manual}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(email, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{number, }\AttributeTok{fill=}\NormalTok{number)) }\SpecialCharTok{+} \FunctionTok{geom\_bar}\NormalTok{() }\SpecialCharTok{+}
    \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{values=}\FunctionTok{c}\NormalTok{(}\StringTok{"red"}\NormalTok{, }\StringTok{"green"}\NormalTok{, }\StringTok{"blue"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{plots2_files/figure-pdf/unnamed-chunk-8-1.pdf}}

There's some spectacularly named colors as well, here is the
\href{https://www.nceas.ucsb.edu/~frazier/RSpatialGuides/colorPaletteCheatsheet.pdf}{full
list of names}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(email, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{number, }\AttributeTok{fill=}\NormalTok{number)) }\SpecialCharTok{+} \FunctionTok{geom\_bar}\NormalTok{() }\SpecialCharTok{+}
    \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{values=}\FunctionTok{c}\NormalTok{(}\StringTok{"salmon"}\NormalTok{, }\StringTok{"slategray4"}\NormalTok{, }\StringTok{"violet"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{plots2_files/figure-pdf/unnamed-chunk-9-1.pdf}}

And you can use
\href{https://www.w3schools.com/colors/colors_picker.asp}{hex colors}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(email, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{number, }\AttributeTok{fill=}\NormalTok{number)) }\SpecialCharTok{+} \FunctionTok{geom\_bar}\NormalTok{() }\SpecialCharTok{+}
    \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{values=}\FunctionTok{c}\NormalTok{(}\StringTok{"\#47dbff"}\NormalTok{, }\StringTok{"\#b3b3cc"}\NormalTok{, }\StringTok{"\#ff531a"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{plots2_files/figure-pdf/unnamed-chunk-10-1.pdf}}

\subsection{Using a color palette
(recommended)}\label{using-a-color-palette-recommended}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(RColorBrewer)}
\FunctionTok{ggplot}\NormalTok{(email, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{number, }\AttributeTok{fill=}\NormalTok{number)) }\SpecialCharTok{+} \FunctionTok{geom\_bar}\NormalTok{() }\SpecialCharTok{+}
    \FunctionTok{scale\_fill\_brewer}\NormalTok{(}\AttributeTok{palette=}\StringTok{"Spectral"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{plots2_files/figure-pdf/unnamed-chunk-11-1.pdf}}

Review the links in the additional resources section of the
\href{../wk4.html}{Week 4 overview} on how to choose colors. With great
power comes great responsibility. Colors can just as easily detract from
a plot as they can enhance it.

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\section{Barchart enhancements
(Video)}\label{barchart-enhancements-video}

\subsection{Numbers to the top of
bars.}\label{numbers-to-the-top-of-bars.}

The biggest addition to a barchart is the numbers on top of the bars.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(email, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{number)) }\SpecialCharTok{+} \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+} 
    \FunctionTok{geom\_bar}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y =}\NormalTok{ ..count..)) }\SpecialCharTok{+} \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Frequency of emails by size of number"}\NormalTok{) }\SpecialCharTok{+} 
    \FunctionTok{geom\_text}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y=}\NormalTok{..count.. }\SpecialCharTok{+} \DecValTok{50}\NormalTok{, }\AttributeTok{label=}\NormalTok{..count..), }\AttributeTok{stat=}\StringTok{\textquotesingle{}count\textquotesingle{}}\NormalTok{, }\AttributeTok{size =} \DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{plots2_files/figure-pdf/unnamed-chunk-12-1.pdf}}

\begin{itemize}
\tightlist
\item
  Play with the \texttt{+50} on the y axis to move the numbers up/down
  the bars.
\item
  Play with the \texttt{size} modifier to find something readable.
\end{itemize}

\subsection{Plotting Proportions}\label{plotting-proportions}

Often you don't want to compare counts but percents. To accomplish this
in ggplot is doable, but involves pre-calculating the percentages first
and then plotting the summary numbers. This is a great place to
introduce a different package: \texttt{sjPlot}.

\texttt{ggplot2} is pretty great for easy out-of-the-box plots that
don't look half bad. Well for something a bit better when it comes to
labeled barcharts let's turn to the \texttt{sjPlot} package. Note this
package uses ggplot graphics, but does not follow the syntax. So you'll
need to reference the
\href{https://strengejacke.github.io/sjPlot/}{vignette} often to to
learn more of what this package can do and what syntax it uses.

To plot the frequency distribution of a single categorical variable we
use the ``plot freq'' function \texttt{plot\_frq}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(sjPlot)}

\FunctionTok{plot\_frq}\NormalTok{(email}\SpecialCharTok{$}\NormalTok{number)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{plots2_files/figure-pdf/unnamed-chunk-13-1.pdf}}

To plot the results of a contingency table we can use the
\texttt{plot\_xtab} function.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot\_xtab}\NormalTok{(NCbirths}\SpecialCharTok{$}\NormalTok{mature, NCbirths}\SpecialCharTok{$}\NormalTok{marital)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{plots2_files/figure-pdf/unnamed-chunk-14-1.pdf}}

As before, you \emph{MUST} do a common sense check on the proportions
that are shown, which also means knowing what the default settings for a
function are. The defaults for \texttt{plot\_xtab} show the proportion
of the fill variable, within the variable that's on the x. In context of
the plot above, 17.5\% of women who are not married are mature moms.
86.8\% of all moms are younger moms.

You can see the available adjustments using function arguments by
reviewing the
\href{https://strengejacke.github.io/sjPlot/reference/plot_xtab.html}{vignette
for that function}. Here I will turn off the total column by adding
\texttt{show.total=FALSE} and turn it into row percents by adding
\texttt{margin=\textquotesingle{}row\textquotesingle{}}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot\_xtab}\NormalTok{(NCbirths}\SpecialCharTok{$}\NormalTok{mature, NCbirths}\SpecialCharTok{$}\NormalTok{marital, }\AttributeTok{margin=}\StringTok{\textquotesingle{}row\textquotesingle{}}\NormalTok{, }\AttributeTok{show.total =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{plots2_files/figure-pdf/unnamed-chunk-15-1.pdf}}

Now 81.1\% of mature moms are not married, and 41.6\% of younger moms
are married. Always make sure your \%'s being displayed match your
interpretation.

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\section{Multivariate plotting
(Video)}\label{multivariate-plotting-video}

So far we've only looked at how to plot 2 variables on the same plot.
Let's up our game some.

\subsection{Boxplots with three
variables.}\label{boxplots-with-three-variables.}

In the first plotting lesson, we saw that for boxplots the continuous
variable goes on the y, categorical on the x. Well you can also fill (or
color) the boxes by a third variable if you want an additional
comparison within the categories on the x axis.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(NCbirths, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{y=}\NormalTok{weeks, }\AttributeTok{x=}\NormalTok{mature, }\AttributeTok{fill=}\NormalTok{habit)) }\SpecialCharTok{+} 
        \FunctionTok{geom\_boxplot}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{plots2_files/figure-pdf/unnamed-chunk-16-1.pdf}}

This lets us compare the average gestation period for smokers vs non
smokers, and mature vs younger moms. Displaying the boxes this way
allows for easy comparison of weeks between smokers \& non smokers,
within maturity status. If we flip the x axis and fill,

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(NCbirths, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{y=}\NormalTok{weeks, }\AttributeTok{x=}\NormalTok{habit, }\AttributeTok{fill=}\NormalTok{mature)) }\SpecialCharTok{+} 
        \FunctionTok{geom\_boxplot}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{plots2_files/figure-pdf/unnamed-chunk-17-1.pdf}}

Now the emphasis is on comparing weeks between mature \& younger moms,
within each smoking status.

This way of grouping levels of one aspect within categories of another
aspect is extended and enhanced using faceting or paneling.

\section{Faceting / paneling}\label{faceting-paneling}

ggplot introduces yet another term called \texttt{faceting}. The
definition is \emph{a particular aspect or feature of something}, or
\emph{one side of something many-sided, especially of a cut gem}.
Basically instead of plotting the grouped graphics on the same plotting
area, we let each group have it's own plot, or facet.

We add a \texttt{facet\_wrap()} and specify that we want to panel on the
color group. Note the twiddle in front of color. (Not here we're
switching to the \texttt{NCbirths} data set.)

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(NCbirths, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{mage, }\AttributeTok{fill=}\NormalTok{gender)) }\SpecialCharTok{+} \FunctionTok{geom\_density}\NormalTok{(}\AttributeTok{alpha=}\NormalTok{.}\DecValTok{3}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{facet\_wrap}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{mature)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{plots2_files/figure-pdf/unnamed-chunk-18-1.pdf}}

The grid placement can be semi-controlled by using the \texttt{ncol}
argument in the \texttt{facet\_wrap()} statement.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(NCbirths, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{mage, }\AttributeTok{fill=}\NormalTok{gender)) }\SpecialCharTok{+} \FunctionTok{geom\_density}\NormalTok{(}\AttributeTok{alpha=}\NormalTok{.}\DecValTok{3}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{facet\_wrap}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{mature, }\AttributeTok{ncol=}\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{plots2_files/figure-pdf/unnamed-chunk-19-1.pdf}}

It is important to compare distributions across groups on the same
scale, and our eyes can compare items vertically better than
horizontally.

\section{Multiple plots per window}\label{multiple-plots-per-window}

This method works only for plots created with \texttt{ggplot}. Here we
use the \texttt{grid.arrange} function in the \texttt{gridExtra}
package.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  assign the output of a ggplot object to an object (here it's
  \texttt{plot1} and \texttt{plot2}).
\item
  Use \texttt{grid.arrange()} to arrange them either side by side or top
  and bottom.
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(gridExtra)}
\NormalTok{plot1 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(NCbirths, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{mage, }\AttributeTok{fill=}\NormalTok{whitemom)) }\SpecialCharTok{+} \FunctionTok{geom\_density}\NormalTok{(}\AttributeTok{alpha=}\NormalTok{.}\DecValTok{2}\NormalTok{)}
\NormalTok{plot2 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(NCbirths, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{mage, }\AttributeTok{col=}\NormalTok{whitemom)) }\SpecialCharTok{+} \FunctionTok{geom\_density}\NormalTok{() }
\FunctionTok{grid.arrange}\NormalTok{(plot1,plot2, }\AttributeTok{ncol=}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{plots2_files/figure-pdf/unnamed-chunk-20-1.pdf}}

\section{Paneling on two variables}\label{paneling-on-two-variables}

Who says we're stuck with only faceting on one variable? A variant on
\texttt{facet\_wrap} is \texttt{facet\_grid}. Here we can specify
multiple variables to panel on.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(NCbirths, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{mage, }\AttributeTok{fill=}\NormalTok{whitemom)) }\SpecialCharTok{+} \FunctionTok{geom\_density}\NormalTok{(}\AttributeTok{alpha=}\NormalTok{.}\DecValTok{2}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{facet\_grid}\NormalTok{(marital}\SpecialCharTok{\textasciitilde{}}\NormalTok{habit)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{plots2_files/figure-pdf/unnamed-chunk-21-1.pdf}}

\part{Assignments}

\chapter*{Assignments}\label{assignments-1}
\addcontentsline{toc}{chapter}{Assignments}

\markboth{Assignments}{Assignments}

Right click and save these files in your \texttt{Math\ 130/hw} folder.
You will write your answers directly in them and submit your assignment
as instructed by the due date.

\begin{itemize}
\tightlist
\item
  \href{hw1.qmd}{HW 1}
\item
  \href{hw2.qmd}{HW 2}
\item
  \href{hw3.qmd}{HW 3}
\item
  \href{hw4.qmd}{HW 4}
\end{itemize}

\subsection*{Need help getting
started?}\label{need-help-getting-started}
\addcontentsline{toc}{subsection}{Need help getting started?}

Watch
\href{https://media.csuchico.edu/media/MATH130\%20-\%20Extra\%20Video\%20(Jan\%2029)/1_9nsoxdy9}{Dr.~Lytals
help video}

\chapter*{Putting it all together}\label{putting-it-all-together}
\addcontentsline{toc}{chapter}{Putting it all together}

\markboth{Putting it all together}{Putting it all together}

Time to put everything you learned in this class into action. In an
exploratory data analysis (EDA) you are just looking at (exploring) the
data and learning about the data and possible relationships between
variables. This is not a formal statistical analysis, you cannot make
any claims about groups being statistically different. This is just
descriptive. You are allowed and encouraged to hypothesize why you
observe certain relationships or data characteristics, just be sure not
to draw any conclusions from the data.

\section*{Instructions}\label{instructions}
\addcontentsline{toc}{section}{Instructions}

\markright{Instructions}

Using your data set of choice, pose a brief research question that
explores the relationship between 2-3 variables.

Use markdown headers to make the following sections

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \textbf{Introduction}: A short introduction/description of the data.

  \begin{itemize}
  \tightlist
  \item
    Specifically mention the 2-3 variables you are going to explore.
  \item
    What is your research question? What are you interested in finding
    out more about?
  \end{itemize}
\item
  \textbf{Univariate Exploration}: Describe each of the variables under
  consideration.

  \begin{itemize}
  \tightlist
  \item
    This means calculate some summary statistics (N(\%) or mean(sd)) and
    make a graphic
  \end{itemize}
\item
  \textbf{Bivariate Exploration}: Comparison between two variables of
  interest.

  \begin{itemize}
  \tightlist
  \item
    Calculate grouped summary statistics as appropriate. \textbf{This is
    often the most often forgotten part}
  \item
    You can go further and explore more than two variables at a time
    using paneling, but be sure to explain what you learn from each
    graph.
  \end{itemize}
\item
  \textbf{Conclusion}: What did you find? If you had a prior hypothesis,
  does the data seem to support it? Remember this is NOT a statistical
  analysis.
\end{enumerate}

All descriptions (univariate and bivariate) must be done using graphics,
summary statistics, and words.

This is a very vague set of instructions for a reason. I want you to
explore and choose a pair of variables that you find interesting. Create
tables, graphics, grouped summary statistics (mean of the continuous
variable across levels of the categorical variable). Whatever you need
to do to understand the relationship between these two measures.

Use the grading rubric at the end of this document for guidance as to
what you should present, in what order, and level of detail you need to
present.

\section*{Data}\label{data}
\addcontentsline{toc}{section}{Data}

\markright{Data}

You have a choice here. If you are currently working on some data that
you would like to explore, talk with your instructor to get your data
set approved. As long as it has more than a few variables in it, and at
least 30 observations it should be fine.

If you do not have your own data, you can choose from one of the
following data sets, all of which can be downloaded from the
\href{https://norcalbiostat.netlify.com/data}{Data} page of Dr.~D's
teaching course website. Here are some viable choices:

\begin{itemize}
\tightlist
\item
  \textbf{Email Spam}: Characteristics of emails used to predict if the
  email is spam or not.
\item
  \textbf{HIV}: Data on adolescent children living with HIV positive
  parents.
\item
  \textbf{Depression}: Level of depression (\texttt{cesd}), health care,
  and demographic characteristics.
\item
  \textbf{High School and Beyond}: Educational, vocational, and personal
  development of elementary and high school students.
\item
  \textbf{Police Shootings}: Characteristics of individuals killed by
  police in 2015.
\end{itemize}

Any other data sets require instructor approval. Data sets such as the
\texttt{plants} or \texttt{arm\ strength} data sets are insufficiently
complex for this project. Also you can't use the \texttt{dsmall},
\texttt{diamonds}, or \texttt{NCbirths} data sets because we've used
them too much already.

\section*{Guidelines}\label{guidelines}
\addcontentsline{toc}{section}{Guidelines}

\markright{Guidelines}

\begin{itemize}
\tightlist
\item
  Render early and often. As often as every time you include a new R
  code chunk.
\item
  Spell check your report prior to submission using RStudio.
\item
  Re-read your report and edit for clarification and removing duplicated
  information.
\item
  Remove superfluous code and output (i.e.~printing a data set to the
  screen).
\item
  This is to be independent work. Papers that are too similar will
  receive no credit.
\item
  Look at the grading rubric to help you decide the level of detail
  required.
\end{itemize}

\section*{Scoring Rubric}\label{scoring-rubric}
\addcontentsline{toc}{section}{Scoring Rubric}

\markright{Scoring Rubric}

\begin{quote}
review these with others. we're not really teaching how to interpret.
\end{quote}

The criteria below is what you will be graded on.

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\linewidth - 6\tabcolsep) * \real{0.2500}}
  >{\raggedright\arraybackslash}p{(\linewidth - 6\tabcolsep) * \real{0.2500}}
  >{\raggedright\arraybackslash}p{(\linewidth - 6\tabcolsep) * \real{0.2500}}
  >{\raggedright\arraybackslash}p{(\linewidth - 6\tabcolsep) * \real{0.2500}}@{}}
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
Criteria
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Novice
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Competent
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Proficient
\end{minipage} \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\textbf{Data Description}: Provide a description of the data set and the
variables of interest. & There is no description or the description is a
copy of the help file. & There is a minor description of the data but
not enough to understand what is being measured or compared. & The data
description is clear and concise, it is clear to me what data is being
analyzed and where it was obtained. \\
\textbf{Univariate Description}: Fully describe the distribution of
\emph{each variable} by itself & There are no numerical or graphical
summaries provided. & Only numeric or only graphical summaries were
created, but no textual description. & The variable was fully described
using both numeric and graphical summary methods. This information was
summarized below the output in a paragraph form. \\
\textbf{Bivariate Comparison}: Describe the relationship between the two
chosen variables. & No comparison was made, or the variables were
compared, but inappropriate graphics or summary statistics were created.
& The variables were compared using appropriate graphical methods and
grouped summary statistics were created, but nothing was discussed. &
The variables were compared using appropriate graphical methods and a
short textual explanation of what the summaries showed. \\
\textbf{Organization / Grammar}: How well does the report read? How well
organized is it? Was it checked for grammar and spelling mistakes? &
Only R code, output is present. There is no discussion of results. Tons
of extra R code that is not relevant to the discussion is present.
Markdown headers were not used. & An attempt was made to discuss the
results, but the explanations are not in a report format or there are
some large grammar and/or spelling problems. Some R code that is not
relevant to the analysis question at hand is being displayed. Markdown
headers were used to create sections. & The report was spell written in
well edited, full English sentences, and spell checked prior to
submission. The report flowed well and followed the required order of
discussion topics with markdown headers used successfully. \\
\end{longtable}




\end{document}
